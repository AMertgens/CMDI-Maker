<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\js\core\app.internationalization.js - CMDI Maker</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..\..\yuidoc_header_image.png" title="CMDI Maker"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.10</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/APP.html">APP</a></li>
            
                <li><a href="../classes/APP.CONF.html">APP.CONF</a></li>
            
                <li><a href="../classes/APP.environments.html">APP.environments</a></li>
            
                <li><a href="../classes/APP.forms.html">APP.forms</a></li>
            
                <li><a href="../classes/APP.GUI.html">APP.GUI</a></li>
            
                <li><a href="../classes/APP.GUI.FORMS.html">APP.GUI.FORMS</a></li>
            
                <li><a href="../classes/APP.GUI.pager.html">APP.GUI.pager</a></li>
            
                <li><a href="../classes/APP.intl.html">APP.intl</a></li>
            
                <li><a href="../classes/APP.save_and_recall.html">APP.save_and_recall</a></li>
            
                <li><a href="../classes/APP.settings.html">APP.settings</a></li>
            
                <li><a href="../classes/HELPERS.html">HELPERS</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/CORE.html">CORE</a></li>
            
                <li><a href="../modules/HELPERS.html">HELPERS</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\js\core\app.internationalization.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿/*
Copyright 2014 Sebastian Zimmer

Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/


/**
 * A sub module of APP that offers users to create translations of CMDI Maker LanguagePacks (LPs).
 *
 * @class APP.intl
 */
APP.intl = (function () {
	&#x27;use strict&#x27;;

	var my = {};
	
	my.init = function(){
	
		if (!g(&quot;VIEW_intl&quot;)){
			var view = dom.div(g(&quot;content_wrapper&quot;), &quot;VIEW_intl&quot;, &quot;content&quot;);
		}
		
		else {
			view = g(&quot;VIEW_intl&quot;);
			view.innerHTML = &quot;&quot;;
		}		
	
	}
	
	
	//When this page gets viewed, re-initialize it and refresh it with all the new environments now available
	my.view = function(){
		
		if (!g(&quot;VIEW_intl&quot;)){
			var view = dom.div(g(&quot;content_wrapper&quot;), &quot;VIEW_intl&quot;, &quot;content&quot;);
		}
		
		else {
			view = g(&quot;VIEW_intl&quot;);
			view.innerHTML = &quot;&quot;;
		}
		
		var introduction = dom.p(view, &quot;&quot;, &quot;internationalization_introduction&quot;, &quot;&quot;);
		introduction.innerHTML = &quot;CMDI Maker was originally created to support linguists all over the world to create XML metadata. &quot; +
		&quot;This is the reason for implementing this internationalization module, where you can create, edit or just have a look at Language Packs (LPs) for the app.&lt;br&gt;&quot; +
		&quot;You can import them by including the resulting JSON files in the CMDI Maker source code or in the source code of the respective CMDI Maker environment.&lt;br&gt;&quot; +
		&quot;If you send us your LanguagePack, we will happily integrate it into the official interface.&lt;br&gt;&lt;br&gt;&quot;+
		&quot;If you are not sure about translating tech terms, maybe &lt;a target=&#x27;_blank&#x27; href=&#x27;http://www.microsoft.com/Language/en-US/Search.aspx?sString=Abort&amp;langID=es-es&#x27;&gt;Microsoft Terminology Search&lt;/a&gt; is of help!&lt;br&gt;&quot;+
		&quot;English is the default and reference language. Translations should always take this language as source.&quot;;

		
		//templates of app core and each environment
		var templates = [];
		
		//as form template we use always the default languge (english)
		var app_core_template = APP.forms.getTemplateFromDataObject(APP.languages[0].terms, &quot;core_terms&quot;, &quot;no_default_values&quot;);
		
		templates.push(app_core_template);
		
		//get from each environment a form template from its first language
		forEach(APP.environments.environments, function(env){
			
			if (env.languages){
				var LP_0 = env.languages[0];
				var env_template = APP.forms.getTemplateFromDataObject(LP_0.terms, env.id + &quot;_terms&quot;, &quot;no_default_values&quot;);
				templates.push(env_template);
			}
			
			else {
				templates.push(undefined);
			}
			
		});
		
		log(templates);
		
		//The idea is: every environment language must be supported by the APP CORE too. it wouldn&#x27;t make sense to have only the environment
		//but not the app core in french. that is why we create only forms for the languages supported by app core
		//as well as an empty column for a new language. the user can then create LPs for all loaded environments in the new language.
		forEach(APP.languages, function(APP_CORE_LP, i){
			
			var id = APP_CORE_LP.id;
			
			var all_LPs_of_one_language = [];
			all_LPs_of_one_language.push(APP_CORE_LP);
			
			//get languages packs of all environments for this language
			forEach(APP.environments.environments, function(env, j){
			
				if (env.languages &amp;&amp; env.languages[i]){
					all_LPs_of_one_language.push(env.languages[i]);
				}
				
				else {
					all_LPs_of_one_language.push(undefined);
				}
			
			});	
		
			my.makeFormColumnForLanguage(view, id, templates, all_LPs_of_one_language);
			
		});
		
		//create column for new language
		my.makeFormColumnForLanguage(view, &quot;new&quot;, templates, undefined);
		
		
		dom.scrollTop(view);
		
	};
	
	
	//creates a LP form for one language with all environments that are supporting that language
	my.makeFormColumnForLanguage = function(parent, id, templates, LPs){
		
		var form_wrapper = dom.div(parent, &quot;form_&quot; + id, &quot;intl_form&quot;);
		var form_title = dom.h1(form_wrapper, id);
		
		if (LPs){
			var CORE_LP = LPs[0];
		}
		
		my.makeLPForm(form_wrapper, templates[0], id + &quot;_core&quot;, &quot;APP CORE&quot;, CORE_LP);
		
		//Create form in this language for every loaded environment
		for (var t = 1; t &lt; templates.length; t++){
			
			var template = templates[t];
			if (LPs){
				var LP = LPs[t];
			}

			var environment_id = APP.environments.environments[t-1].id;
			
			//Tell again, which language it is
			dom.h1(form_wrapper, id);
	
			my.makeLPForm(form_wrapper, template, id + &quot;_&quot; + environment_id, &quot;Environment: &quot; + environment_id, LP);
			
		}

	};
	
	
	var deleteEmptyStringsInObject = function(obj){
	
		for (var key in obj){
		
			if (typeof obj[key] == &quot;string&quot; &amp;&amp; obj[key] == &quot;&quot;){
				
				delete obj[key];
				
			}
			
			if (typeof obj[key] == &quot;object&quot;){
			
				deleteEmptyStringsInObject(obj[key]);
			
			}
			
		}
	
	}
	
	
	my.makeLPForm = function(parent, template, id, title, LP){
		
		if (LP){
			var data = LP.terms;
		}
		
		//if there is no LP, make an empty form
		
		dom.h2(parent, title);
		log(template);
		
		var import_link = dom.a(parent, &quot;import_intl_&quot; + id, &quot;import_intl_link&quot;, undefined,
			&quot;Import JSON file&quot;,
			function(){
				
				APP.GUI.showFileDialog(function(file){
				
					readFileAsJSON(
					
						file,
						
						function(json){
					
							APP.forms.fill(template, &quot;intl_&quot; + id + &quot;_&quot;, json);
						
						},
						
						function(){
						
							log(&quot;Error reading file as JSON!&quot;);
						
						}
						
					);
				});
				
			}
		);		
		
		
		APP.forms.make(parent, template, &quot;intl_&quot; + id + &quot;_&quot;, &quot;intl_&quot;, data, undefined);
		
		dom.br(parent);
		
		var save_link = dom.a(parent, &quot;save_intl_&quot; + id, &quot;save_intl_link&quot;, undefined,
			&quot;Save as JSON&quot;,
			function(){
				log(&quot;Saving intl form with id &quot; + id + &quot; as json&quot;);
				var data = APP.forms.makeObjectWithFormData(template, &quot;intl_&quot; + id + &quot;_&quot;);
				
				deleteEmptyStringsInObject(data);				
				
				APP.saveTextfile(JSON.stringify(data, null, &quot;\t&quot;), id + &quot;.json&quot;);
			}
		);
		
		
		dom.br(parent);
		dom.br(parent);
		dom.br(parent);
		dom.br(parent);
		
	};

	
	return my;
	
})();

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
