/*
Copyright 2014 Sebastian Zimmer

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
function ajax_get(e,n){var t=new XMLHttpRequest;return t.open("GET",e,!0),t.onreadystatechange=function(){if(4==t.readyState&&200==t.status){console.log("AJAX successful!");var e=t.responseText;n(e)}},console.log("Sending ajax request to: "+e),t.send()}function cloneObject(e){var n={};for(var t in e)n[t]=e[t]&&"object"==typeof e[t]?cloneObj(e[t]):e[t];return n}function readFileAsText(e,n){var t=new FileReader;t.onload=function(e){var t=e.target.result;n(t)},t.readAsText(e)}function getFileTypeFromFilename(e){var n=e.lastIndexOf("."),t=e.slice(n+1,e.length).toLowerCase();return t=removeAllCharactersFromStringExcept(t,"abcdefghijklmnopqrstuvwxyz0123456789")}function getFilenameFromFilePath(e){return-1!=e.indexOf("\\")?getFilenameFromWindowsFilePath(e):getFilenameFromUNIXFilePath(e)}function getFilenameFromUNIXFilePath(e){var n=e.lastIndexOf("/");return-1==n?e:e.substring(n+1)}function getFilenameFromWindowsFilePath(e){var n=e.lastIndexOf("\\");return-1==n?e:e.substring(n+1)}function addScript(e,n){console.log("adding script: "+e);var t=document.createElement("script");t.src=e,t.addEventListener("load",n,!1),document.head.appendChild(t)}function getDirectoryFromFilePath(e){return-1!=e.indexOf("\\")?getDirectoryFromWindowsFilePath(e):getDirectoryFromUNIXFilePath(e)}function getDirectoryFromUNIXFilePath(e){var n=e.lastIndexOf("/");return-1==n?void 0:e.substring(0,n+1)}function getDirectoryFromWindowsFilePath(e){var n=e.lastIndexOf("\\");return-1==n?void 0:e.substring(0,n+1)}function get(e){var n=document.getElementsByName(e);if(n[0]&&"INPUT"==n[0].nodeName&&"radio"==n[0].type)return getSelectedRadioValue(n);if(n=n[0],"undefined"==typeof n&&(n=g(e)),"undefined"==typeof n)return void console.error("get: Element "+e+" is undefined!");switch(n.nodeName){case"INPUT":return n.value;case"TEXTAREA":return n.value;case"SELECT":return-1!=n.selectedIndex?n.options[n.selectedIndex].value:"";default:console.log('Function "get" has been misused with a '+n.nodeName+" element. This should not have happened!")}}function g_value(e){return document.getElementById(e).options[document.getElementById(e).options.selectedIndex].value}function randomString(e,n){for(var t="",o=e;o>0;--o)t+=n[Math.round(Math.random()*(n.length-1))];return t}function replaceAccentBearingLettersWithASCISubstitute(e){var n=e;return"string"!=typeof n&&console.error("replaceAccentBearingLetters: Argument is not of type 'string'"),n=n.replace(/á/g,"a").replace(/à/g,"a").replace(/Á/g,"A").replace(/À/g,"A").replace(/ä/g,"ae").replace(/Ä/g,"Ae"),n=n.replace(/Ç/g,"C").replace(/Ĉ/g,"C").replace(/ĉ/g,"c").replace(/ć/g,"c").replace(/č/g,"c").replace(/Ć/g,"C").replace(/Č/g,"C").replace(/ï/g,"c").replace(/Ï/g,"C").replace(/ċ/g,"c").replace(/Ċ/g,"C"),n=n.replace(/é/g,"e").replace(/è/g,"e").replace(/É/g,"E").replace(/È/g,"E").replace(/Ê/g,"E").replace(/ê/g,"e"),n=n.replace(/î/g,"i").replace(/Î/g,"I").replace(/í/g,"i").replace(/ì/g,"i").replace(/Í/g,"I").replace(/Ì/g,"I").replace(/ï/g,"i").replace(/Ï/g,"I"),n=n.replace(/ö/g,"oe").replace(/Ö/g,"Oe").replace(/ó/g,"o").replace(/ò/g,"o").replace(/Ó/g,"O").replace(/Ò/g,"O").replace(/Ô/g,"O").replace(/ô/g,"o").replace(/õ/g,"o"),n.replace(/Ü/g,"Ue").replace(/ü/g,"ue").replace(/Û/g,"U").replace(/û/g,"u"),n.replace(/ÿ/g,"y").replace(/Ý/g,"Y"),n=n.replace(/ß/g,"ss").replace(/\s+/g,"_")}function calcAgeAtDate(e,n){var t=+new Date(e),o=+new Date(n);return~~((t-o)/315576e5)}function isSubstringAStartOfAWordInString(e,n){switch(e=e.toLowerCase(),n=n.toLowerCase(),e.indexOf(n)){case-1:return!1;case 0:return!0;default:var t=e[e.indexOf(n)-1];return-1!=",. ".indexOf(t)?!0:!1}}function removeEndingFromFilename(e){var n=e.lastIndexOf(".");return e.slice(0,n)}function o(e,n){for(var t=e,o=0;o<n.length;o++){if(!(n[o]in t))return"";t=t[n[o]]}return t}function a(e,n){for(var t=[],o=0;o<e.length;o++)t.push(e[o][n]);return t}function today(){var e=new Date,n=e.getDate();10>n&&(n="0"+n);var t=e.getMonth();t+=1,10>t&&(t="0"+t);var o=e.getFullYear()+"-"+t+"-"+n;return o}function bytesToSize(e,n){var t=1024,o=1024*t,a=1024*o,i=1024*a;return e>=0&&t>e?e+" B":e>=t&&o>e?(e/t).toFixed(n)+" KB":e>=o&&a>e?(e/o).toFixed(n)+" MB":e>=a&&i>e?(e/a).toFixed(n)+" GB":e>=i?(e/i).toFixed(n)+" TB":e+" B"}function sortBySubKey(e,n){return e.sort(function(e,t){var o=e[n[0]][n[1]],a=t[n[0]][n[1]];return"string"==typeof o&&(o=o.toLowerCase(),a=a.toLowerCase()),a>o?-1:o>a?1:0})}function sortByKey(e,n){return e.sort(function(e,t){var o=e[n],a=t[n];return"string"==typeof o&&(o=o.toLowerCase(),a=a.toLowerCase()),a>o?-1:o>a?1:0})}function parseDate(e){if("undefined"==typeof e)return null;var n=e.match(/([1-2][0-9][0-9][0-9])\-([0-1][0-9])\-([0-3][0-9])/);if(null!==n){var t=+n[1],o=+n[2],a=+n[3],i=new Date(t,o-1,a);if(i.getFullYear()===t&&i.getMonth()===o-1)return{year:n[1],month:n[2],day:n[3]}}var r=e.match(/(\d+)/g);if(null!==r){var i=new Date(r[2],r[1]-1,r[0]);if(i.getFullYear()==r[2]&&i.getMonth()==r[1]-1)return{year:r[2],month:r[1],day:r[0]}}return null}!function(e,n){"use strict";var t,o=e.document;t=function(){var t,a,i,r,s,l,c,d,u,_,m,f,p,g={},h={},v=!1,y={ENTER:13,ESC:27,SPACE:32},b=[];return h={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},p=function(){var e,t,a=!1,i=o.createElement("fakeelement"),r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(e in r)if(i.style[e]!==n){t=r[e],a=!0;break}return{type:t,supported:a}},t=function(e){return o.getElementById(e)},g={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:n,addListeners:function(e){var n,t,l,c,d,u="undefined"!=typeof i,_="undefined"!=typeof a,m="undefined"!=typeof f,p="",g=this;n=function(n){return"undefined"!=typeof n.preventDefault&&n.preventDefault(),l(n),"undefined"!=typeof f&&(p=f.value),"function"==typeof e&&("undefined"!=typeof f?e(!0,p):e(!0)),!1},t=function(n){return"undefined"!=typeof n.preventDefault&&n.preventDefault(),l(n),"function"==typeof e&&e(!1),!1},l=function(){g.hide(),g.unbind(o.body,"keyup",c),g.unbind(r,"focus",d),u&&g.unbind(i,"click",n),_&&g.unbind(a,"click",t)},c=function(e){var o=e.keyCode;(o===y.SPACE&&!m||m&&o===y.ENTER)&&n(e),o===y.ESC&&_&&t(e)},d=function(){m?f.focus():!_||g.buttonReverse?i.focus():a.focus()},this.bind(r,"focus",d),this.bind(s,"focus",d),u&&this.bind(i,"click",n),_&&this.bind(a,"click",t),this.bind(o.body,"keyup",c),this.transition.supported||this.setFocus()},bind:function(e,n,t){"function"==typeof e.addEventListener?e.addEventListener(n,t,!1):e.attachEvent&&e.attachEvent("on"+n,t)},handleErrors:function(){if("undefined"!=typeof e.onerror){var n=this;return e.onerror=function(e,t,o){n.error("["+e+" on line "+o+" of "+t+"]",0)},!0}return!1},appendButtons:function(e,n){return this.buttonReverse?n+e:e+n},build:function(e){var n="",t=e.type,o=e.message,a=e.cssClass||"";switch(n+='<div class="alertify-dialog">',n+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===g.buttonFocus&&(n+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===t&&(n+='<div id="alertify-form">'),n+='<article class="alertify-inner">',n+=h.message.replace("{{message}}",o),"prompt"===t&&(n+=h.input),n+=h.buttons.holder,n+="</article>","prompt"===t&&(n+="</div>"),n+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',n+="</div>",t){case"confirm":n=n.replace("{{buttons}}",this.appendButtons(h.buttons.cancel,h.buttons.ok)),n=n.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":n=n.replace("{{buttons}}",this.appendButtons(h.buttons.cancel,h.buttons.submit)),n=n.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":n=n.replace("{{buttons}}",h.buttons.ok),n=n.replace("{{ok}}",this.labels.ok)}return u.className="alertify alertify-"+t+" "+a,d.className="alertify-cover",n},close:function(e,n){var t,o,a=n&&!isNaN(n)?+n:this.delay,i=this;this.bind(e,"click",function(){t(e)}),o=function(e){e.stopPropagation(),i.unbind(this,i.transition.type,o),_.removeChild(this),_.hasChildNodes()||(_.className+=" alertify-logs-hidden")},t=function(e){"undefined"!=typeof e&&e.parentNode===_&&(i.transition.supported?(i.bind(e,i.transition.type,o),e.className+=" alertify-log-hide"):(_.removeChild(e),_.hasChildNodes()||(_.className+=" alertify-logs-hidden")))},0!==n&&setTimeout(function(){t(e)},a)},dialog:function(e,n,t,a,i){c=o.activeElement;var r=function(){_&&null!==_.scrollTop&&d&&null!==d.scrollTop||r()};if("string"!=typeof e)throw new Error("message must be a string");if("string"!=typeof n)throw new Error("type must be a string");if("undefined"!=typeof t&&"function"!=typeof t)throw new Error("fn must be a function");return this.init(),r(),b.push({type:n,message:e,callback:t,placeholder:a,cssClass:i}),v||this.setup(),this},extend:function(e){if("string"!=typeof e)throw new Error("extend method must have exactly one paramter");return function(n,t){return this.log(n,e,t),this}},hide:function(){var e,n=this;b.splice(0,1),b.length>0?this.setup(!0):(v=!1,e=function(t){t.stopPropagation(),n.unbind(u,n.transition.type,e)},this.transition.supported?(this.bind(u,this.transition.type,e),u.className="alertify alertify-hide alertify-hidden"):u.className="alertify alertify-hide alertify-hidden alertify-isHidden",d.className="alertify-cover alertify-cover-hidden",c.focus())},init:function(){o.createElement("nav"),o.createElement("article"),o.createElement("section"),null==t("alertify-cover")&&(d=o.createElement("div"),d.setAttribute("id","alertify-cover"),d.className="alertify-cover alertify-cover-hidden",o.body.appendChild(d)),null==t("alertify")&&(v=!1,b=[],u=o.createElement("section"),u.setAttribute("id","alertify"),u.className="alertify alertify-hidden",o.body.appendChild(u)),null==t("alertify-logs")&&(_=o.createElement("section"),_.setAttribute("id","alertify-logs"),_.className="alertify-logs alertify-logs-hidden",o.body.appendChild(_)),o.body.setAttribute("tabindex","0"),this.transition=p()},log:function(e,n,t){var o=function(){_&&null!==_.scrollTop||o()};return this.init(),o(),_.className="alertify-logs",this.notify(e,n,t),this},notify:function(e,n,t){var a=o.createElement("article");a.className="alertify-log"+("string"==typeof n&&""!==n?" alertify-log-"+n:""),a.innerHTML=e,_.appendChild(a),setTimeout(function(){a.className=a.className+" alertify-log-show"},50),this.close(a,t)},set:function(e){var n;if("object"!=typeof e&&e instanceof Array)throw new Error("args must be an object");for(n in e)e.hasOwnProperty(n)&&(this[n]=e[n])},setFocus:function(){f?(f.focus(),f.select()):l.focus()},setup:function(e){var o,c=b[0],d=this;v=!0,o=function(e){e.stopPropagation(),d.setFocus(),d.unbind(u,d.transition.type,o)},this.transition.supported&&!e&&this.bind(u,this.transition.type,o),u.innerHTML=this.build(c),r=t("alertify-resetFocus"),s=t("alertify-resetFocusBack"),i=t("alertify-ok")||n,a=t("alertify-cancel")||n,l="cancel"===g.buttonFocus?a:"none"===g.buttonFocus?t("alertify-noneFocus"):i,f=t("alertify-text")||n,m=t("alertify-form")||n,"string"==typeof c.placeholder&&""!==c.placeholder&&(f.value=c.placeholder),e&&this.setFocus(),this.addListeners(c.callback)},unbind:function(e,n,t){"function"==typeof e.removeEventListener?e.removeEventListener(n,t,!1):e.detachEvent&&e.detachEvent("on"+n,t)}},{alert:function(e,n,t){return g.dialog(e,"alert",n,"",t),this},confirm:function(e,n,t){return g.dialog(e,"confirm",n,"",t),this},extend:g.extend,init:g.init,log:function(e,n,t){return g.log(e,n,t),this},prompt:function(e,n,t,o){return g.dialog(e,"prompt",n,t,o),this},success:function(e,n){return g.log(e,"success",n),this},error:function(e,n){return g.log(e,"error",n),this},set:function(e){g.set(e)},labels:g.labels,debug:g.handleErrors}},"function"==typeof define?define([],function(){return new t}):"undefined"==typeof e.alertify&&(e.alertify=new t)}(this),function(e){function n(){var e=-1,n=this;n.append=function(t){var o,a=n.table;for(o=0;o<t.length;o++)e=e>>>8^a[255&(e^t[o])]},n.get=function(){return~e}}function t(e,n,t){return e.slice?e.slice(n,n+t):e.webkitSlice?e.webkitSlice(n,n+t):e.mozSlice?e.mozSlice(n,n+t):e.msSlice?e.msSlice(n,n+t):void 0}function o(e,n){var t,o;return t=new ArrayBuffer(e),o=new Uint8Array(t),n&&o.set(n,0),{buffer:t,array:o,view:new DataView(t)}}function a(){}function i(e){function n(n,t){var i=new Blob([e],{type:R});o=new s(i),o.init(function(){a.size=o.size,n()},t)}function t(e,n,t,a){o.readUint8Array(e,n,t,a)}var o,a=this;a.size=0,a.init=n,a.readUint8Array=t}function r(n){function t(e){for(var t=n.length;"="==n.charAt(t-1);)t--;i=n.indexOf(",")+1,r.size=Math.floor(.75*(t-i)),e()}function a(t,a,r){var s,l=o(a),c=4*Math.floor(t/3),d=4*Math.ceil((t+a)/3),u=e.atob(n.substring(c+i,d+i)),_=t-3*Math.floor(c/4);for(s=_;_+a>s;s++)l.array[s-_]=u.charCodeAt(s);r(l.array)}var i,r=this;r.size=0,r.init=t,r.readUint8Array=a}function s(e){function n(n){this.size=e.size,n()}function o(n,o,a,i){var r=new FileReader;r.onload=function(e){a(new Uint8Array(e.target.result))},r.onerror=i,r.readAsArrayBuffer(t(e,n,o))}var a=this;a.size=0,a.init=n,a.readUint8Array=o}function l(){}function c(e){function n(e){a=new Blob([],{type:R}),e()}function t(e,n){a=new Blob([a,I?e:e.buffer],{type:R}),n()}function o(n,t){var o=new FileReader;o.onload=function(e){n(e.target.result)},o.onerror=t,o.readAsText(a,e)}var a,i=this;i.init=n,i.writeUint8Array=t,i.getData=o}function d(n){function t(e){r+="data:"+(n||"")+";base64,",e()}function o(n,t){var o,a=s.length,i=s;for(s="",o=0;o<3*Math.floor((a+n.length)/3)-a;o++)i+=String.fromCharCode(n[o]);for(;o<n.length;o++)s+=String.fromCharCode(n[o]);i.length>2?r+=e.btoa(i):s=i,t()}function a(n){n(r+e.btoa(s))}var i=this,r="",s="";i.init=t,i.writeUint8Array=o,i.getData=a}function u(e){function n(n){a=new Blob([],{type:e}),n()}function t(n,t){a=new Blob([a,I?n:n.buffer],{type:e}),t()}function o(e){e(a)}var a,i=this;i.init=n,i.writeUint8Array=t,i.getData=o}function _(e,n,t,o,a,i,r,s,l,c){function d(){e.removeEventListener(U,u,!1),s(f)}function u(e){var n=e.data,o=n.data;n.onappend&&(f+=o.length,t.writeUint8Array(o,function(){i(!1,o),_()},c)),n.onflush&&(o?(f+=o.length,t.writeUint8Array(o,function(){i(!1,o),d()},c)):d()),n.progress&&r&&r(m+n.current,a)}function _(){m=p*M,a>m?n.readUint8Array(o+m,Math.min(M,a-m),function(n){e.postMessage({append:!0,data:n}),p++,r&&r(m,a),i(!0,n)},l):e.postMessage({flush:!0})}var m,f,p=0;f=0,e.addEventListener(U,u,!1),_()}function m(e,n,t,o,a,i,r,s,l,c){function d(){var f;u=_*M,a>u?n.readUint8Array(o+u,Math.min(M,a-u),function(n){var s=e.append(n,function(){r&&r(o+u,a)});m+=s.length,i(!0,n),t.writeUint8Array(s,function(){i(!1,s),_++,setTimeout(d,1)},c),r&&r(u,a)},l):(f=e.flush(),f?(m+=f.length,t.writeUint8Array(f,function(){i(!1,f),s(m)},c)):s(m))}var u,_=0,m=0;d()}function f(t,o,a,i,r,s,l,c,d){function u(e,n){r&&!e&&g.append(n)}function f(e){s(e,g.get())}var p,g=new n;return e.zip.useWebWorkers?(p=new Worker(e.zip.workerScriptsPath+T),_(p,t,o,a,i,u,l,f,c,d)):m(new e.zip.Inflater,t,o,a,i,u,l,f,c,d),p}function p(t,o,a,i,r,s,l){function c(e,n){e&&p.append(n)}function d(e){i(e,p.get())}function u(){f.removeEventListener(U,u,!1),_(f,t,o,0,t.size,c,r,d,s,l)}var f,p=new n;return e.zip.useWebWorkers?(f=new Worker(e.zip.workerScriptsPath+B),f.addEventListener(U,u,!1),f.postMessage({init:!0,level:a})):m(new e.zip.Deflater,t,o,0,t.size,c,r,d,s,l),f}function g(e,t,o,a,i,r,s,l,c){function d(){var n=u*M;a>n?e.readUint8Array(o+n,Math.min(M,a-n),function(e){i&&_.append(e),s&&s(n,a,e),t.writeUint8Array(e,function(){u++,d()},c)},l):r(a,_.get())}var u=0,_=new n;d()}function h(e){var n,t,o="",a=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(n=0;n<e.length;n++)t=255&e.charCodeAt(n),o+=t>127?a[t-128]:String.fromCharCode(t);return o}function v(e){return decodeURIComponent(escape(e))}function y(e){var n,t="";for(n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}function b(e){var n=(4294901760&e)>>16,t=65535&e;try{return new Date(1980+((65024&n)>>9),((480&n)>>5)-1,31&n,(63488&t)>>11,(2016&t)>>5,2*(31&t),0)}catch(o){}}function x(e,n,t,o,a){return e.version=n.view.getUint16(t,!0),e.bitFlag=n.view.getUint16(t+2,!0),e.compressionMethod=n.view.getUint16(t+4,!0),e.lastModDateRaw=n.view.getUint32(t+6,!0),e.lastModDate=b(e.lastModDateRaw),1===(1&e.bitFlag)?void a(D):((o||8!=(8&e.bitFlag))&&(e.crc32=n.view.getUint32(t+10,!0),e.compressedSize=n.view.getUint32(t+14,!0),e.uncompressedSize=n.view.getUint32(t+18,!0)),4294967295===e.compressedSize||4294967295===e.uncompressedSize?void a(F):(e.filenameLength=n.view.getUint16(t+22,!0),void(e.extraFieldLength=n.view.getUint16(t+24,!0))))}function w(e,n){function t(){}function a(t,i){e.readUint8Array(e.size-t,t,function(e){var n=o(e.length,e).view;1347093766!=n.getUint32(0)?a(t+1,i):i(n)},function(){n(L)})}return t.prototype.getData=function(t,a,i,r){function s(e,n){_&&_.terminate(),_=null,e&&e(n)}function l(e){var n=o(4);return n.view.setUint32(0,e),m.crc32==n.view.getUint32(0)}function c(e,n){r&&!l(n)?d():t.getData(function(e){s(a,e)})}function d(){s(n,O)}function u(){s(n,E)}var _,m=this;e.readUint8Array(m.offset,30,function(a){var s,l=o(a.length,a);return 1347093252!=l.view.getUint32(0)?void n(S):(x(m,l,4,!1,n),s=m.offset+30+m.filenameLength+m.extraFieldLength,void t.init(function(){0===m.compressionMethod?g(e,t,s,m.compressedSize,r,c,i,d,u):_=f(e,t,s,m.compressedSize,r,c,i,d,u)},u))},d)},{getEntries:function(i){return e.size<22?void n(S):void a(22,function(a){var r,s;r=a.getUint32(16,!0),s=a.getUint16(8,!0),e.readUint8Array(r,e.size-r,function(e){var a,r,l,c,d=0,u=[],_=o(e.length,e);for(a=0;s>a;a++){if(r=new t,1347092738!=_.view.getUint32(d))return void n(S);x(r,_,d+6,!0,n),r.commentLength=_.view.getUint16(d+32,!0),r.directory=16==(16&_.view.getUint8(d+38)),r.offset=_.view.getUint32(d+42,!0),l=y(_.array.subarray(d+46,d+46+r.filenameLength)),r.filename=2048===(2048&r.bitFlag)?v(l):h(l),r.directory||"/"!=r.filename.charAt(r.filename.length-1)||(r.directory=!0),c=y(_.array.subarray(d+46+r.filenameLength+r.extraFieldLength,d+46+r.filenameLength+r.extraFieldLength+r.commentLength)),r.comment=2048===(2048&r.bitFlag)?v(c):h(c),u.push(r),d+=46+r.filenameLength+r.extraFieldLength+r.commentLength}i(u)},function(){n(L)})})},close:function(e){e&&e()}}}function P(e){return unescape(encodeURIComponent(e))}function A(e){var n,t=[];for(n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t}function k(e,n,t){function a(e,n){s&&s.terminate(),s=null,e&&e(n)}function i(){a(n,C)}function r(){a(n,O)}var s,l={},c=[],d=0;return{add:function(u,_,m,f,h){function v(n){var a;k=h.lastModDate||new Date,x=o(26),l[u]={headerArray:x.array,directory:h.directory,filename:w,offset:d,comment:A(P(h.comment||""))},x.view.setUint32(0,335546376),h.version&&x.view.setUint8(0,h.version),t||0===h.level||h.directory||x.view.setUint16(4,2048),x.view.setUint16(6,(k.getHours()<<6|k.getMinutes())<<5|k.getSeconds()/2,!0),x.view.setUint16(8,(k.getFullYear()-1980<<4|k.getMonth()+1)<<5|k.getDate(),!0),x.view.setUint16(22,w.length,!0),a=o(30+w.length),a.view.setUint32(0,1347093252),a.array.set(x.array,4),a.array.set(w,30),d+=a.array.length,e.writeUint8Array(a.array,n,i)}function y(n,t){var r=o(16);d+=n||0,r.view.setUint32(0,1347094280),"undefined"!=typeof t&&(x.view.setUint32(10,t,!0),r.view.setUint32(4,t,!0)),_&&(r.view.setUint32(8,n,!0),x.view.setUint32(14,n,!0),r.view.setUint32(12,_.size,!0),x.view.setUint32(18,_.size,!0)),e.writeUint8Array(r.array,function(){d+=16,a(m)},i)}function b(){return h=h||{},u=u.trim(),h.directory&&"/"!=u.charAt(u.length-1)&&(u+="/"),l.hasOwnProperty(u)?void n(N):(w=A(P(u)),c.push(u),void v(function(){_?t||0===h.level?g(_,e,0,_.size,!0,y,f,r,i):s=p(_,e,h.level,y,f,r,i):y()},i))}var x,w,k;_?_.init(b,r):b()},close:function(n){var t,r,s,u=0,_=0;for(r=0;r<c.length;r++)s=l[c[r]],u+=46+s.filename.length+s.comment.length;for(t=o(u+22),r=0;r<c.length;r++)s=l[c[r]],t.view.setUint32(_,1347092738),t.view.setUint16(_+4,5120),t.array.set(s.headerArray,_+6),t.view.setUint16(_+32,s.comment.length,!0),s.directory&&t.view.setUint8(_+38,16),t.view.setUint32(_+42,s.offset,!0),t.array.set(s.filename,_+46),t.array.set(s.comment,_+46+s.filename.length),_+=46+s.filename.length+s.comment.length;t.view.setUint32(_,1347093766),t.view.setUint16(_+8,c.length,!0),t.view.setUint16(_+10,c.length,!0),t.view.setUint32(_+12,u,!0),t.view.setUint32(_+16,d,!0),e.writeUint8Array(t.array,function(){a(function(){e.getData(n)})},i)}}}var I,S="File format is not recognized.",D="File contains encrypted entry.",F="File is using Zip64 (4gb+ file size).",L="Error while reading zip file.",C="Error while writing zip file.",E="Error while writing file data.",O="Error while reading file data.",N="File already exists.",M=524288,T="js/inflate.js",B="js/deflate.js",R="text/plain",U="message";try{I=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(j){}n.prototype.table=function(){var e,n,t,o=[];for(e=0;256>e;e++){for(t=e,n=0;8>n;n++)1&t?t=t>>>1^3988292384:t>>>=1;o[e]=t}return o}(),i.prototype=new a,i.prototype.constructor=i,r.prototype=new a,r.prototype.constructor=r,s.prototype=new a,s.prototype.constructor=s,l.prototype.getData=function(e){e(this.data)},c.prototype=new l,c.prototype.constructor=c,d.prototype=new l,d.prototype.constructor=d,u.prototype=new l,u.prototype.constructor=u,e.zip={Reader:a,Writer:l,BlobReader:s,Data64URIReader:r,TextReader:i,BlobWriter:u,Data64URIWriter:d,TextWriter:c,createReader:function(e,n,t){e.init(function(){n(w(e,t))},t)},createWriter:function(e,n,t,o){e.init(function(){n(k(e,t,o))},t)},workerScriptsPath:"",useWebWorkers:!0}}(this);var saveAs=saveAs||navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";var n=e.document,t=function(){return e.URL||e.webkitURL||e},o=e.URL||e.webkitURL||e,a=n.createElementNS("http://www.w3.org/1999/xhtml","a"),i=!e.externalHost&&"download"in a,r=function(t){var o=n.createEvent("MouseEvents");o.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(o)},s=e.webkitRequestFileSystem,l=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(n){(e.setImmediate||e.setTimeout)(function(){throw n},0)},d="application/octet-stream",u=0,_=[],m=function(){for(var e=_.length;e--;){var n=_[e];"string"==typeof n?o.revokeObjectURL(n):n.remove()}_.length=0},f=function(e,n,t){n=[].concat(n);for(var o=n.length;o--;){var a=e["on"+n[o]];if("function"==typeof a)try{a.call(e,t||e)}catch(i){c(i)}}},p=function(n,o){var c,m,p,g=this,h=n.type,v=!1,y=function(){var e=t().createObjectURL(n);return _.push(e),e},b=function(){f(g,"writestart progress write writeend".split(" "))},x=function(){(v||!c)&&(c=y(n)),m?m.location.href=c:window.open(c,"_blank"),g.readyState=g.DONE,b()},w=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},P={create:!0,exclusive:!1};return g.readyState=g.INIT,o||(o="download"),i?(c=y(n),a.href=c,a.download=o,r(a),g.readyState=g.DONE,void b()):(e.chrome&&h&&h!==d&&(p=n.slice||n.webkitSlice,n=p.call(n,0,n.size,d),v=!0),s&&"download"!==o&&(o+=".download"),(h===d||s)&&(m=e),l?(u+=n.size,void l(e.TEMPORARY,u,w(function(e){e.root.getDirectory("saved",P,w(function(e){var t=function(){e.getFile(o,P,w(function(e){e.createWriter(w(function(t){t.onwriteend=function(n){m.location.href=e.toURL(),_.push(e),g.readyState=g.DONE,f(g,"writeend",n)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&x()},"writestart progress write abort".split(" ").forEach(function(e){t["on"+e]=g["on"+e]}),t.write(n),g.abort=function(){t.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),x)}),x)};e.getFile(o,{create:!1},w(function(e){e.remove(),t()}),w(function(e){e.code===e.NOT_FOUND_ERR?t():x()}))}),x)}),x)):void x())},g=p.prototype,h=function(e,n){return new p(e,n)};return g.abort=function(){var e=this;e.readyState=e.DONE,f(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",m,!1),h}(self);"undefined"!=typeof module&&(module.exports=saveAs);var xml=function(){var e,n=function(n,o,i){n=a.escapeIllegalCharacters(n);var r="<";return 1==o&&(r+="/"),r+=e&&""!==e?e+":"+n:n,(0===o||2==o)&&(r+=t(i,n.length)),2==o&&(r+="/"),r+=">"},t=function(e,n){for(var t="",i=0;i<e.length;i++){if(0!==i){t+="\n",t+=o(a.tab);for(var r=0;n>r;r++)t+=" ";t+="  "}0===i&&(t+=" "),t+=a.escapeIllegalCharacters(e[i][0]),t+="=",t+='"',t+=a.escapeIllegalCharacters(e[i][1]),t+='"'}return t},o=function(e){return_string="";for(var n=0;e>n;n++)return_string+="   ";return return_string},a={};return a.header='<?xml version="1.0" encoding="UTF-8"?>\n',a.last_mode=-1,a.tab=0,a.reset=function(){a.last_mode=-1,a.tab=0,e=void 0},a.escapeIllegalCharacters=function(e){for(var n,t,o=[["&amp;","&"],["&lt;","<"],["&gt;",">"],["&apos;","'"],["&quot;",'"']],a=0;a<o.length;a++)n=o[a][1],t=o[a][0],e=replaceCharactersInStringWithSubstitute(e,n,t);return e},a.setElementPrefix=function(n){e="string"==typeof n&&""!==n?n:void 0},a.tag=function(e,t,i){i||(i=[]);var r="";return 1==t&&(a.tab-=1),1==t&&0===a.last_mode||-1==a.last_mode||(r+="\n",r+=o(a.tab)),r+=n(e,t,i),0===t&&(a.tab+=1),a.last_mode=t,r},a.element=function(e,n,t){var o="";return"undefined"==typeof n&&(n="undefined",console.warn("XML.Element: Value of "+e+" is undefined!")),n=a.escapeIllegalCharacters(n),""!==n?(o+=a.open(e,t),o+=n,o+=a.close(e)):o+=a.tag(e,2,t),o},a.open=function(e,n){return a.tag(e,0,n)},a.close=function(e){return a.tag(e,1)},a}(),linesToArray=function(e){for(var n=e.split("\n"),t=0;t<n.length;t++)n[t]=removeCharactersFromString(n[t],"\r");return n},getIndex=function(e,n,t){for(var o=0;o<e.length;o++)if(e[o][n]==t)return o;return void 0},getIndexByID=function(e,n){return getIndex(e,"id",n)},getObject=function(e,n,t){for(var o=0;o<e.length;o++)if(e[o][n]==t)return e[o];return void 0},getObjectByID=function(e,n){return getObject(e,"id",n)},map=function(e,n){for(var t=[],o=0;o<e.length;o++)t.push(n(e[o]));return t},getArrayWithValuesByKey=function(e,n){var t=map(e,function(e){return e[n]});return t},getArrayWithIDs=function(e){return getArrayWithValuesByKey(e,"id")},filter=function(e,n){for(var t=[],o=0;o<e.length;o++)n(e[o])&&t.push(e[o]);return t},forEach=function(e,n){for(var t=0;t<e.length;t++)n(e[t],t)},getSelectedRadioIndex=function(e){for(var n=0;n<e.length;n++)if(e[n].checked===!0)return n;return 0},getSelectedRadioValue=function(e){return e[getSelectedRadioIndex(e)].value},g=function(e){return document.getElementById(e)?document.getElementById(e):document.getElementsByName(e).length>0?document.getElementsByName(e):void 0},removeToInsertLater=function(e){var n=e.parentNode,t=e.nextSibling;return n.removeChild(e),function(){t?n.insertBefore(e,t):n.appendChild(e)}},removeCharactersFromString=function(e,n){for(var t,o,a=0;a<n.length;a++)for(t=n[a];-1!=e.indexOf(t);)o=e.indexOf(t),e=e.slice(0,o)+e.slice(o+1,e.length);return e},removeAllCharactersFromStringExcept=function(e,n){for(var t,o,a=0;a<e.length;)t=e[a],-1==n.indexOf(t)?(o=e.indexOf(t),e=e.slice(0,o)+e.slice(o+1,e.length)):a++;return e},replaceCharactersInStringWithSubstitute=function(e,n,t){for(var o,a=0;a<n.length;a++){o=n[a];for(var i=0;i<e.length;)e[i]!=o?i+=1:(e=e.slice(0,i)+t+e.slice(i+1),i+=t.length)}return e},parse_birth_date=function(e){var n,t,o;10!=e.length||"Unspecified"==e||"Unknown"==e?(n="YYYY",t="MM",o="DD"):(n=e.slice(0,4),t=e.slice(5,7),o=e.slice(8,10));var a={year:n,month:t,day:o};return a},dateAsString=function(e){var n=e.year,t=e.month,o=e.day;return 10>t&&(t="0"+t),10>o&&(o="0"+o),n+"-"+t+"-"+o},areOnlyTheseCharsInString=function(e,n){for(var t=0;t<e.length;t++)if(-1==n.indexOf(e[t]))return!1;return!0},dom=function(){var e={};return e.getSelectedRadioIndex=function(e){for(var n=0;n<e.length;n++)if(e[n].checked===!0)return n;return 0},e.getSelectedRadioValue=function(n){return"string"==typeof n&&(n=document.getElementsByName(n)),n[e.getSelectedRadioIndex(n)].value},e.makeRadios=function(n,t,o,a,i,r,s,l){for(var c,d,u=0;u<t.length;u++)c=e.input(n,a+u,"",o,"radio",t[u][r]),d=e.span(n,"",""," "+t[u][i]),u===s&&(c.checked=!0),e.br(n),d.addEventListener("click",function(e){return function(){e.checked=!0}}(c),!1),l&&(c.addEventListener("click",function(e){return function(){l(t[e].value)}}(u),!1),d.addEventListener("click",function(e){return function(){l(t[e].value)}}(u),!1))},e.removeOptions=function(e){var n;for(n=e.options.length-1;n>=0;n--)e.remove(n)},e.setRadiosByValue=function(e,n){for(var t=0;t<e.length;t++)if(e[t].value==n)return void(e[t].checked=!0);console.error("dom.setRadioByValue: Value "+n+" not available in radios!")},e.setRadioIndex=function(e,n){return"number"!=typeof n?void console.error("dom.setRadioIndex: index is not of type number but "+typeof n):void(e[n].checked=!0)},e.getOptionValuesOfSelect=function(e){var n=[];return forEach(e.options,function(e){n.push(e.value)}),n},e.br=function(n){var t=e.newElement("br","","",n);return t},e.img=function(n,t,o,a){var i=e.newElement("img",t,o,n);return i.src=a,i},e.div=function(n,t,o,a){var i=e.newElement("div",t,o,n,a);return i},e.span=function(n,t,o,a){var i=e.newElement("span",t,o,n,a);return i},e.spanBR=function(n,t,o,a){var i=e.span(n,t,o,a);return e.br(n),i},e.p=function(n,t,o,a){var i=e.newElement("p",o,a,n,t);return i},e.a=function(n,t,o,a,i,r){var s=e.newElement("a",t,o,n,i);return a&&(s.href=a),"undefined"!=typeof r&&s.addEventListener("click",r),s},e.link=function(n,t,o,a,i){var r=e.a(n,t,o,void 0,a,i);return r},e.h1=function(n,t){var o=e.newElement("h1","","",n,t);return o},e.h2=function(n,t){var o=e.newElement("h2","","",n,t);return o},e.h3=function(n,t){var o=e.newElement("h3","","",n,t);return o},e.h5=function(n,t){var o=e.newElement("h5","","",n,t);return o},e.input=function(n,t,o,a,i,r){var s=e.newElement("input",t,o,n);return s.type=i,s.name=a,"undefined"!=typeof r&&(s.value=r),s},e.checkbox=function(n,t,o,a,i){var r=e.input(n,t,o,a,"checkbox");return r.checked=i,r},e.textInput=function(n,t,o,a,i){return e.input(n,t,o,a,"text",i)},e.button=function(n,t,o){var a=e.input(n,"","","","button",t);return a.addEventListener("click",o,!1),a},e.textarea=function(n,t,o,a,i,r){var s=e.make("textarea",t,o,n);return s.rows=a,s.cols=i,s.value=r,s},e.newElement=function(e,n,t,o,a){var i=document.createElement(e);return""!==n&&(i.id=n),""!==t&&(i.className=t),"undefined"!=typeof o&&o.appendChild(i),a&&(i.innerHTML=a),i},e.make=e.newElement,e.remove=function(e){if("string"==typeof e){var n=e;e=g(n)}return"undefined"==typeof e?void console.error("dom.remove: Element undefined. id = "+n):e.parentNode.removeChild(e)},e.hideAllChildren=function(n){var t=n.children;forEach(t,e.hideElement)},e.showAllChildren=function(e){for(var n=e.children,t=0;t<n.length;t++)n[t].style.display=""},e.hideElement=function(e){e.style.display="none"},e.hide=e.hideElement,e.unhideElement=function(e){e.style.display=""},e.scrollTop=function(e){e.scrollTop=0
},e.setSelectOptions=function(n,t,o,a,i){var r;if(e.removeOptions(n),i===!0){var s=new Option("",0,!1,!0);n.options[n.options.length]=s}forEach(t,function(t,i){var s;r="undefined"!=typeof o?t[o]:t,"take_index"==o&&(r=i),s="undefined"!=typeof a?t[a]:t,"take_index"==a&&(s=i),e.appendOption(n,r,s)}),n.selectedIndex=0},e.appendOption=function(e,n,t){var o=new Option(n,t,!1,!0);e.options[e.options.length]=o},e.appendHTMLContent=function(n,t){if("string"==typeof t){var o=e.span(n,"","","");o.innerHTML+=t}"object"==typeof t&&"[object Array]"!==Object.prototype.toString.call(t)&&n.appendChild(t),"[object Array]"===Object.prototype.toString.call(t)&&forEach(t,function(t){e.appendHTMLContent(n,t)})},e.getByName=function(e){return document.getElementsByName(e)},e}(),ObjectList=function(){"use strict";var e=this,n=[],t=0,o=-1,a=function(){var e=t;return t+=1,e},i=function(e){var n={};for(var t in e)n[t]=e[t]&&"object"==typeof e[t]?i(e[t]):e[t];return n},r=function(){e.idExists(o)||(o=0),0==e.length&&(o=-1)};this.length=0,this.idExists=function(e){for(var t=0;t<n.length;t++)if(n[t].id==e)return!0;return!1},this.getByIndex=function(e){return n[e]},this.getByID=function(e){for(var t=0;t<n.length;t++)if(n[t].id==e)return n[t];return void 0},this.get=this.getByIndex,this.getFirst=function(){return n.length>0?n[0]:void 0},this.getLast=function(){return n.length>0?n[n.length-1]:void 0},this.getFromEnd=function(e){return e<n.length?n[n.length-1-e]:void 0},this.getAll=function(){return n},this.getByKeyValue=function(e,t){for(var o=0;o<n.length;o++)if(n[o][e]==t)return n[o];return void 0},this.getIndexByID=function(e){for(var t=0;t<n.length;t++)if(n[t].id==e)return t;return void 0},this.indexOf=this.getIndexByID,this.getArrayWithValuesByKey=function(e){var t=map(n,function(n){return n[e]});return t},this.getArrayWithIDs=function(){return e.getArrayWithValuesByKey("id")},this.idOf=function(e){return n[e].id},this.removeByID=function(t){if("array"==typeof t)return void t.forEach(e.removeByID);var o=e.getIndexByID(t);n.splice(o,1),e.length=n.length,r()},this.eraseByID=this.removeByID,this.removeByIndex=function(t){n.splice(t,1),e.length=n.length,r()},this.remove=this.removeByIndex,this.erase=this.removeByIndex,this.removeFirst=function(){e.removeByIndex(0)},this.removeLast=function(){n.length>0&&e.removeByID(n[n.length-1].id)},this.removeAll=function(){n=[],e.length=n.length,o=-1},this.removeActive=function(){e.removeByID(o)},this.eraseAll=this.removeAll,this.add=function(t){var o=a();return t.id=o,n.push(t),e.length=n.length,r(),o},this.replaceByID=function(t,o){var a=e.getIndexByID(t);"undefined"!=typeof a&&(o.id=t,n.splice(a,1,o))},this.replace=this.replaceByID,this.replaceActive=function(n){e.replaceByID(o,n)},this.duplicateByID=function(n){var t=i(e.getByID(n));e.add(t)},this.duplicate=this.duplicateByID,this.duplicateByIndex=function(n){var t=i(e.getByIndex(n));e.add(t)},this.duplicateActive=function(){e.duplicateByID(o)},this.forEach=function(e){n.forEach(e)},this.map=function(e){for(var t=[],o=0;o<n.length;o++)t.push(e(n[o]));return t},this.filter=function(e){for(var t=[],o=0;o<n.length;o++)e(n[o])&&t.push(n[o]);return t},this.reset=function(){n=[],t=0,o=-1,e.length=n.length},this.setState=function(a){return a&&a.list&&"object"==typeof a.list?(t=a.id_counter,n=a.list,e.length=n.length,void(o=a.pointer)):(console.error("Error setState: Invalid data!"),void console.info("typeof state.list = "+typeof a.list))},this.getState=function(){var e={id_counter:t,list:n,pointer:o};return e},this.sortByKey=function(e){return n.sort(function(n,t){var o=n[e],a=t[e];return"string"==typeof o&&(o=o.toLowerCase(),a=a.toLowerCase()),a>o?-1:o>a?1:0})},this.sortBySubKey=function(e,t){return n.sort(function(n,o){var a=n[e][t],i=o[e][t];return"string"==typeof a&&(a=a.toLowerCase(),i=i.toLowerCase()),i>a?-1:a>i?1:0})},this.isThereAnyItemWhereKeyIsValue=function(t,o){for(var a=0;a<n.length;a++)if(e.get(a)[t]==o)return!0;return!1},this.isThereAnyItemWhereKeyIsNotValue=function(t,o){for(var a=0;a<n.length;a++)if(e.get(a)[t]!=o)return!0;return!1},this.setPointer=function(n){e.idExists(n)&&(o=n)},this.setPointerByIndex=function(t){n[t]&&e.setPointer(n[t].id)},this.getPointer=function(){return o},this.getIndexOfActiveObject=function(){return e.getIndexByID(o)},this.getActiveIndex=this.getIndexOfActiveObject,this.getActiveObject=function(){return e.getByID(o)},this.getActive=this.getActiveObject,this.mapIndexesToIDs=function(e){var t=e.map(function(e){return n[e].id});return t},this.setForAll=function(e,t){n.forEach(function(n){n[e]=t})}},APP=function(){"use strict";var e={};e.init=function(n){var t;e.active_language=e.getActiveLanguageByNavigatorLanguageOrTakeDefault(),n||(t=e.save_and_recall.getRecallDataForApp(),t&&t.settings.active_language_id&&(e.active_language=e.getLPFromID(t.settings.active_language_id)),t&&t.version&&t.version!=APP.CONF.version&&(console.info("APP version is different than recall object version. APP version = "+APP.CONF.version+" , Recall Object version = "+t.version),e.log(e.l("start","you_are_now_using_version__before_version_number")+APP.CONF.version+e.l("start","you_are_now_using_version__after_version_number")))),e.renderStartPage(),e.checkIfFirstStart(),g("version_span").innerHTML=APP.CONF.version,g("settings_heading").innerHTML=e.l("settings","settings"),e.settings.init(e.coreSettings(),g("core_settings")),e.displayLanguages(),g("VIEWLINK_start").addEventListener("click",function(){e.view("VIEW_start")}),document.addEventListener("keydown",function(e){27==e.keyCode&&APP.GUI.closeSelectFrame()}),e.environments.displayAllInSelect(),n||"undefined"==typeof t||e.recall(t),e.GUI.mainMenu.draw(e.main_menu_elements()),window.addEventListener("beforeunload",e.save,!1),addScript(APP.CONF.path_to_scripts+APP.CONF.languageIndex_filename,function(){console.log("LanguageIndex ready!")})},e.getActiveLanguageByNavigatorLanguageOrTakeDefault=function(){var n=navigator.language,t=n.indexOf("-");-1!=t&&(n=n.substring(0,t));var o=getObject(e.languages,"code",n);return"undefined"!=typeof o?o:e.languages[0]},e.languages=[],e.getLPFromID=function(n){var t=getObject(e.languages,"id",n);return"undefined"==typeof t&&console.error("ERROR: No language object with id "+n+" found!"),t},e.getIndexFromLPID=function(n){var t=getIndex(e.languages,"id",n);return"undefined"==typeof t&&console.error("ERROR: No language object with id "+n+" found!"),t},e.active_view=void 0,e.active_language=void 0,e.views=[{id:"start",place:"top"},{id:"settings",icon:"wrench"},{id:"about",icon:"about"}],e.l=function(n,t,o,a){return e.getTermInActiveLanguage(e.languages,n,t,o,a)},e.getActiveLanguagePackFromID=function(e,n){return getObject(n,"id",e)};var n=function(e,n,t,o,a){return e?"undefined"==typeof e[n]?void 0:a?"undefined"!=typeof e[n][t][o][a]?e[n][t][o][a]:void 0:o?"undefined"!=typeof e[n]&&"undefined"!=typeof e[n][t][o]?e[n][t][o]:void 0:t?"undefined"!=typeof e[n]&&"undefined"!=typeof e[n][t]?e[n][t]:void 0:e[n]:void 0};return e.getTermInActiveLanguage=function(t,o,a,i,r){var s=e.getActiveLanguagePackFromID(e.active_language.id,t),l=n(s,o,a,i,r);if("undefined"!=typeof l)return l;console.warn("Haven't found a term in "+e.active_language.name+": "+o+(a?", "+a:"")+(i?", "+i:"")+(r?", "+r:"")+". Trying to get it in default language.");var c=t[0],d=n(c,o,a,i,r);return"undefined"!=typeof d?d:(console.error("LANGUAGE ERROR: "+o+(a?", "+a:"")+(i?", "+i:"")+(r?", "+r:"")),APP.CONF.language_error_placeholder)},e.main_menu_elements=function(){return[{title:e.l("open_file"),id:"LINK_open_file",icon:"open",onclick:function(){e.GUI.showFileDialog(APP.save_and_recall.loadFromFile)}},{title:e.l("export_to_file"),id:"LINK_export_to_file",icon:"save",onclick:function(){e.save_and_recall.saveActiveEnvironmentStateToFile()}},{title:e.l("settings","settings"),id:"VIEWLINK_settings",icon:"wrench",onclick:function(){APP.view("VIEW_settings")}},{title:e.l("about"),id:"VIEWLINK_about",icon:"about",onclick:function(){APP.view("VIEW_about")}}]},e.coreSettings=function(){return[{title:e.l("settings","program_language"),type:"select",name:"language_select",id:"language_select",onchange:function(){e.changeLanguage(g("language_select").selectedIndex)}},{title:e.l("settings","profile"),type:"select",name:"profile_select",id:"profile_select",onchange:function(){e.environments.change(g("profile_select").selectedIndex-1)}},{title:e.l("settings","auto_save"),radio_name:"radio_auto_save",type:"radio",options:[{title:e.l("settings","off"),value:-1},{title:e.l("settings","every_30_seconds"),value:30},{title:e.l("settings","every_60_seconds"),value:60},{title:e.l("settings","every_5_minutes"),value:300},{title:e.l("settings","every_10_minutes"),value:600}],default_option:2,onchange:e.save_and_recall.setAutosaveInterval},{title:e.l("settings","delete_recall_data"),type:"link",description:e.l("settings","delete_recall_data_description"),onclick:function(){e.save_and_recall.deleteEnvironmentData()}},{title:e.l("settings","hard_reset"),importance:"high",type:"link",description:e.l("settings","hard_reset_description"),onclick:function(){APP.confirm(e.l("confirm","hard_reset"),function(n){n||e.hard_reset()},e.l("confirm","no"),e.l("confirm","yes_delete_everything"))}}]},e.displayLanguages=function(){var n=g("language_select");dom.setSelectOptions(n,e.languages,"name","id",!1)},e.checkIfFirstStart=function(){var n=localStorage.getItem("first_start");null===n&&(n=!0),n===!0?(localStorage.setItem("first_start",!1),console.log("First start! Hey there and welcome to CMDI Maker!")):e.log(e.l("welcome_back"))},e.log=function(e,n){n||(n=""),alertify.log(e,n,APP.CONF.log_message_period)},e.confirm=function(e,n,t,o){alertify.set({labels:{ok:t,cancel:o}}),alertify.confirm(e,n)},e.alert=function(n){alertify.set({labels:{ok:e.l("ok")}}),alertify.alert(n)},e.renderStartPage=function(){var n=(g("VIEW_start"),Math.floor(Math.random()*APP.CONF.hellos.length));g("hello").innerHTML=APP.CONF.hellos[n][0],g("hello").addEventListener("click",function(){e.log(e.l("start","this_is","before_language")+APP.CONF.hellos[n][1]+e.l("start","this_is","after_language"))}),g("greeting_text").innerHTML=e.l("start","greeting_text"),g("start_select_profile_span").innerHTML=e.l("start","select_your_profile"),g("before_lets_go").innerHTML=e.l("start","and_lets_go__before_link"),g("link_lets_go").innerHTML=e.l("start","and_lets_go__link"),g("after_lets_go").innerHTML=e.l("start","and_lets_go__after_link"),g("supported_by_label").innerHTML=e.l("start","is_supported_by"),g("need_help_label").innerHTML=e.l("start","need_help"),g("help_pages_description").innerHTML=e.l("start","help_pages_description");var t=g("lang_links");forEach(e.languages,function(e,n){dom.link(t,"","",e.code.toUpperCase(),function(){APP.changeLanguage(n)}),dom.span(t,"","","  ")}),g("link_lets_go").addEventListener("click",function(){"undefined"==typeof e.environments.active_environment&&e.environments.create(e.environments.get(0)),e.environments.active_environment.workflow[0]?e.view(e.environments.active_environment.workflow[0]):console.error("ERROR: The active profile does not have a workflow!")})},e.hard_reset=function(){e.save_and_recall.deleteAllData(),window.removeEventListener("beforeunload",e.save),location.reload()},e.view=function(n){var t,o;if(e.GUI.closeSelectFrame(),e.GUI.mainMenu.close(),"undefined"==typeof n&&(console.warn("APP.view: module_or_id is undefined. Showing default view!"),n="default"),"string"==typeof n)o=n,t=e.environments.getModuleByViewID(o);else{if(!n.identity)return console.warn("APP.view: module to view is undefined!"),void APP.view("default");t=n,o=APP.CONF.view_id_prefix+t.identity.id}"default"==o&&(o="VIEW_start");var a=g(APP.CONF.content_wrapper_id).children;forEach(a,dom.hide);var i=getArrayWithIDs(a);return-1==i.indexOf(o)?(console.warn("Warning: Unkown view requested ("+o+")!"),void e.view("default")):(e.active_view=o,e.GUI.highlightViewIcon(o),g("module_icons").style.display="block",e.GUI.showFunctionsForView(t),g(o).style.display="block",g("pager")&&dom.remove("pager"),void(t&&t.view&&t.view()))},e.save=function(){e.save_and_recall.save()},e.save_file=function(e,n,t){var o=replaceAccentBearingLettersWithASCISubstitute(n);t||(t=APP.CONF.file_download_header);var a=new Blob([e],{type:t});saveAs(a,o)},e.zipAllOutputFiles=function(){var e,n=document.getElementsByClassName(APP.CONF.xml_textarea_class_name);e=""!==APP.environments.active_environment.getProjectName()?APP.environments.active_environment.getProjectName()+".zip":APP.CONF.zip_archive_file_name,zip.createWriter(new zip.BlobWriter,function(t){var o=function(e){var n=-1,t=function(){return n++,n==e.length?void e.callback():void e.functionToLoop(t,n)};t()};o({length:n.length,functionToLoop:function(e,o){t.add(n[o].filename,new zip.TextReader(n[o].value),e)},callback:function(){t.close(function(n){console.log("GOT ZIP BLOB"),saveAs(n,e)})}})},function(){})},e.saveAllOutputFiles=function(){var n=document.getElementsByClassName(APP.CONF.xml_textarea_class_name);forEach(n,function(n){e.save_file(n.value,n.filename)})},e.recall=function(n,t){if(console.log("Filling the form with recalled data"),n.settings.active_language_id){var o=e.getIndexFromLPID(n.settings.active_language_id);e.active_language=e.getLPFromID(n.settings.active_language_id),g("language_select").selectedIndex=o}if(dom.setRadiosByValue(g("radio_auto_save"),n.settings.save_interval_time),e.save_and_recall.setAutosaveInterval(n.settings.save_interval_time),n.active_environment_id){var a=e.environments.getByID(n.active_environment_id);e.environments.create(a),"undefined"==typeof t&&(t=e.save_and_recall.getRecallDataForEnvironment(a)),"undefined"!=typeof t&&e.save_and_recall.recallEnvironmentData(t)}e.view(n.active_view),g(APP.CONF.content_wrapper_id).scrollTop=n.scroll_top},e.changeLanguage=function(n){e.active_language=e.languages[n],location.reload()},e.doStandardLanguageSearch=function(n,t){if(n.length<3)return void APP.alert(e.l("languages","specify_search_request_at_least_3_chars"));for(var o=[],a=0;a<LanguageIndex.length;a++)isSubstringAStartOfAWordInString(LanguageIndex[a][3],n)&&o.push(LanguageIndex[a][0]);var i=LanguageIndex.filter(function(e){return-1!=o.indexOf(e[0])&&"L"==e[2]}),r=map(i,function(e){return e[0]+", "+e[1]+", "+e[3]}),s=e.l("languages","language_search")+": "+i.length+" "+(1==i.length?e.l("languages","result"):e.l("languages","results")),l="(ISO639-3 Code, Country ID, "+e.l("languages","language_name")+")";APP.GUI.showSelectFrame(i,r,t,s,l)},document.addEventListener("DOMContentLoaded",function(){e.init()},!1),window.addEventListener("load",function(){window.applicationCache.addEventListener("updateready",function(){window.applicationCache.status==window.applicationCache.UPDATEREADY?(window.applicationCache.swapCache(),window.location.reload()):console.log("Manifest file on server didn't change.")},!1)},!1),e}();APP.languages[0]={id:"english",name:"English",code:"en",settings:{settings:"Settings",profile:"Profile",auto_save:"Auto Save",off:"Off",every_30_seconds:"Every 30 seconds",every_60_seconds:"Every 60 seconds",every_5_minutes:"Every 5 minutes",every_10_minutes:"Every 10 minutes",load_project:"Load Project",load_project_description:"Loads a CMP file with CMDI Maker project data.",delete_recall_data:"Delete Recall Data",delete_recall_data_description:"CMDI Maker saves the data you input in a browser database. Your data is kept, even when you close the browser window.<br>However, if Auto Save is on, new data will be saved automatically.<br>This function only deletes the data from the active profile!",hard_reset:"Hard Reset",hard_reset_description:"Deletes all data that CMDI Maker has ever stored on your PC.",program_language:"Program Language",no_project_data_found_in_file:"No CMDI Maker data found in file!"},save_and_recall:{active_profile_data_deleted:"Recall data for active profile deleted",no_data_found:"No data for active profile found",form_saved:"Form saved",no_data_to_save_no_profile_loaded:"There is no data to save because no profile is loaded."},confirm:{no:"No",yes_delete_everything:"Yes, delete everything",yes_overwrite_data:"Yes, overwrite data",overwrite_data:"Really?<br>You want to overwrite all data?",hard_reset:"Really?<br>You want to hard reset CMDI Maker? All your actors and stuff will be deleted!"},on:"On",off:"Off",ok:"OK",welcome_back:"Welcome back!",about:"About",save:"Save",export_to_file:"Export Project to File",open_file:"Open Project File",abort:"Abort",start:{greeting_text:"Welcome to CMDI Maker!<br>Please note, that this is an offline web application. You can use it without an internet connection.<br>When you load this page, you can pick up where you left off.",and_lets_go__before_link:"and ",and_lets_go__link:"get started",and_lets_go__after_link:"!",is_supported_by:"CMDI Maker is supported by",need_help:"Need help?",help_pages_description:"On the help pages you will find video tutorials in several languages, a mailing list, go-to persons and much more!",select_your_profile:"Select your profile",this_is:{before_language:"This is ",after_language:"!"},you_are_now_using_version__before_version_number:"You are now using ",you_are_now_using_version__after_version_number:" of CMDI Maker."},language_search:{or_type_in_iso_code:"or type in ISO code",search:"Search"},forms:{drag_and_drop_files_here:"Drag and drop files here",this_character_is_not_allowed_here:"This character is not allowed here."},languages:{set_global_languages_of_content:"Set Global Languages of Content",language_search:"Language Search",result:"result",results:"results",language_name:"Language Name",is_new_global:"is a new Global Content Language",iso_code:"ISO code",not_found_in_db:"not found in database",specify_search_request_at_least_3_chars:"Please specify your search request.\nType in at least 3 characters.",primary_language:"Primary Language",mother_tongue:"Mother Tongue",current_content_languages:"Current Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" removed'}},APP.languages[1]={id:"german",name:"Deutsch",code:"de",settings:{settings:"Einstellungen",profile:"Profil",auto_save:"Automatische Speicherung",off:"Aus",every_30_seconds:"Alle 30 Sekunden",every_60_seconds:"Alle 60 Sekunden",every_5_minutes:"Alle 5 Minuten",every_10_minutes:"Alle 10 Minuten",load_project:"Projekt laden",load_project_description:"Lädt eine CMP-Datei und importiert ihre Projektdaten.",delete_recall_data:"Daten für den Rückruf löschen",delete_recall_data_description:"CMDI Maker speichert alle Daten, die du eingibst, in einer Browserdatenbank. Deine Daten bleiben also erhalten, auch wenn Du das Browserfenster schließt.<br>Wenn die automatische Speicherung jedoch aktiviert ist, werden automatisch neue Daten gespeichert.<br>Diese Funktion löscht nur die Daten des zur Zeit ausgewählten Profils!",hard_reset:"Hard Reset",hard_reset_description:"Diese Funktion löscht alle Daten, die der CMDI Maker jemals auf deinem PC gespeichert hat.",program_language:"Programmsprache",no_project_data_found_in_file:"In der Datei wurden keine Daten für den CMDI Maker gefunden!"},save_and_recall:{active_profile_data_deleted:"Daten des aktiven Profils gelöscht",no_data_found:"Keine Daten für das aktive Profil gefunden!",form_saved:"Eingaben gespeichert",no_data_to_save_no_profile_loaded:"Es gibt keine Daten zum Speichern, da kein Profil geladen ist."},confirm:{no:"Nein",yes_delete_everything:"Ja, alles löschen",yes_overwrite_data:"Ja, Daten überschreiben",overwrite_data:"Willst du das wirklich?<br>Alle deine Daten werden überschrieben!",hard_reset:"Willst du das wirklich?<br>Alle deine Daten werden gelöscht!"},on:"Ein",off:"Aus",ok:"OK",welcome_back:"Willkommen zurück!",about:"Über",save:"Speichern",export_to_file:"Projekt in Datei exportieren",open_file:"Projektdatei öffnen",abort:"Abbrechen",start:{greeting_text:"Willkommen!<br>Dies ist eine Offline-Webanwendung. Du kannst sie fortan auch ohne Internetverbindung nutzen.<br>Wenn Du diese Seite lädst, kannst du genau dort weitermachen, wo du aufgehört hast.",and_lets_go__before_link:"und ",and_lets_go__link:"leg los",and_lets_go__after_link:"!",is_supported_by:"CMDI Maker wird unterstützt von",need_help:"Brauchst Du Hilfe?",help_pages_description:"Auf den Hilfe-Seiten findest Du Video-Tutorials in verschiedenen Sprachen, eine Mailing-Liste, Ansprechpartner und vieles mehr!",select_your_profile:"Wähle dein Profil",this_is:{before_language:"Das ist ",after_language:"!"},you_are_now_using_version__before_version_number:"Du benutzt nun ",you_are_now_using_version__after_version_number:" von CMDI Maker."},language_search:{or_type_in_iso_code:"oder gib den ISO-Code ein",search:"Suchen"},forms:{drag_and_drop_files_here:"Ziehe Dateien in dieses Feld",this_character_is_not_allowed_here:"Dieses Zeichen ist hier nicht erlaubt."},languages:{set_global_languages_of_content:"Globale Content Language hinzufügen",language_search:"Sprachsuche",result:"Ergebnis",results:"Ergebnisse",language_name:"Sprachname",is_new_global:"ist neue globale Content Language",iso_code:"ISO-Code",not_found_in_db:"wurde nicht gefunden",specify_search_request_at_least_3_chars:"Bitte sei etwas genauer.\nGib mindestens 3 Zeichen ins Suchfeld ein.",primary_language:"Primärsprache",mother_tongue:"Muttersprache",current_content_languages:"Derzeitige Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" entfernt'}},APP.languages[2]={id:"spanish",name:"Español",code:"es",settings:{settings:"Configuración",profile:"Perfíl",auto_save:"Guardar automáticamente",off:"Apagado",every_30_seconds:"Cada 30 segundos",every_60_seconds:"Cada 60 segundos",every_5_minutes:"Cada 5 minutos",every_10_minutes:"Cada 10 minutos",load_project:"Guardar proyecto",load_project_description:"Esta opción carga un archivo CMP (CMDI Maker Project) junto con los datos del proyecto.",delete_recall_data:"Eliminar datos guardados",delete_recall_data_description:"CMDI Maker guarda los datos que se introducen en la base de datos de un navegador, y los guardará aun cuando se cierre el navegador.<br>De todas formas, si la opción Guardar automáticamente está seleccionada, los nuevos datos serán guardados automáticamente.<br>¡Esta función elimina solamente los datos pertenecientes al perfil activo!",hard_reset:"Reseteo completo",hard_reset_description:"Esta opción elimina todos los datos que CMDI Maker ha almacenado en su ordenador.",program_language:"Lenguaje del programa",no_project_data_found_in_file:"¡No se encontró ningún dato para CMDI Maker en el archivo!"},save_and_recall:{active_profile_data_deleted:"Datos pertenecientes al perfíl activo eliminados",no_data_found:"No se encontró ningún dato para el perfíl activo",form_saved:"Formulario guardado"},confirm:{no:"No",yes_delete_everything:"Sí, eliminar todo",yes_overwrite_data:"Sí, sobrescribir los datos",overwrite_data:"¿Quiere realmente sobrescribir todos los datos?",hard_reset:"¿Quieres realmente resetear CMDI Maker por completo? ¡Todos los datos serán eliminados!"},on:"Encendido",off:"Apagado",ok:"OK",welcome_back:"¡Bienvenido de nuevo!",about:"Acerca de",save:"Guardar",export_to_file:"Exportar a archivo",open_file:"Abrir archivo",abort:"Annular",start:{greeting_text:"Bienvenidos al CMDI Maker!<br>Fígese, ésta es una aplicación que se puede utilizar también sin conexión.<br>Cuando cargue esta página, podrá reanudar su trabajo en el punto donde lo interrumpió.",and_lets_go__before_link:"¡y ",and_lets_go__link:"vamos a empezar",and_lets_go__after_link:"!",is_supported_by:"CMDI Maker está financiado por",need_help:"¿Necesita ayuda?",help_pages_description:"En las páginas de ayuda encontrará videos tutoriales, una lista de correo electrónico y de personas para consultar en caso de necesidad, ¡y mucho más!",select_your_profile:"Seleccione su perfíl",this_is:{before_language:"Esto es ",after_language:"!"}},language_search:{or_type_in_iso_code:"o bien ingresar un código ISO",search:"Buscar"},forms:{drag_and_drop_files_here:"Arrastrar y soltar los archivos aquí"},languages:{set_global_languages_of_content:"Establecer Content Language global",language_search:"Buscar lengua",result:"resultado",results:"resultados",language_name:"Nombre de la lengua",is_new_global:"es un nuevo Content Language global",iso_code:"Código ISO",not_found_in_db:"no se encontró en la base de datos",specify_search_request_at_least_3_chars:"Por favor especifique su búsqueda.\nIngrese por lo menos 3 caracteres.",primary_language:"Lengua principal",mother_tongue:"Lengua materna",current_content_languages:"Content Languages corrientes",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" eliminada'}},APP.environments=function(){"use strict";var e=function(e){var t=getIndex(n.environments,"id",e.id);return"undefined"==typeof t?console.log("Environment "+e.id+" not found in APP.environments"):t},n={};return n.disabled_functions=[],n.environments=[],n.active_environment=void 0,n.isAnEnvironmentLoaded=function(){return"undefined"!=typeof n.active_environment?!0:!1},n.displayAllInSelect=function(){var e=g("profile_select"),t=g("start_profile_select");dom.setSelectOptions(e,n.environments,"title","id",!0),dom.setSelectOptions(t,n.environments,"title","id",!1),t.addEventListener("change",function(){n.change(t.selectedIndex)})},n.getModuleByViewID=function(e){if("undefined"!=typeof n.active_environment)for(var t=0;t<n.active_environment.workflow.length;t++)if(APP.CONF.view_id_prefix+n.active_environment.workflow[t].identity.id==e)return n.active_environment.workflow[t];return void 0},n.resetActive=function(){n.active_environment&&n.active_environment.reset&&n.active_environment.reset(),forEach(n.active_environment.workflow,function(e){"undefined"!=typeof e.reset&&e.reset()})},n.unloadActive=function(){return n.active_environment?(console.log("Unloading active environment: "+n.active_environment.id),APP.save(),g("environment_settings").innerHTML="",forEach(n.active_environment.workflow,function(e){dom.remove(APP.CONF.view_id_prefix+e.identity.id)}),g("functions").innerHTML="",g("module_icons").innerHTML="",n.active_environment=void 0,g("profile_select").selectedIndex=0,void APP.view("VIEW_start")):void console.warn("APP.environments.unloadActive called although there is no environment loaded!")},n.create=function(t){if("undefined"==typeof t)return void console.warn("APP.environments.create: Environment parameter is undefined!");if("undefined"!=typeof n.active_environment){if(t.id==n.active_environment.id)return void console.log("Environment to be created is already active: "+n.active_environment.id);n.unloadActive()}n.active_environment=t,console.log("Creating environment: "+t.id),n.initSettings(t.settings()),t.init&&t.init(),n.createWorkflow(t.workflow);var o=e(t);g("profile_select").selectedIndex=o+1,g("start_profile_select").selectedIndex=o,APP.view("default")},n.initSettings=function(e){APP.settings.init(e,g("environment_settings"))},n.createWorkflow=function(e){forEach(e,n.createWorkflowModule),n.createWorkflowDisplay(e)},n.createWorkflowModule=function(e){var t=dom.newElement("div",APP.CONF.view_id_prefix+e.identity.id,"content",g(APP.CONF.content_wrapper_id));e.functions&&n.initFunctions("function"==typeof e.functions?e.functions():e.functions),e.init&&e.init(t)},n.createWorkflowDisplay=function(e){for(var n=g("module_icons"),t=0;t<e.length;t++){if(0!==t){var o=dom.newElement("div","","wizard_arrow",n);APP.GUI.icon(o,"","wizard_icon","right2")}var a=dom.newElement("div",APP.CONF.viewlink_id_prefix+e[t].identity.id,"icon_div",n);APP.GUI.icon(a,"","module_icon",e[t].identity.icon),dom.br(a),dom.span(a,"","",e[t].identity.title),a.addEventListener("click",function(e){return function(){APP.view(e)}}(e[t]))}},n.getByID=function(e){return getObjectByID(n.environments,e)},n.get=function(e){return n.environments[e]},n.changeByID=function(e){var t=n.getIndexFromID(e);n.change(t)},n.change=function(e){if(APP.save(),-1==e)return void n.unloadActive();if("undefined"!=typeof n.active_environment){if(n.environments[e].id==n.active_environment.id)return void console.log("Environment does not have to be changed because it is already active: "+n.active_environment.id);n.unloadActive()}APP.GUI.scrollTop(),n.create(n.environments[e])},n.getIndexFromID=function(e){var t=getIndex(n.environments,"id",e);return"undefined"==typeof t&&console.error("ERROR: Unknown environment id: "+e),t},n.initFunctions=function(e){var t=g("functions");forEach(e,function(e){n.createFunction(t,e)})},n.disableFunction=function(e){-1==n.disabled_functions.indexOf(e)&&(n.disabled_functions.push(e),APP.GUI.showFunctionsForView(APP.environments.getModuleByViewID(APP.active_view)))},n.enableFunction=function(e){-1!=n.disabled_functions.indexOf(e)&&(n.disabled_functions.splice(n.disabled_functions.indexOf(e),1),APP.GUI.showFunctionsForView(APP.environments.getModuleByViewID(APP.active_view)))},n.createFunction=function(e,n){var t;if("function_wrap"!=n.type){t=dom.make("div",n.id,"function_icon",e),APP.GUI.icon(t,"","function_img",n.icon);var o=dom.h3(t,n.label);n.label_span_id?dom.make("span",n.label_span_id,"",o):n.label&&(o.innerHTML=n.label),t.addEventListener("click",n.onclick)}else{var a=dom.div(e,n.wrapper_id,"function_wrap");t=dom.div(a,n.id,"function_icon"),APP.GUI.icon(t,"","function_img",n.icon),dom.h3(t,n.label),t.addEventListener("click",n.onclick);var i=dom.make("div",n.sub_div,"function_sub_div",a);n.sub_div_innerHTML&&(i.innerHTML=n.sub_div_innerHTML),t.addEventListener("mousedown",function(e){return function(){e.style.backgroundColor="black"}}(t)),t.addEventListener("mouseup",function(e){return function(){e.style.backgroundColor=""}}(t))}n.after_that&&n.after_that()},n.add=function(e){n.environments.push(e)},n}(),APP.forms=function(){"use strict";var e=function(e,n){var t;return t="undefined"!=typeof e?e:n.default_value?n.default_value:"check"==n.type?!1:"date"==n.type?{year:"YYYY",month:"MM",day:"DD"}:""},n=function(e,n){var t;return t=n.name&&""!==n.name?"undefined"!=typeof e&&e[n.name]?e[n.name]:void 0:e?e:void 0},t={text:function(e,n,t,o,a){var i;return i=APP.GUI.makeTextInput(e,n.heading,t+n.name,t+n.name,a&&a[n.name]?a[n.name]:"",n.comment,n.maxLength),a&&i.addEventListener("blur",function(){a[n.name]=i.value}),i},year:function(e,n,t,o,a){var i;return i=APP.GUI.makeYearInput(e,n.heading,t+n.name,t+n.name,a&&a[n.name]?a[n.name]:"YYYY",n.comment),a&&i.addEventListener("blur",function(){a[n.name]=i.value}),i},date:function(e,n,t,o,a){var i;i=APP.GUI.makeDateInput(e,n.heading,t+n.name,t+n.name,a&&a[n.name]?a[n.name].year:"",a&&a[n.name]?a[n.name].month:"",a&&a[n.name]?a[n.name].day:"",n.comment),a&&(i.year.addEventListener("blur",function(){a[n.name].year=i.year.value}),i.month.addEventListener("blur",function(){a[n.name].month=i.month.value}),i.day.addEventListener("blur",function(){a[n.name].day=i.day.value}));var r="0123456789";return i.year.onkeypress=function(e){var n=String.fromCharCode(e.which);return-1==r.indexOf(n)?(APP.log(APP.l("forms","this_character_is_not_allowed_here"),"error"),!1):void 0},i.month.onkeypress=function(e){var n=String.fromCharCode(e.which);return-1==r.indexOf(n)?(APP.log(APP.l("forms","this_character_is_not_allowed_here"),"error"),!1):void 0},i.day.onkeypress=function(e){var n=String.fromCharCode(e.which);return-1==r.indexOf(n)?(APP.log(APP.l("forms","this_character_is_not_allowed_here"),"error"),!1):void 0},i},textarea:function(e,n,t,o,a){var i;return i=APP.GUI.makeTextarea(APP.CONF.form_textarea_columns,APP.CONF.form_textarea_rows,e,n.heading,t+n.name,t+n.name,t+n.name,a&&a[n.name]?a[n.name]:"",n.comment),a&&i.addEventListener("blur",function(){a[n.name]=i.value}),i},subarea:function(e,n,t,o,a,r){var s=dom.h3(e,n.heading);n.comment&&(s.title=n.comment),n.fields&&(n.name&&""!==n.name&&(t+=n.name+"_"),i(n.fields,e,t,o,a[n.name],r))},column:function(e,n,t,o,a,r){var s;s=n.name&&""!==n.name?n.name+"_td":"td";
var l=dom.make("td",t+s,o+s,e);n.title&&""!==n.title&&dom.make("h2","","",l,n.title),n.fields&&(n.name&&""!==n.name&&(t+=n.name+"_"),i(n.fields,l,t,o,a?a[n.name]:void 0,r))},form:function(e,n,t,o,a,r){var s;if(n.fields&&"column"==n.fields[0].type){var l=dom.make("table",t+"table","session_table",e),c=dom.make("tr","","",l);s=c}else s=e;i(n.fields,s,t,o,a,r)},special:function(e,n,t,o,a,i){return i?void i(n,e,t,o):(console.error("APP.forms.make: Form Template has special fields, but no method on_special has been specified!"),console.error("field: "),console.error(n),void console.error("element_id_prefix: "+t))},select:function(e,n,t,o,a){var i;return i=APP.GUI.makeSelect(e,n.heading,t+n.name,t+n.name,n.size,n.vocabulary,a&&a[n.name]?a[n.name]:n.default_value,n.comment),a&&i.addEventListener("blur",function(){a[n.name]=get(i.name)}),i},open_vocabulary:function(e,n,t,o,a){var i,r;return a&&a[n.name]?i=a[n.name]:n.default_value&&(i=n.default_value),r=APP.GUI.openVocabulary(e,n.heading,t+n.name,t+n.name,n.size,n.vocabulary,i,n.comment),a&&(r.text.addEventListener("blur",function(){a[n.name]=r.text.value}),r.select.addEventListener("blur",function(){a[n.name]=get(r.select.name)})),r},check:function(e,n,t,o,a){var i;return i=APP.GUI.makeCheckbox(e,n.heading,t+n.name,t+n.name,a&&a[n.name]?a[n.name]:!1,n.comment),a&&i.addEventListener("blur",function(){console.log(i),a[n.name]=i.checked}),i}},o=function(e,n){n[e.name]=e.default_value?e.default_value:""},a={select:o,open_vocabulary:o,textarea:o,text:o,year:function(e,n){n[e.name]=e.default_value?e.default_value:"YYYY"},check:function(e,n){n[e.name]=!1},form:function(e){var n={};return r(e.fields,n),n},column:function(e,n){var t;e.name&&""!==e.name?(t={},n[e.name]=t):t=n,r(e.fields,t)},subarea:function(e,n){var t=e.name;n[t]={},r(e.fields,n[t])},date:function(e,n){var t={year:"",month:"",day:""};n[e.name]=t},special:function(e,n){"array"==e.object_structure?n[e.name]=[]:"object"==e.object_structure?(n[e.name]={},e.object_arrays&&forEach(e.object_arrays,function(t){n[e.name][t]=[]})):n[e.name]=null}},i=function(e,n,t,o,a,i){forEach(e,function(e){l.make(n,e,t,o,a,i)})},r=function(e,n){"undefined"!=typeof e&&forEach(e,function(e){l.createEmptyObjectFromTemplate(e,n)})},s=function(e,n,t){forEach(e,function(e){l.fillObjectWithFormData(n,t,e)})},l={};return l.make=function(e,n,o,a,i,r){var s;return t[n.type]?(s=t[n.type](e,n,o,a,i,r),n.not_allowed_chars&&(s.onkeypress=function(e){var t=String.fromCharCode(e.which);return n.not_allowed_chars.indexOf(t)>=0?(APP.log(APP.l("forms","this_character_is_not_allowed_here"),"error"),!1):void 0},s.addEventListener("blur",function(e){var t=removeCharactersFromString(e.target.value,n.not_allowed_chars);s.value=t})),void(n.allowed_chars&&(s.onkeypress=function(e){var t=String.fromCharCode(e.which);return-1==n.allowed_chars.indexOf(t)&&0!=e.charCode?(APP.log(APP.l("forms","this_character_is_not_allowed_here"),"error"),!1):void 0},s.addEventListener("blur",function(e){var t=e.target.value;n.replace_accent_bearing_letters_with_asci_substitute&&1==n.replace_accent_bearing_letters_with_asci_substitute&&(t=replaceAccentBearingLettersWithASCISubstitute(t)),t=removeAllCharactersFromStringExcept(t,n.allowed_chars),s.value=t})))):void console.error("ERROR: APP.forms.make: Field type not supported! Field type = "+n.type)},l.fill=function(t,o,a,i){var r;"column"==t.type&&t.name&&""!==t.name&&(o+=t.name+"_"),("form"==t.type||"subarea"==t.type||"column"==t.type)&&forEach(t.fields,function(e){r=n(a,e),l.fill(e,o,r)}),("year"==t.type||"text"==t.type||"textarea"==t.type||"select"==t.type||"open_vocabulary"==t.type||"check"==t.type)&&(r=e(a,t),APP.GUI.setFormValue(o+t.name,r,t.vocabulary)),"date"==t.type&&(r=e(a,t),g(o+t.name+"_year").value=""!=r.year?r.year:"YYYY",g(o+t.name+"_month").value=""!=r.month?r.month:"MM",g(o+t.name+"_day").value=""!=r.day?r.day:"DD"),"special"==t.type&&i&&i(t,o,a)},l.createEmptyObjectFromTemplate=function(e,n){return a[e.type]?a[e.type](e,n):void console.log("ERROR: createEmptyObjectFromTemplate: field.type not defined: "+e.type)},l.makeObjectWithFormData=function(e,n){var t=l.createEmptyObjectFromTemplate(e);return l.fillObjectWithFormData(t,n,e),t},l.fillObjectWithFormData=function(e,n,t,o){var a;("year"==t.type||"text"==t.type||"textarea"==t.type||"select"==t.type||"open_vocabulary"==t.type)&&(e[t.name]=get(n+t.name)),"check"==t.type&&(e[t.name]=g(n+t.name).checked),"date"==t.type&&(e[t.name].year=get(n+t.name+"_year"),e[t.name].month=get(n+t.name+"_month"),e[t.name].day=get(n+t.name+"_day")),"column"==t.type&&(t.name&&""!==t.name&&(n+=t.name+"_"),s(t.fields,e,n)),"subarea"==t.type&&(t.name&&""!==t.name&&(n+=t.name+"_"),s(t.fields,e[t.name],n)),"form"==t.type&&forEach(t.fields,function(t){a=!t.name||""===t.name||"column"!=t.type&&"subarea"!=t.type?e:e[t.name],l.fillObjectWithFormData(a,n,t)}),"special"==t.type&&o&&o(e,n,t)},l.getDateStringByDateInput=function(e){var n={};return n.year=g(e+"_year").value,n.month=g(e+"_month").value,n.day=g(e+"_day").value,getDateStringByDateObject(n)},l.getDateStringByDateObject=function(e){if(!e||!e.month||!e.day)return void 0;var n="0123456789";return 4==e.year.length&&areOnlyTheseCharsInString(e.year,n)&&2==e.month.length&&areOnlyTheseCharsInString(e.month,n)&&2==e.day.length&&areOnlyTheseCharsInString(e.day,n)?e.year+"-"+e.month+"-"+e.day:void 0},l.isUserDefinedDateInvalid=function(e){var n,t,o,a;if("string"==typeof e){var i=e;n=get(i+"_year"),t=get(i+"_month"),o=get(i+"_day"),a=typeof l.getDateStringByDateInput(i)}else{var r=e;n=r.year,t=r.month,o=r.day,a=typeof l.getDateStringByDateObject(r)}return"undefined"!=a||"YYYY"==n&&"MM"==t&&"DD"==o?!1:!0},l}(),APP.GUI=function(){var e=APP.l,n={};return n.showBusyIndicator=function(e){g("busy_div")&&dom.remove("busy_div"),e.innerHTML="";var n=dom.div(e,"busy_div","busy_div"),t=dom.p(n,"","","center"),o=dom.img(t,"busy_icon","busy_icon","img/busy.svg");o.width="700",o.height="300"},n.setIcon=function(e,n){e.src=APP.CONF.path_to_icons+n+".png"},n.setFormValue=function(e,t,o){var a,i=g(e);if("SELECT"==i.nodeName){var r=[];forEach(i.options,function(e){r.push(e.value)}),-1==r.indexOf(t)?(a=n.changeOVInput(e,r),a.value=t):i.value=t}else"text"==i.type&&o&&-1!=o.indexOf(t)?(a=n.changeOVInput(e,o),a.value=t):"checkbox"==i.type?i.checked=t:i.value=t},n.makeTextInput=function(e,n,t,o,a,i,r){var s=dom.spanBR(e,"","",n);i&&(s.title=i);var l=dom.input(e,o,"",t,"text",a);return i&&(l.title=i),r&&(l.maxLength=r),dom.br(e),l},n.makeYearInput=function(e,n,t,o,a,i){var r=dom.spanBR(e,"","",n);i&&(r.title=i);var s=dom.input(e,o,"YearInput",t,"text",""!==a?a:"YYYY");return i&&(s.title=i),s.maxLength=4,dom.br(e),s},n.makeCheckbox=function(e,n,t,o,a,i){var r=dom.input(e,o,"",t,"checkbox");r.checked=a,i&&(r.title=i);var s=dom.spanBR(e,"","",n);return i&&(s.title=i),r},n.openVocabulary=function(e,t,o,a,i,r,s,l,c){if(l||(l=""),"undefined"!=typeof t){var d=dom.spanBR(e,"","",t);d.title=l}var u=document.createElement("select");u.name=o,u.id=a,u.className=c,u.size=i,l&&(u.title=l),dom.setSelectOptions(u,r),u.selectedIndex="undefined"!=typeof s&&-1!=r.indexOf(s)?r.indexOf(s):0;var _=document.createElement("input");_.name=o,_.id=a,_.className=c,_.type="text",l&&(_.title=l),"undefined"==typeof s||-1!=r.indexOf(s)?e.appendChild(u):(_.value=s,e.appendChild(_));var m=n.icon(e,"","edit_img","textedit");m.alt="Custom Property",m.title="Custom Property",m.addEventListener("click",function(){document.contains(u)?(dom.remove(u),e.insertBefore(_,m)):(dom.remove(m.previousSibling),e.insertBefore(u,m))}),dom.br(e);var f={text:_,select:u};return f},n.makeLanguageSearchForm=function(t,o,a,i,r){var s=APP.doStandardLanguageSearch,l=n.addLanguageByISOCode,c=dom.make("p","","",t),d=dom.make("input",o+"input","language_input",c);d.type="text",d.size=1,d.name=o+"input",dom.make("span","","",c," ");var u=dom.make("input",o+"search_button","language_search_button",c);u.type="button",u.value=e("language_search","search"),a&&a===!0?dom.make("span","","",c," "):dom.br(c),dom.make("span","","",c,e("language_search","or_type_in_iso_code")+" ");var _=dom.make("input",o+"iso_input","language_iso_input",c);_.type="text",_.size=1,_.name=o+"iso_input",dom.make("span","","",c," ");var m=dom.make("input",o+"iso_ok","language_iso_add_button",c);m.type="button",m.value=e("ok"),i||dom.make("div",o+"display","",t),u.addEventListener("click",function(){s(d.value,r)}),m.addEventListener("click",function(){l(_,r)}),d.onkeydown=function(e){13==e.keyCode&&s(d.value,r)},_.onkeydown=function(e){13==e.keyCode&&l(_,r)}},n.addLanguageByISOCode=function(t,o){var a=t.value.toLowerCase();console.log("ADDING ISO LANGUAGE "+a);for(var i=0;i<LanguageIndex.length;i++)if(LanguageIndex[i][0]==a&&"L"==LanguageIndex[i][2])return o(LanguageIndex[i]),void(t.value="");return n.isISOCodeReservedForLocalUse(a)===!0?(o([a,"","LOCAL",""]),void(t.value="")):void APP.alert(e("languages","iso_code")+" "+a+" "+e("languages","not_found_in_db")+".")},n.isISOCodeReservedForLocalUse=function(e){return 3!=e.length?!1:"q"!=e[0]?!1:-1=="abcdefghijklmnopqrst".indexOf(e[1])?!1:-1=="abcdefghijklmnopqrstuvwxyz".indexOf(e[2])?!1:!0},n.icon=function(e,t,o,a,i){var r=dom.make("img",t,o,e);return n.setIcon(r,a),i&&r.addEventListener("click",i,!1),r},n.copyField=function(e,t){var o=get(t),a=document.getElementsByName(t)[0],i=document.getElementsByName(e)[0];if(a.nodeName!=i.nodeName){var r;"SELECT"==a.nodeName&&(r=n.getOptionValuesOfSelect(a));var s=document.createElement(a.nodeName);s.name=i.name,s.className=i.className,i.parentNode.insertBefore(s,i),dom.remove(i),"SELECT"==s.nodeName?(dom.setSelectOptions(s,r),s.selectedIndex=r.indexOf(o)):s.value=o}else i.value=o},n.changeOVInput=function(e,n){var t,o=g(e);return"SELECT"==o.nodeName?(t=document.createElement("input"),t.type="text"):(t=document.createElement("select"),dom.setSelectOptions(t,n)),t.id=o.id,t.name=o.name,t.className=o.className,o.parentNode.insertBefore(t,o),dom.remove(o),t},n.makeSelect=function(e,n,t,o,a,i,r,s){s||(s="");var l=dom.spanBR(e,"","",n);l.title=s;var c=document.createElement("select");return c.name=t,c.id=o,c.size=a,c.title=s,e.appendChild(c),dom.br(e),dom.setSelectOptions(c,i),c.selectedIndex="undefined"!=typeof r&&-1!=i.indexOf(r)?i.indexOf(r):0,c},n.makeDateInput=function(e,n,t,o,a,i,r,s){var l;s||(s=""),l=dom.spanBR(e,"","",n),l.title=s;var c=dom.input(e,o+"_year","YearInput",t+"_year","text",""!==a?a:"YYYY");c.title=s,c.maxLength=4,l=dom.span(e,"",""," "),l.title=s;var d=dom.input(e,o+"_month","MonthInput",t+"_month","text",""!==i?i:"MM");d.title=s,d.maxLength=2,l=dom.span(e,"",""," "),l.title=s;var u=dom.input(e,o+"_day","DayInput",t+"_day","text",""!==r?r:"DD");return u.title=s,u.maxLength=2,dom.br(e),return_object={year:c,month:d,day:u}},n.makeTextarea=function(e,n,t,o,a,i,r,s,l){l||(l="");var c=dom.spanBR(t,"","",o);c.title=l;var d=dom.make("textarea",i,r,t);return d.name=a,d.value=s,d.cols=e,d.rows=n,d.title=l,dom.br(t),d},n.makeAllFunctionsInvisible=function(){var e=g(APP.CONF.functions_div_id).children;forEach(e,dom.hideElement)},n.hideFunctionsDIV=function(){g(APP.CONF.functions_div_id).style.height="0px",g(APP.CONF.content_wrapper_id).style.bottom="0px",g(APP.CONF.log_section_id)&&(g(APP.CONF.log_section_id).style.bottom="10px")},n.showFunctionsDIV=function(){g(APP.CONF.functions_div_id).style.height=APP.CONF.functions_div_height,g(APP.CONF.content_wrapper_id).style.bottom=APP.CONF.functions_div_height,g(APP.CONF.log_section_id)&&(g(APP.CONF.log_section_id).style.bottom="50px")},n.showFunctionsForView=function(e){if(n.makeAllFunctionsInvisible(),!e)return void n.hideFunctionsDIV();if(e.functions){n.showFunctionsDIV();var t=e.functions;"function"==typeof t&&(t=t()),forEach(t,n.renderFunctionIfNotDisabled)}},n.renderFunctionIfNotDisabled=function(e){var t;t="function_wrap"==e.type?e.wrapper_id:e.id,-1==APP.environments.disabled_functions.indexOf(t)&&n.renderFunction(e)},n.renderFunction=function(e){if("function_wrap"==e.type){g(e.wrapper_id).style.display="inline";var n=g(e.wrapper_id).children[0].getBoundingClientRect();g(e.wrapper_id).children[1].style.left=n.left+"px",g(e.wrapper_id).children[1].style.minWidth=n.width-30+"px"}else g(e.id).style.display="inline"},n.closeSelectFrame=function(){if(g(APP.CONF.select_frame_id)){var e=g(APP.CONF.select_frame_id).parentNode;dom.showAllChildren(e),dom.remove(APP.CONF.select_frame_id);var t=APP.environments.getModuleByViewID(e.id);n.showFunctionsForView(t)}},n.switchToggle=function(e){e.on===!1?n.setToggleValue(e,!0):n.setToggleValue(e,!1)},n.setToggleValue=function(e,n){n===!0?(e.value=APP.l("on"),e.style.backgroundColor=APP.CONF.toggle_color_on,e.on=!0):(e.value=APP.l("off"),e.style.backgroundColor=APP.CONF.toggle_color_off,e.on=!1)},n.showSelectFrame=function(e,t,o,a,i){n.closeSelectFrame();var r=g(APP.active_view);dom.hideAllChildren(r);var s=dom.make("div",APP.CONF.select_frame_id,APP.CONF.select_frame_id,r,"");s.style.display="block",dom.make("h1","","",s,a);var l=dom.make("img","","close_select_frame_icon",s);l.src=APP.CONF.path_to_icons+"reset.png",l.addEventListener("click",function(){n.closeSelectFrame()}),dom.h3(s,i);for(var c=0;c<e.length;c++){var d=dom.link(s,"cl_results_link_"+c,"cl_results_link","",function(e){return function(){n.closeSelectFrame(),o(e)}}(e[c]));dom.make("div","","SF_search_entry",d,t[c])}n.makeAllFunctionsInvisible()},n.scrollTop=function(){dom.scrollTop(g(APP.CONF.content_wrapper_id))},n.createXMLOutputDIV=function(e,t,o,a,i,r){var s=dom.make("div","","output_div",e),l=n.icon(s,"","download_icon","save"),c=dom.h1(s,t),d=dom.textarea(s,o,APP.CONF.xml_textarea_class_name,APP.CONF.output_textarea_rows,APP.CONF.output_textarea_columns,a);d.filename=i,l.addEventListener("click",function(){APP.save_file(d.value,i,APP.CONF.file_download_header)}),r&&r===!0&&(console.warn("Created invalid XML"),s.style.backgroundColor="tomato",c.style.color="#AA0000",d.style.color="red",c.innerHTML+=" - INVALID XML!",d.value="############################################################################\nWARNING: THE FOLLOWING XML IS NOT VALID AND MEANT ONLY FOR TESTING PURPOSES!\n############################################################################\n"+a,dom.remove(l))},n.highlightViewIcon=function(e){"undefined"!=typeof APP.environments.active_environment&&forEach(APP.environments.active_environment.workflow,function(e){g(APP.CONF.viewlink_id_prefix+e.identity.id).style.backgroundColor=""}),g(APP.CONF.viewlink_id_prefix+"start").style.backgroundColor="";var n=APP.environments.getModuleByViewID(e);n?g(APP.CONF.viewlink_id_prefix+n.identity.id).style.backgroundColor=APP.CONF.highlight_color:"VIEW_start"==e&&(e=e.substr(APP.CONF.view_id_prefix.length),g(APP.CONF.viewlink_id_prefix+e).style.backgroundColor=APP.CONF.highlight_color)},n.mainMenu=function(){var e={};return e.drawElement=function(n,t){var o=dom.div(t,n.id,"main_menu_entry");APP.GUI.icon(o,"","main_menu_entry_img",n.icon),dom.span(o,"","main_menu_entry_span",n.title),o.addEventListener("click",n.onclick,!1),o.addEventListener("click",e.close,!1)},e.draw=function(n){var t;g(APP.CONF.main_menu_div_id)?(t=g(APP.CONF.main_menu_div_id),t.innerHTML=""):t=dom.div(document.body,APP.CONF.main_menu_div_id,""),forEach(n,function(n){e.drawElement(n,t)}),e.close(),g("main_menu_icon").addEventListener("click",e.changeDisplay),g("content_wrapper").addEventListener("click",e.close)},e.changeDisplay=function(){"none"==g(APP.CONF.main_menu_div_id).style.display?e.open():e.close()},e.close=function(){g(APP.CONF.main_menu_div_id)&&(dom.hideElement(g(APP.CONF.main_menu_div_id)),g("main_menu_icon").style.backgroundColor="")},e.open=function(){g(APP.CONF.main_menu_div_id).style.display="block",g("main_menu_icon").style.backgroundColor="cornflowerblue"},e}(),n.showFileDialog=function(e){alertify.set({labels:{ok:APP.l("abort")}});var n="<input type='file' id='generic_file_input'>";alertify.alert(n),g("generic_file_input").addEventListener("change",function(n){var t=n.target.files[0];e(t),g("alertify-ok").click()})},n.selectionMechanism=function(e,n,t){var o=this;this.shift=!1,this.last_selected_file=-1,this.selected_files=[],this.selectFile=function(e){var n=o.selected_files.indexOf(e);-1==n?(o.selected_files.push(e),o.last_selected_file=e):(o.selected_files.splice(n,1),o.last_selected_file=e),o.markFileEntry(e)},this.markFileEntry=function(o){var a,i=g(e+o).className.indexOf(" "+n);-1==i?(g(e+o).className=g(e+o).className+" "+n,a={index:o,selected:!0}):(g(e+o).className=g(e+o).className.slice(0,i),a={index:o,selected:!1}),t(a)},this.deselectAllFiles=function(){for(;o.selected_files.length>0;)o.selectFile(o.selected_files[0])},this.clickedOnFile=function(e){var n;if(o.shift===!0){if(e<o.last_selected_file)for(n=o.last_selected_file-1;n>=e;n--)o.selectFile(n);if(e>o.last_selected_file)for(n=o.last_selected_file+1;e>=n;n++)o.selectFile(n)}else o.selectFile(e)},document.onkeydown=function(e){16==e.keyCode&&o.shift===!1&&(o.shift=!0,console.log("shift on")),27==e.keyCode&&o.deselectAllFiles()},document.onkeyup=function(e){16==e.keyCode&&(o.shift=!1,console.log("shift off"))}},n}(),APP.GUI.FORMS=function(){var e=APP.l,n={};return n.fileDropZone=function(n,t,o){var a=dom.make("div",t,"fileDropZone",n,"<h2>"+e("forms","drag_and_drop_files_here")+"</h2>"),i=dom.input(n,"files_input","","files_input","file");i.multiple=!0,a.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),a.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),o(e.dataTransfer.files)},!1),g("files_input").addEventListener("change",function(e){o(e.target.files)},!1)},n.redBox=function(e,n,t,o,a,i){var r=dom.div(e,n,"redBox");return"undefined"!=typeof t&&(r.className+=" ",r.className+=t),APP.GUI.icon(r,"","delete_lang_icon","reset",a),forEach(o,function(e){var n=dom.spanBR(r,"","","");dom.appendHTMLContent(n,e)}),r.style.width=i+"px",r},n.expandableForm=function(e,t,o,a,i,r){var s=dom.make("div",t,"expandable_form",e),l=dom.make("div",t+"_header","expandable_form_header",s);l.addEventListener("click",function(e,t){return function(){n.expandableFormViewChange(e,a,t)}}(t,r));var c=dom.make("h1",t+"_label","expandable_form_heading",l),d=dom.make("a",t+"_delete_link","expandable_form_delete_link",l);d.addEventListener("click",function(e){return function(n){n.stopPropagation(),i(e)}}(t)),d.innerHTML='<img id="'+t+'_delete_img" class="delete_img" src="'+APP.CONF.path_to_icons+'reset.png" alt="Delete Bundle">';var u=dom.make("a",t+"_display_link","expandable_form_display_link",l);APP.GUI.icon(u,t+"_expand_img","expand_img","down");var _=dom.make("div",t+"_content","expandable_form_content",s);return 0==o&&n.collapseExpandableForm(t),{form:s,header:l,label:c,content:_}},n.collapseExpandableForm=function(e){g(e+"_content").style.display="none",g(e+"_expand_img").src=APP.CONF.path_to_icons+"up.png"},n.expandableFormViewChange=function(e,t,o){if("none"!=g(e+"_content").style.display){n.collapseExpandableForm(e);var a={id:o,expanded:!1}}else{g(e+"_content").style.display="block",g(e+"_expand_img").src=APP.CONF.path_to_icons+"down.png";var a={id:o,expanded:!0}}t(a)},n}(),APP.GUI.pager=function(e){var n=this;this.current_page=e.start_page||0,this.items_per_page=e.items_per_page||20,this.view=e.view,this.items_list=e.items_list,this.on_page_change=e.on_page_change,this.show_always=e.show_always||!1,this.before_page_change=e.before_page_change;var t=function(){return n.items_count=n.items_list.length,n.page_count=Math.ceil(n.items_count/n.items_per_page),0==n.page_count&&(n.page_count=1),n.start_item=n.current_page*n.items_per_page,n.end_item=n.start_item+n.items_per_page-1,n.items_list.length<n.end_item+1&&(n.end_item=n.items_list.length-1),0==n.items_list.length&&(n.end_item=0),n.visible_items=n.items_list.slice(n.start_item,n.start_item+n.items_per_page),n.current_page==n.page_count-1&&(n.visible_items=n.items_list.slice(n.start_item)),0==n.items_list.length&&(n.visible_items=[]),n.current_page>=n.page_count?void n.changePage(n.page_count-1):void 0};this.refresh=function(e){if(n.items_list=e,t(),n.hide(),n.items_count>n.items_per_page||1==n.show_always){var o=dom.div(g("environment_view"),"pager","pager","Page: ");g("content_wrapper").style.bottom="84px";for(var a=0;a<n.page_count;a++){var i=dom.span(o,"page_link_"+a,"page_link",a+1);a==n.current_page&&(i.className+=" page_link_active"),i.addEventListener("click",function(e){return function(){n.changePage(e),n.refresh(n.items_list)}}(a),!1)}if(0!=n.items_count)var r="Showing items "+(n.start_item+1)+"-"+(n.end_item+1)+" of "+n.items_list.length;else r="";dom.span(o,"pager_info_span","",r)}},this.changePage=function(e){"function"==typeof n.before_page_change&&n.before_page_change(),n.current_page=e,n.on_page_change(n.items_list),APP.GUI.scrollTop()},this.hide=function(){g("pager")&&(dom.remove("pager"),g("content_wrapper").style.bottom="")},t()},APP.save_and_recall=function(){"use strict";var e={};return e.interval=void 0,e.interval_time=60,e.getRecallDataForApp=function(){var n=localStorage.getItem(APP.CONF.local_storage_key);if(!n)return console.log("No recall data found"),e.setAutosaveInterval(e.interval_time),void APP.view("default");var t=JSON.parse(n);return console.log("APP Recall object found!"),t},e.getRecallDataForEnvironment=function(e){if("undefined"==typeof e)return void console.warn("getRecallDataForEnvironment: environment is undefined!");var n=localStorage.getItem(e.id);if(!n)return void console.log("No recall data for environment found");var t=JSON.parse(n);return console.log("Environment Recall object found!"),t},e.setAutosaveInterval=function(n){return window.clearInterval(e.interval),n?-1==n?void console.log("Auto Save off"):(console.log("Auto Save Time in seconds: "+n),e.interval_time=n,void(e.interval=window.setInterval(function(){e.save()},1e3*e.interval_time))):void console.error("ERROR: setAutosaveInterval called without time parameter!")},e.recallEnvironmentData=function(e){APP.environments.active_environment.recall(e.settings);var n=APP.environments.active_environment.workflow;forEach(n,function(n){n.recall&&n.recall(e[n.identity.id])})},e.deleteAllData=function(){localStorage.clear()},e.deleteEnvironmentData=function(){try{localStorage.removeItem(APP.environments.active_environment.id)}catch(e){return void APP.log(APP.l("save_and_recall","no_data_found"))}APP.log(APP.l("save_and_recall","active_profile_data_deleted"))},e.userSave=function(){e.save(),APP.log(APP.l("save_and_recall","form_saved"))},e.save=function(){var n=e.retrieveAppDataToSave();if(localStorage.setItem(APP.CONF.local_storage_key,JSON.stringify(n)),APP.environments.active_environment){var t=e.retrieveEnvironmentDataToSave();localStorage.setItem(APP.environments.active_environment.id,JSON.stringify(t))}console.log("Form saved")},e.saveAllToFile=function(){var n={};if(n[APP.CONF.app_core_storage_key]=e.retrieveAppDataToSave(),APP.environments.active_environment){var t=e.retrieveEnvironmentDataToSave();n.environments={},n.environments[APP.environments.active_environment.id]=t}APP.save_file(JSON.stringify(n),APP.CONF.project_file_name)},e.saveActiveEnvironmentStateToFile=function(){if(APP.environments.isAnEnvironmentLoaded()){var n;n=APP.environments.active_environment.getProjectName&&""!==APP.environments.active_environment.getProjectName()?APP.environments.active_environment.getProjectName()+"."+APP.CONF.project_file_extension:APP.CONF.project_file_name+"."+APP.CONF.project_file_extension;var t={};t.type="environment_state",t.environment_id=APP.environments.active_environment.id;var o=e.retrieveEnvironmentDataToSave();t.environments={},t.environments[APP.environments.active_environment.id]=o,APP.save_file(JSON.stringify(t),n)}else APP.log(APP.l("save_and_recall","no_data_to_save_no_profile_loaded"),"error")},e.handleProjectFileInputChange=function(n){e.loadFromFile(n.target.files[0])},e.loadFromFile=function(n){var t;readFileAsText(n,function(n){try{t=JSON.parse(n)}catch(o){APP.log(APP.l("settings","no_project_data_found_in_file"),"error")}"undefined"!=typeof t&&e.importProjectData(t)})},e.importProjectData=function(n){if(n[APP.CONF.app_core_storage_key]){console.log("data.app_storage_key = "+n[APP.CONF.app_core_storage_key]);var t;return alertify.set({labels:{ok:APP.l("confirm","no"),cancel:APP.l("confirm","yes_overwrite_data")}}),void alertify.confirm(APP.l("confirm","overwrite_data"),function(e){if(!e){console.log("Importing CMDI Maker Project from file!"),APP.environments.unloadActive(),APP.init(!0);var o=n[APP.CONF.app_core_storage_key].active_environment_id;console.log("Active Environment: "+o),n.environments&&n.environments[o]&&(console.log("importProjectData: Found environment data of environment: "+o),t=n.environments[o]),APP.recall(n[APP.CONF.app_core_storage_key],t)}})}console.info("No app_storage_key found in file. looking for type=environment_state"),"environment_state"==n.type&&(console.log("found environment_state"),APP.confirm(APP.l("confirm","overwrite_data"),function(o){if(!o){var a=n.environment_id;return APP.environments.changeByID(n.environment_id),n.environments&&n.environments[a]&&(console.log("importProjectData: Found environment data of environment: "+a),t=n.environments[a]),void e.recallEnvironmentData(t)}},APP.l("confirm","no"),APP.l("confirm","yes_overwrite_data"))),console.warn("Tried to import project data, but no vaild data was found!")},e.retrieveAppDataToSave=function(){var e={settings:{save_interval_time:dom.getSelectedRadioValue(g("radio_auto_save")),active_language_id:APP.active_language.id}};return e.active_view=APP.active_view,e.scroll_top=g(APP.CONF.content_wrapper_id).scrollTop,e.version=APP.CONF.version,APP.environments.active_environment&&(e.active_environment_id=APP.environments.active_environment.id),e},e.retrieveEnvironmentDataToSave=function(){var e={};e.settings=APP.environments.active_environment.getSaveData();var n=APP.environments.active_environment.workflow;return forEach(n,function(n){n.getSaveData&&(e[n.identity.id]=n.getSaveData())}),e},e}(),APP.settings=function(){"use strict";var e={};return e.makeFunctions={radio:function(e,n){dom.makeRadios(n,e.options,e.radio_name,e.radio_name+"_","title","value",e.default_option,e.onchange)},select:function(e,n){var t=dom.make("select",e.id,"",n);t.size=1,t.name=e.name,e.onchange&&t.addEventListener("change",e.onchange,!1),dom.br(n)},toggle:function(e,n){var t=dom.input(n,e.id,"on_off_switch",e.name,"button");t.on=!1,t.addEventListener("click",function(){APP.GUI.switchToggle(this)},!1),APP.GUI.setToggleValue(g(e.id),e.default_value),dom.br(n)},file:function(e,n){var t=dom.input(n,e.file_input_id,"",e.file_input_name,"file");t.addEventListener("change",e.onchange,!1),dom.br(n)},text:function(e,n){var t=dom.input(n,e.id,"",e.name,"text",e.value);t.addEventListener("change",e.onchange,!1),dom.br(n)},empty:function(e,n){dom.make("div",e.id,"",n)},link:function(){}},e.init=function(n,t){t.innerHTML="",forEach(n,function(n){e.create(n,t)})},e.create=function(n,t){var o=dom.h2(t);if(n.importance&&"high"==n.importance&&(o.style.color="red"),n.onclick){var a=dom.link(o,"","",n.title,n.onclick);n.importance&&"high"==n.importance&&(a.style.color="red")}else o.innerHTML=n.title;n.description&&dom.make("p","","",t,n.description),e.makeFunctions[n.type]?e.makeFunctions[n.type](n,t):console.warn("Unknown setting type: "+n.type),dom.br(t)},e}(),APP.CONF={originator:"CMDI Maker by CLASS - Cologne Language Archive Services",version:"v2.0.8",LanguageCodePrefix:"ISO639-3:",path_to_images:"img/",path_to_icons:"img/icons/",path_to_scripts:"js/",file_download_header:"text/xml;charset=utf-8",highlight_color:"skyblue",local_storage_key:"CMDI-Maker",project_file_name:"CMDI-Maker-Project",project_file_extension:"cmp",zip_archive_file_name:"archive.zip",content_wrapper_id:"content_wrapper",app_core_storage_key:"app",copy_checkbox_element_prefix:"copy_check_",viewlink_id_prefix:"VIEWLINK_",view_id_prefix:"VIEW_",xml_textarea_class_name:"xml_textarea",select_frame_id:"SF",main_menu_div_id:"main_menu_div",functions_div_id:"functions",functions_div_height:"44px",toggle_color_on:"limegreen",toggle_color_off:"tomato",output_textarea_rows:40,output_textarea_columns:130,form_textarea_rows:6,form_textarea_columns:18,log_message_period:5e3,log_section_id:"alertify-logs",language_error_placeholder:"###",url_for_version_check:"get_version.php",languageIndex_filename:"LanguageIndex.js",hellos:[["Hello!","English"],["Hallo!","German"],["Aloha!","Hawaiian"],["Hola!","Spanish"],["Hej!","Danish"],["Merhaba!","Turkish"],["你好","Chinese"],["こんにちは","Japanese"],["Вiтаю!","Belarusian"],["Salut!","French"],["Grüezi!","Swiss German"],["Ciao!","Italian"],["Hæ!","Icelandic"],["Moïen!","Luxembourgish"],["Olá!","Portuguese"],["Privet!","Russian"],["Hallå!","Scanian"],["Salam!","Urdu"]]};var imdi_environment=function(){var e={};return e.name="imdi",e.id="imdi",e.title="IMDI",e.workflow=[],e.languages=[],e.l=function(n,t,o,a){return APP.getTermInActiveLanguage(e.languages,n,t,o,a)},e.not_allowed_chars=" !\"§$%&/\\()=?^°`´'#*+~<>[]{}|²³,.;:áÁäÄàÀéÉîöÖóÓòÒüÜúÚùÙ",e.metadataLanguageIDs=[["eng","English"],["ger","German"],["spa","Spanish"],["fra","French"],["rus","Russian"],["ind","Indonesian"],["por","Portuguese"],["arb","Standard Arabic"]],e.init=function(){e.displayMetadataLanguages()},e.displayMetadataLanguages=function(){var n=g("metadata_language_select");dom.setSelectOptions(n,e.metadataLanguageIDs,1,0,!1)},e.settings=function(){return[{title:e.l("settings","output_format"),id:"output_format_select",type:"empty"},{title:e.l("settings","global_language_of_metadata"),type:"select",name:"metadata_language",id:"metadata_language_select"},{title:e.l("settings","cmdi_metadata_creator"),description:e.l("settings","cmdi_metadata_creator_description"),type:"text",name:"metadata_creator",id:"metadata_creator",value:"CMDI Maker User"},{title:e.l("settings","calculate_actors_age"),description:e.l("settings","calculate_actors_age_description"),type:"toggle",default_value:!0,name:"radio_age_calc",id:"radio_age_calc"},{title:e.l("settings","export_actors_as_json"),onclick:function(){e.workflow[2].export_actors()},type:"link"},{title:e.l("settings","import_actors_from_json_or_imdi"),description:e.l("settings","import_actors_description"),type:"file",file_input_id:"actors_file_input",file_input_name:"actors_file_input",onchange:e.workflow[2].handleImportFileInputChange}]},e.recall=function(e){dom.setRadiosByValue(g("output_format"),e.output_format),APP.GUI.setToggleValue(g("radio_age_calc"),e.calc_actors_age),g("metadata_language_select").selectedIndex=e.metadata_language,g("metadata_creator").value=e.metadata_creator},e.getProjectName=function(){return get("corpus_name")},e.getSaveData=function(){var e={};return e.output_format=dom.getSelectedRadioValue(g("output_format")),e.calc_actors_age=g("radio_age_calc").on,e.metadata_creator=get("metadata_creator"),e.metadata_language=g("metadata_language_select").selectedIndex,e},e.reset=function(){},APP.environments.add(e),e}();imdi_environment.languages[0]={id:"english",name:"English",workflow:{corpus:"Corpus",resources:"Resources",actors:"Actors",session:"Sessions",xml_output:"XML Output"},settings:{calculate_actors_age:"Calculate Actor's Age",calculate_actors_age_description:"When this feature is activated, CMDI Maker checks if the age of an actor (if it has not been specified already) can be calculated from the actor's birth date and the session date.<br>When an age can be calculated, it will appear in the output file.<br>(Age = Session Date - Actor's Birth Date)",output_format:"Output Format",imdi:"IMDI",cmdi_with_imdi_profile:"CMDI with IMDI profile",export_actors_as_json:"Export Actors as JSON",import_actors_from_json_or_imdi:"Import Actors from JSON or IMDI",import_actors_description:"Please import UTF-8 encoded files only!",delete_actors_database:"Delete Actors",delete_actors_database_description:"CMDI Maker saves all your actors in a Web Storage browser database, so that they are kept, even if you close the browser window.",global_language_of_metadata:"Global Language of Metadata",cmdi_metadata_creator:"CMDI Metadata Creator",cmdi_metadata_creator_description:"The CMDI metadata format requires the name of a metadata creator. This is probably you. If so, please type in your name."},reset_form:"Reset Form",yes_delete_form:"Yes, delete form",no:"No",really_reset_form:"Really?<br>You want to reset the form and delete corpus and all sessions?",form_reset:"Form reset",search:"Search",ok:"OK",function_currently_unavailable:"This function is currently unavailable!",warning:"WARNING:<br>",really_overwrite_data:"Do you really want to overwrite data?",yes_overwrite_data:"Yes, overwrite data",languages:{set_global_languages_of_content:"Set Global Languages of Content",language_search:"Language Search",result:"result",results:"results",language_name:"Language Name",is_new_global:"is a new Global Content Language",iso_code:"ISO code",not_found_in_db:"not found in database",specify_search_request_at_least_3_chars:"Please specify your search request.\nType in at least 3 characters.",primary_language:"Primary Language",mother_tongue:"Mother Tongue",current_content_languages:"Current Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" removed'},resources:{compatibility_warnings:{general:"This file does not seem to be a valid resource file for LAMUS. Please consider recoding it.",invalid_media_file:"This media file does not seem to be a valid file for LAMUS. Please consider recoding it to WAV (audio) or MP4 (video).",invalid_written_resource:"This file does not seem to be a valid written resource for LAMUS. Please consider recoding it to PDF or TXT."},unknown:"Unknown",create_one_session_per_file:"Create one session per file",files:"Files",selected_files:"Selected Files",sort_alphabetically:"Sort Files alphabetically",remove:"Remove",clear_file_list:"Clear File List",usage:"Usage",click:"Click",click_to_select:"Select resource, click again to deselect a single resource",shift:"Shift",shift_to_select_multiple:"Hold shift to select multiple resources",escape:"Escape",escape_to_deselect:"Press escape to deselect all resources",size:"Size",last_modified:"Last modified",no_resource_files_imported:"No resource files imported."},actors:{new_actor:"New Actor",delete_this_actor:"Delete this actor",delete_all_actors:"Delete all actors",sort_actors_alphabetically:"Sort Actors alphabetically",actors_alphabetically_sorted:"Actors sorted",save_and_duplicate_this_actor:"Save and duplicate this actor",duplicate_this_actor:"Duplicate this actor",yes_delete_all_actors:"Yes, delete all actors",no:"No",ok:"OK",confirm_erasing_actors_db:"Really?<br>You want to erase the whole actors database?",all_actors_deleted:"All actors deleted",save_actor:"Save actor",save_changes_to_this_actor:"Save changes to this actor",there_are_no_actors:"There are no actors!",actors_imported:"actors imported",actor_saved_and_duplicated:"Actor saved and duplicated.",give_your_actor_a_name_first:"Please give your actor a name first.",yes_delete_actor:"Yes, delete actor",really_erase_before_name:"Really?<br>You want to erase ",really_erase_after_name:"?",actor_deleted_before_name:"Actor ",actor_deleted_after_name:" deleted",there_are_no_actors_yet:"There are no actors yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",please_give_all_actors_a_name_before_creating_new_one:"Please give all your actors a name first, before creating a new one!",really_erase_this_actor:"Really?<br>You want to erase this actor?",unnamed_actor:"Unnamed actor"},session:{new_session:"New Session",copy_session_1_metadata:"Copy Session 1 metadata to all sessions",reset_form:"Reset Form",sort_by_name:"Sort by name",add_to_session:"Add to session",no_files_have_been_added:"No files have been added.",add_some_files:"Add some files.",new_session_has_been_created:"A new session has been created.",name:"Name",unnamed_session:"Unnamed Session",session:"Session",delete_session:"Delete Session",expand_session:"Expand Session",collapse_session:"Collapse Session",expand_collapse_session:"Expand/collapse session",no_actors_in_db_yet:"There are no actors in the database yet.",create_some_actors:"Create some actors.",really_erase_session:"Really?<br>You want to erase a whole session? Are you sure about that?",yes_delete_session:"Yes, delete session",session_deleted:"Session deleted",this_corpus_contains_no_sessions_yet:"This corpus contains no sessions yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",this_actor_is_already_in_the_session:"This actor is already in the session.",unknown_file_problem__before_filename:"We have a problem.<br>I don't know if this file is a Media File or a Written Resource:",unknown_file_problem__after_filename:"As for now, I will handle it as a written resource. But you really shouldn't do that.",session_name_taken_from_eaf:"Session name has been taken from EAF file name, since session has not been manually named yet.",session_date_extracted_from_eaf_file_name:"Session date has been extracted from EAF file name",at_least_2_sessions_to_assign_metadata:"There have to be at least 2 sessions to assign metadata from one to another.",session_1_metadata_assigned_to_all_sessions:"Session 1 metadata assigned to all sessions."},output:{xml_output:"XML Output",imdi:"IMDI",cmdi_with_imdi_profile:"CMDI with IMDI Profile",you_must_create_some_sessions_first:"You must create some sessions first!",every_session_must_have_a_project_name:"Every session must have a project name!",corpus_must_have_proper_name:"The corpus must have a proper name or no name at all.",sessions_must_have_proper_name:"Every session must have a proper name.<br>Unnamed sessions are not allowed.",download_corpus_including_all_sessions:"Download Corpus including all Sessions",download_zip_archive:"Download ZIP archive",not_allowed_chars_are:"Not allowed chars are: ",spaces_are_not_allowed_either:"Space characters are not allowed either.",sessions_must_have_name:"Your corpus contains unnamed sessions. Every session must have a name!",invalid_date_entered_in_session:'You have entered an invalid date in a session (something like 2005-MM-DD). The corresponding XML element will contain the string "Unspecified".',invalid_birth_date_entered:'You have entered an invalid birth date for an actor (something like 2005-MM-DD). The corresponding XML element will contain the string "Unspecified".',correct_or_ignore_warning:"Maybe you want to correct this. If not, ignore this warning."},session_form_comments:{name:"A short name or abbreviation of one or two words. This identifier distinguishes the session from others in the same (sub-) corpus and is used for quick browsing.",title:"The session title is the complete title of the session without any abbreviations.",date:"In general the primary date of the session is audio or video date. If this session is about written resources only it indicates the creation date of the primary document.",description:"Here a relevant description referring to the session as a whole can be given. Example: A conversation of mother, father and child at the breakfast table.",location:{continent:'If the document is about "the languages of South-America", only Continent is supposed to be specified.',region:"This element can also be used to describe sub-regions. Examples: europe, the netherlands, gelderland, achterhoek.",address:"For instance if recording sessions took place at an institution, the address of the institute is meant."},project:{main:"If the session was made within the context of a project, the project element contains information regarding this project. This information is typically reused for many sessions and corpus leafs when they all belong to the same project.",name:"A short name or abbreviation of the project.",title:"The full title of the project.",id:"A unique identifier for the project.",description:"An elaborate description of the scope and goals of the project.",contact:"Contact information about the person or institution responsible for the project."},content:{main:"The content group is used to describe the content of the session. This is done using four dimensions (communication context, genre, task and modalities).",genre:"The conventionalized discourse types of the content of the session.",sub_genre:"The conventionalized discourse sub-types of the content of the session.",task:'In areas such as language engineering often typical tasks are carried out or typical situations are dealt with such as "info kiosk task" or "frog story".',description:"In opposition to the elements prose text can be used here to describe the content.",communication_context:{main:"This group of elements is used to describe the communication context in which the recording took place.",event_structure:"Indicates the structure of the communication event.",planning_type:"Indicates in how far the consultant planned the linguistic event.",interactivity:"Characterizes the degree of interactivity between all the Actors in the session.",social_context:"Indicates the social context the event took place in.",involvement:"Indicates in how far the researcher was involved in the linguistic event."}},actors:{description:"This description concerns all Actors and should be used to describe interactions and interrelations between Actors."}},corpus_form_comments:{name:"A short archivable name of your corpus",title:"The complete and extensive title of your corpus"}},imdi_environment.languages[1]={id:"german",name:"Deutsch",workflow:{corpus:"Corpus",resources:"Resources",actors:"Actors",session:"Sessions",xml_output:"XML"},settings:{calculate_actors_age:"Automatische Altersberechnung von Actors",calculate_actors_age_description:"Wenn diese Funktion aktiviert ist, prüft CMDI Maker, ob das Alter eines Actors (wenn es noch nicht angegeben worden ist) aus dem Geburtsdatum des Actors und dem Datum der Session berechnet werden kann.<br>Wenn ein Alter berechnet werden kann, erscheint dieses in der generierten XML-Datei.<br>(Alter = Datum der Session - Geburtsdatum des Actors)",output_format:"Ausgabeformat",imdi:"IMDI",cmdi_with_imdi_profile:"CMDI mit IMDI-Profil",export_actors_as_json:"Actors als JSON exportieren",import_actors_from_json_or_imdi:"Actors von JSON oder IMDI importieren",import_actors_description:"Bitte importiere nur Dateien mit der Zeichenkodierung UTF-8!",delete_actors_database:"Alle Actors löschen",delete_actors_database_description:"CMDI Maker speichert all deine Actors in einer Browserdatenbank. Sie bleiben also erhalten, auch nachdem du den Browser geschlossen hast.",global_language_of_metadata:"Globale Metadaten-Sprache",cmdi_metadata_creator:"CMDI: Urheber der Metadaten",cmdi_metadata_creator_description:"Das CMDI-Metadatenformat setzt die Angabe eines Urhebers voraus. Das bist wahrscheinlich du! Gib in diesem Fall deinen Namen ein."},reset_form:"Formular zurücksetzen",yes_delete_form:"Ja, Daten löschen",no:"Nein",really_reset_form:"Willst Du das wirklich?<br>Das Corpus und alle Sessions werden dabei gelöscht.",form_reset:"Formular zurückgesetzt",search:"Suchen",ok:"OK",function_currently_unavailable:"Diese Funktion ist derzeit nicht verfügbar!",warning:"WARNUNG:<br>",really_overwrite_data:"Möchtest Du wirklich Daten überschreiben?",yes_overwrite_data:"Ja, Daten überschreiben",languages:{set_global_languages_of_content:"Globale Content Language hinzufügen",language_search:"Sprachsuche",language_name:"Sprachname",is_new_global:"ist neue globale Content Language",iso_code:"ISO-Code",not_found_in_db:"wurde nicht gefunden",specify_search_request_at_least_3_chars:"Bitte sei etwas genauer.\nGib mindestens 3 Zeichen ins Suchfeld ein.",primary_language:"Primärsprache",mother_tongue:"Muttersprache",current_content_languages:"Derzeitige Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" entfernt'},resources:{compatibility_warnings:{general:"Diese Datei scheint keine valide Datei für LAMUS zu sein. Vielleicht sollte sie transkodiert werden.",invalid_media_file:"Diese Datei scheint keine valide Datei für LAMUS zu sein. Vielleicht sollte sie in WAV oder MP4 umgewandelt werden.",invalid_written_resource:"Diese Datei scheint keine valide Datei für LAMUS zu sein. Vielleicht sollte sie in PDF oder TXT umgewandelt werden."},unknown:"Unbekannt",create_one_session_per_file:"Eine Session pro Datei erstellen",files:"Dateien",selected_files:"Ausgewählte Dateien",sort_alphabetically:"Alphabetisch sortieren",remove:"Entfernen",clear_file_list:"Dateiliste löschen",usage:"Benutzung",click:"Klick",click_to_select:"Datei wird ausgewählt, noch ein Klick macht die Auswahl rückgängig",shift:"Shift",shift_to_select_multiple:"Halte Shift, um mehrere Dateien auf einmal auszuwählen",escape:"Escape",escape_to_deselect:"Alle Dateien werden deselektiert",size:"Größe",last_modified:"Letzte Änderung",no_resource_files_imported:"Keine Dateien importiert."},actors:{new_actor:"Neuer Actor",delete_this_actor:"Diesen Actor löschen",delete_all_actors:"Alle Actors löschen",sort_actors_alphabetically:"Alphabetisch sortieren",actors_alphabetically_sorted:"Actors sortiert",save_and_duplicate_this_actor:"Actor speichern und duplizieren",duplicate_this_actor:"Actor duplizieren",yes_delete_all_actors:"Ja, alle Actors löschen",no:"Nein",ok:"OK",confirm_erasing_actors_db:"Willst du das wirklich?<br>Die komplette Actors-Datenbank wird gelöscht.",all_actors_deleted:"Alle Actors wurden gelöscht.",save_actor:"Actor speichern",save_changes_to_this_actor:"Änderungen am Actor speichern",there_are_no_actors:"Es gibt keine Actors!",actors_imported:"Actors importiert",actor_saved_and_duplicated:"Actor gespeichert und dupliziert.",give_your_actor_a_name_first:"Bitte gib deinem Actor zuerst einen Namen!",yes_delete_actor:"Ja, Actor löschen",really_erase_before_name:"Willst Du wirklich ",really_erase_after_name:" löschen?",actor_deleted_before_name:"Actor ",actor_deleted_after_name:" gelöscht",there_are_no_actors_yet:"Es gibt noch keine Actors.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht einen?",please_give_all_actors_a_name_before_creating_new_one:"Bitte gib all deinen Actors einen Namen, bevor du einen neuen erstellst!",really_erase_this_actor:"Willst Du diesen Actor wirklich löschen?",unnamed_actor:"Unbenannter Actor"},session:{new_session:"Neue Session",copy_session_1_metadata:"Dupliziere Session-1-Metadaten in allen Sessions",reset_form:"Formular zurücksetzen",sort_by_name:"Nach Namen sortieren",add_to_session:"Hinzufügen",no_files_have_been_added:"Es wurden noch keine Dateien importiert.",add_some_files:"Importiere welche.",new_session_has_been_created:"Eine neue Session wurde erstellt.",name:"Name",unnamed_session:"Unbenannte Session",session:"Session",delete_session:"Session löschen",expand_session:"Session ausklappen",collapse_session:"Session minimieren",expand_collapse_session:"Session ausklappen/minimieren",no_actors_in_db_yet:"Es gibt noch keine Actors in der Datenbank.",create_some_actors:"Erstelle welche.",really_erase_session:"Willst du das wirklich?<br>Die komplette Session wird gelöscht!",yes_delete_session:"Ja, Session löschen",session_deleted:"Session gelöscht",this_corpus_contains_no_sessions_yet:"Dieses Korpus enthält noch keine Sessions.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eine?",this_actor_is_already_in_the_session:"Dieser Actor existiert bereits in der Session.",unknown_file_problem__before_filename:"Es gibt ein Problem.<br>Ich weiß nicht, ob diese Datei ein Media File oder eine Written Resource ist:",unknown_file_problem__after_filename:"Ich werde sie erstmal als Written Resource behandeln. Aber sowas solltest du nicht tun.",session_name_taken_from_eaf:"Der Session-Name wurde vom Dateinamen der EAF-Datei übernommen, da die Session noch keinen Namen hatte.",session_date_extracted_from_eaf_file_name:"Das Datum der Session wurde aus dem Dateinamen der EAF-Datei extrahiert.",at_least_2_sessions_to_assign_metadata:"Es muss mindestens 2 Sessions geben, damit von einer Session in die andere kopiert werden können.",session_1_metadata_assigned_to_all_sessions:"Die Metadaten von Session 1 wurden in allen Sessions dupliziert."},output:{xml_output:"XML",imdi:"IMDI",cmdi_with_imdi_profile:"CMDI mit IMDI-Profil",you_must_create_some_sessions_first:"Du musst zuerst Sessions erstellen!",every_session_must_have_a_project_name:"Jede Session muss einen Project Name haben!",corpus_must_have_proper_name:"Das Corpus muss einen validen oder garkeinen Namen haben.",sessions_must_have_proper_name:"Jede Session muss einen validen Namen haben.<br>Unbenannte Sessions sind nicht erlaubt.",download_corpus_including_all_sessions:"Corpus inklusive aller Sessions herunterladen",download_zip_archive:"ZIP-Archiv herunterladen",not_allowed_chars_are:"Nicht erlaubte Zeichen sind: ",spaces_are_not_allowed_either:"Leerzeichen sind auch nicht erlaubt.",sessions_must_have_name:"Dein Korpus enthält unbenannte Sessions. Jede Session muss einen Namen haben!",invalid_date_entered_in_session:'Eine oder mehrere Sessions enthalten ein invalides Datum (sowas wie 2005-MM-DD). Das entsprechende XML-Element wird den String "Unspecified" enthalten.',invalid_birth_date_entered:'Eine oder mehrere Actors enthalten ein invalides BirthDate (sowas wie 2005-MM-DD). Das entsprechende XML-Element wird den String "Unspecified" enthalten.',correct_or_ignore_warning:"Vielleicht möchtest du das korrigieren. Falls nicht, ignoriere diese Warnung."},session_form_comments:{name:"Ein kurzer Name oder eine Abkürzung bestehend aus einem oder zwei Wörtern. Diese Kennung unterscheidet die Session von anderen im selben Korpus und wird beim schnellen Browsen genutzt.",title:'Der "Session Title" ist der komplette Titel der Session ohne Abkürzungen.',date:"Im Allgemeinen ist das primäre Datum der Session das Datum der Aufzeichnungen. Wenn diese Session Written Resources enthält, steht hier das Erstellungsdatum des primären Dokumentes.",description:"Hier kann eine Beschreibung eingegeben werden, die die Session als Ganzes beschreibt: Beispiel: Eine Unterhaltung zwischen Mutter, Vater und Kind am Frühstückstisch.",location:{continent:'Wenn es im Dokument um die "Sprachen von Südamerika" geht, sollte nur der Kontinent genannt werden.',region:"Dieses Element kann auch genutzt werden, um Sub-Regionen zu beschreiben. Beispiele: Europa, die Niederlande, Achterhoek.",address:"Falls die Aufnahmen beispielsweise in einem Institut gemacht worden sind, sollte hier die Adresse des Instituts eingegeben werden."},project:{main:'Wenn die Session innerhalb eines Projektes erstellt worden ist, enthält das Element "Project" Informationen über das Projekt. Diese Informationen werden typischerweise für viele Sessions wiederverwendet, wenn diese alle zum gleichen Projekt gehören.',name:"Ein kurzer Name oder eine Abkürzung des Projektes.",title:"Der komplette und ausführliche Titel des Projektes.",id:"Eine eindeutige Kennung für das Projekt.",description:"Eine ausführliche Beschreibung über den Umfang des Projektes und über seine Ziele.",contact:"Kontaktinformationen der Person oder der Institution, die für das Projekt verantwortlich ist."},content:{main:'Die "Content"-Spalte wird benutzt, um den Inhalt der Sessions zu beschreiben. Dies geschieht mit Hilfe der 4 Dimensionen "Communication Context", "Genre", "Task" und "Modalities".',genre:"Der konventionalisierte Typ des Inhalts der Session.",sub_genre:"Der konventionalisierte Sub-Typ des Inhalts der Session.",task:'In Bereichen wie der Sprachdatenverarbeitung geht es oftmals um typische Aufgaben oder Situationen wie "info kiosk task" oder "frog story".',description:"Im Gegensatz zu den anderen Elementen, kann hier Volltext benutzt werden, um den Inhalt zu beschreiben.",communication_context:{main:"Diese Gruppe von Elementen wird benutzt, um den Kontext der Kommunikation zu beschreiben, in dem die Aufnahme stattgefunden hat.",event_structure:"Struktur des Kontextes der Kommunikation.",planning_type:"Weist darauf hin, in wie weit der Referent das linguistische Ereignis geplant hat.",interactivity:"Beschreibt den Grad der Interaktivität zwischen allen Actors in der Session.",social_context:"Beschreibt den sozialen Kontext, in dem das Ereignis stattgefunden hat.",involvement:"Beschreibt, in wie weit der Forscher in das Ereignis involviert war."}},actors:{description:"Diese Beschreibung betrifft alle Actors und sollte genutzt werden, um die Interaktionen und Beziehungen zwischen den Actors zu beschreiben."}},corpus_form_comments:{name:"Ein kurzer, archivierbarer Name für dein Korpus.",title:"Der komplette und ausführliche Titel deines Korpus."}},imdi_environment.languages[2]={id:"spanish",name:"Español",code:"es",workflow:{corpus:"Corpus",resources:"Recursos",actors:"Actores",session:"Sesiones",xml_output:"XML"},settings:{calculate_actors_age:"Calcular la edad del actor",calculate_actors_age_description:"Cuando esta función está activada, CMDI Maker controla si la edad del actor (si ésta no ha sido especificada todavía) puede ser calculada a través de la fecha de nacimiento del actor y de la fecha de la sesión.<br>Si la edad puede ser calculada, ésta aparecerá en el archivo de salida.<br>(Edad = Fecha de la sesión - Fecha de nacimiento del actor)",output_format:"Formato del archivo de salida",imdi:"IMDI",cmdi_with_imdi_profile:"CMDI con perfíl IMDI",export_actors_as_json:"Exportar actores como JSON",import_actors_from_json_or_imdi:"Importar actores desde JSON o IMDI",import_actors_description:"¡Por favor importar solamente archivos codificados en UTF-8!",delete_actors_database:"Eliminar actores",delete_actors_database_description:"CMDI Maker guarda todos sus actores en una base de datos de Web Storage, así que éstos quedarán guardados aun si se cierra la ventana del navegador.",global_language_of_metadata:"Lenguaje Global de Metadatos",cmdi_metadata_creator:"Creador de Metadatos CMDI",cmdi_metadata_creator_description:"El formato de metadatos CMDI requiere el nombre de un creador de metadatos. Éste, probablemente, es usted. Si lo es, escriba su nombre."},reset_form:"Resetear formulario",yes_delete_form:"Sí, eliminar formulario",no:"No",really_reset_form:"¿Quieres realmente resetear el formulario y eliminar el corpus y todas sus sesiones?",form_reset:"Reseteo del formulario",search:"Buscar",ok:"OK",function_currently_unavailable:"¡Esta función no está actualmente disponible!",languages:{set_global_languages_of_content:"Establecer Content Language global",language_search:"Buscar lengua",result:"resultado",results:"resultados",language_name:"Nombre de la lengua",is_new_global:"es un nuevo Content Language global",iso_code:"Código ISO",not_found_in_db:"no se encontró en la base de datos",specify_search_request_at_least_3_chars:"Por favor especifique su búsqueda.\nIngrese por lo menos 3 caracteres.",primary_language:"Lengua principal",mother_tongue:"Lengua materna",current_content_languages:"Content Languages corrientes",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" eliminada'},resources:{compatibility_warnings:{general:"Este archivo multimedia no es un archivo  de recursos válido para LAMUS. Por favor intente convertir su código.",invalid_media_file:"Este archivo multimedia no es un archivo  de recursos válido para LAMUS. Por favor intente convertir su código en formato WAV (audio) o en MP4 (video).",invalid_written_resource:"Este archivo multimedia no es un archivo  de recursos válido para LAMUS. Por favor intente convertir su código en formato PDF o en TXT."},unknown:"Desconocido",create_one_session_per_file:"Crear una sesión para cada archivo",files:"Archivos",selected_files:"Archivos seleccionados",sort_alphabetically:"Ordenar los archivo alfabéticamente",remove:"Eliminar",clear_file_list:"Quitar lista de archivos",usage:"Uso",click:"Pulsar",click_to_select:"Seleccionar recurso, pulsar otra vez para deseleccionar un solo recurso",shift:"Shift",shift_to_select_multiple:"Mantener pulsada la tecla Shift para seleccionar varios recursos",escape:"Escape",escape_to_deselect:"Pulsar escape para deseleccionar todos los recursos",size:"Tamaño",last_modified:"Modificado la última vez",no_resource_files_imported:"No se importó ningún archivo de recursos."},actors:{new_actor:"Nuevo actor",delete_this_actor:"Eliminar este actor",delete_all_actors:"Eliminar todos los actores",sort_actors_alphabetically:"Ordenar actores alfabéticamente",actors_alphabetically_sorted:"Actores ordenados",save_and_duplicate_this_actor:"Guardar y duplicar este actor",duplicate_this_actor:"Duplicar este actor",yes_delete_all_actors:"Sí, eliminar todos los actores",no:"No",ok:"OK",confirm_erasing_actors_db:"¿Quiere realmente eliminar la base de datos de los actores por completo?",all_actors_deleted:"Se eliminaron todos los actores",save_actor:"Guardar actor",save_changes_to_this_actor:"Guardar los cambios hechos a este actor",there_are_no_actors:"¡No hay actores!",actors_imported:"se importaron los actores",actor_saved_and_duplicated:"Actor guardado y duplicado.",give_your_actor_a_name_first:"Por favor, primero dé un nombre a su actor.",yes_delete_actor:"Sí, eliminar actor",really_erase_before_name:"¿Quiere realmente eliminar ",really_erase_after_name:" ?",actor_deleted_before_name:"Actor ",actor_deleted_after_name:" eliminado",there_are_no_actors_yet:"Todavía no hay actores.",why_not_create_one__before_link:"¿Por qué no ",why_not_create_one__link:"crear",why_not_create_one__after_link:"uno?",please_give_all_actors_a_name_before_creating_new_one:"Por favor dé un nombre a todos los actores antes de crear uno nuevo.",really_erase_this_actor:"¿Quiere realmente eliminar este actor?",unnamed_actor:"Actor sin nombre"},session:{new_session:"Nueva sesión",copy_session_1_metadata:"Copiar los metadatos de la Sesión 1 a todas las sesiones",reset_form:"Resetear formulario",sort_by_name:"Ordenar según el nombre",add_to_session:"Añadir a la sesión",no_files_have_been_added:"No se añadió ningún archivo.",add_some_files:"Añadir unos archivos.",new_session_has_been_created:"Se creó una nueva sesión.",name:"Nombre",unnamed_session:"Sesión sin nombre",session:"Sesión",delete_session:"Eliminar sesión",expand_session:"Extender sesión",collapse_session:"Doblar sesión",expand_collapse_session:"Extender/doblar sesión",no_actors_in_db_yet:"Todavía no hay actores en la base de datos.",create_some_actors:"Crear unos actores.",really_erase_session:"¿Quiere realmente eliminar una sesión entera? Está seguro?",yes_delete_session:"Sí, eliminar sesión",session_deleted:"Sesión eliminada",this_corpus_contains_no_sessions_yet:"Todavía no hay sesiones en este corpus.",why_not_create_one__before_link:"¿Porque no ",why_not_create_one__link:"crear una",why_not_create_one__after_link:"?",this_actor_is_already_in_the_session:"Este actor ya está en la sesión.",unknown_file_problem__before_filename:"Tenemos un problema.<br>No sé si este archivo es un archivo multimedia o un recurso escrito:",unknown_file_problem__after_filename:"Por ahora lo voy a considerar un recurso escrito. Pero no deberías volver a hacerlo.",session_name_taken_from_eaf:"El nombre de la sesión viene del nombre del archivo EAF, porque todavía no se le ha dado ningún nombre.",session_date_extracted_from_eaf_file_name:"La fecha de la sesión viene del nombre del archivo EAF.",at_least_2_sessions_to_assign_metadata:"Hay que haber por lo menos 2 sesiones para asignar los metadatos de una a otra.",session_1_metadata_assigned_to_all_sessions:"Se asignaron los metadatos de la Sesión 1 a todas las sesiones."},output:{xml_output:"XML",imdi:"IMDI",cmdi_with_imdi_profile:"CMDI con perfíl IMDI",you_must_create_some_sessions_first:"¡Primero debe crear unas sesiones!",every_session_must_have_a_project_name:"¡Cada sesión debe tener un nombre de proyecto!",corpus_must_have_proper_name:"El corpus debe tener un nombre adecuado, o no tener ningún nombre.",sessions_must_have_proper_name:"Cada sesión debe tener un nombre adecuado.<br>Las sesiones sin nombre no están permitidas.",download_corpus_including_all_sessions:"Bajar corpus junto con todas las sesiones",download_zip_archive:"Bajar archivo ZIP",not_allowed_chars_are:"No se admiten: ",spaces_are_not_allowed_either:void 0},session_form_comments:{name:"Un nombre corto o la abreviatura de una o dos palabras. Este identificador permite distinguir una sesión de las otras en el mismo (sub-) corpus y se utiliza para facilitar la navegación.",title:"El título de la sesión es el título completo de la sesión sin ninguna abreviatura.",date:"En general, la fecha principal de la sesión es la fecha de un archivo audio o video. Si la sesión incluye solamente recursos escritos, ésta indicará la fecha de creación del documento principal.",description:"Aquí se puede proporcionar una descripción relacionada con la sesión entera. Ejemplo: Conversación entre la madre, el padre y el hijo a la mesa desayunando.",location:{continent:'Si el documento está relacionado con "las lenguas de Sur América", se debe especificar solamente la voz Continent.',region:"Este elemento se puede utilizar también para describir sub-regiones. Ejemplos: Europa, Paises Bajos, Gelderland, Achterhoek.",address:"Por ejemplo si las sesiones de grabación ocurrieron en un instituto, entonces se requiere la dirección de ese instituto."},project:{main:"Si una sesión se creó dentro de un proyecto, habrá unas informaciones relacionadas con este proyecto. Estas informaciones suelen ser recicladas para varias sesiones y varios corpora si estos pertenecen al mismo proyecto. ",name:"Un nombre corto o una abreviatura del proyecto.",title:"El título completo del proyecto.",id:"Un identificador único para el proyecto.",description:"Una descripción elaborada del ámbito y de los objetivos del proyecto.",contact:"Informaciones de contacto de la persona o del instituto responsable del proyecto."},content:{main:"El grupo de contenido se usa para describir el contenido de la sesión. Esto se hace a través de cuatro dimensiones (contexto de la comunicación, género, tarea y modalidades).",genre:"Los tipos de discurso convencionalizados del contenido de la sesión.",sub_genre:"Los sub-tipos de discurso convencionalizados del contenido de una sesión.",task:'En áreas como ingeniería del lenguaje se suelen tener típicas tareas o situaciones como por ejemplo "info kiosk task" o bien "frog story".',description:"Por el contrario, el texto en prosa se puede utilizar para describir el contenido.",communication_context:{main:"Este grupo de elementos se utiliza para describir el contexto de comunicación en el que se hizo la grabación.",event_structure:"Indica la estructura del evento comunicativo.",planning_type:"Indica cuanto el consultor planeó el evento lingüístico.",interactivity:"Caracteriza el grado de interacción entre todos los actores de la sesión.",social_context:"Indica el contexto social en el que ocurrió el evento.",involvement:"Indica cuanto el investigador estaba involucrado en el evento lingüístico."}},actors:{description:"La descripción se refiere a todos los actores y debería utilizarse para describir las interacciones y las interrelaciones entre los actores."}},corpus_form_comments:{name:"Un nombre corto y archivable de su corpus.",title:"El título completo y extenso de su corpus."}},imdi_environment.imdi_generator=function(){"use strict";
var e=imdi_environment.workflow[0],n=imdi_environment.workflow[1],t=imdi_environment.workflow[2],o=imdi_environment.workflow[3],a=imdi_environment,i=!1,r=!1,s="IMDI 3.04",l=function(){var e=APP.CONF.LanguageCodePrefix;return e+=g("metadata_language_select").options[g("metadata_language_select").options.selectedIndex].value},c=function(){var e="";e+=xml.header,e+=m("CORPUS",APP.CONF.originator,"1.0",today()),e+=xml.tag("Corpus",0),e+=xml.element("Name",get("corpus_name")),e+=xml.element("Title",get("corpus_title")),e+=xml.element("Description",get("corpus_description"),[["LanguageId",l()]]);for(var n=0;n<o.sessions.length;n++)e+=xml.element("CorpusLink",get(o.dom_element_prefix+o.sessions[n].id+"_session_name")+".imdi",[["Name",get(o.dom_element_prefix+o.sessions[n].id+"_session_name")]]);return e+=xml.tag("Corpus",1),e+=xml.tag("METATRANSCRIPT",1)},d=function(e){var n=o.dom_element_prefix+e,t="";return t+=xml.header,t+=m("SESSION",APP.CONF.originator,"1.0",today()),t+=xml.tag("Session",0),t+=xml.element("Name",get(n+"_session_name")),t+=xml.element("Title",get(n+"_session_title")),t+=xml.open("Date"),t+=APP.forms.getDateStringByDateInput(n+"_session_date")||"Unspecified",t+=xml.close("Date"),APP.forms.isUserDefinedDateInvalid(n+"_session_date")&&0==i&&(APP.alert(a.l("warning")+a.l("output","invalid_date_entered_in_session")+"<br>"+a.l("output","correct_or_ignore_warning")),i=!0),t+=xml.element("Description",get(n+"_session_description"),[["LanguageId",l()],["Link",""]]),t+=xml.tag("MDGroup",0),t+=xml.tag("Location",0),t+=xml.element("Continent",get(n+"_session_location_continent"),[["Link","http://www.mpi.nl/IMDI/Schema/Continents.xml"],["Type","ClosedVocabulary"]]),t+=xml.element("Country",get(n+"_session_location_country"),[["Link","http://www.mpi.nl/IMDI/Schema/Countries.xml"],["Type","OpenVocabulary"]]),t+=xml.element("Region",get(n+"_session_location_region")),t+=xml.element("Address",get(n+"_session_location_address")),t+=xml.tag("Location",1),t+=xml.open("Project"),t+=xml.element("Name",get(n+"_project_name")),t+=xml.element("Title",get(n+"_project_title")),t+=xml.element("Id",get(n+"_project_id")),t+=xml.tag("Contact",0),t+=xml.element("Name",get(n+"_project_contact_name")),t+=xml.element("Address",get(n+"_project_contact_address")),t+=xml.element("Email",get(n+"_project_contact_email")),t+=xml.element("Organisation",get(n+"_project_contact_organisation")),t+=xml.tag("Contact",1),t+=xml.element("Description",get(n+"_project_description"),[["LanguageId",l()],["Link",""]]),t+=xml.close("Project"),t+=xml.open("Keys"),t+=xml.close("Keys"),t+=u(e),t+=xml.tag("Actors",0),t+=xml.element("Description",get(n+"_actors_description"),[["LanguageId",l()],["Link",""]]),forEach(o.sessions[o.getSessionIndexFromID(e)].actors.actors,function(n){t+=h(e,n)}),t+=xml.tag("Actors",1),t+=xml.tag("MDGroup",1),t+=xml.tag("Resources",0),forEach(o.sessions[o.getSessionIndexFromID(e)].resources.resources.mediaFiles,function(e){var o=e.id;console.log("looking for mediafile with id "+o),t+=p(get(n+"_mediafile_"+o+"_name"),get(n+"_mediafile_"+o+"_size"))}),forEach(o.sessions[o.getSessionIndexFromID(e)].resources.resources.writtenResources,function(e){var o=e.id;console.log("looking for wr with id "+o),t+=f(get(n+"_mediafile_"+o+"_name"),get(n+"_mediafile_"+o+"_size"))}),t+=xml.tag("Resources",1),t+=xml.tag("References",0),t+=xml.tag("References",1),t+=xml.tag("Session",1),t+=xml.tag("METATRANSCRIPT",1)},u=function(e){var n="";return n+=xml.tag("Content",0),n+=xml.element("Genre",get(o.dom_element_prefix+e+"_content_genre"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-Genre.xml"],["Type","OpenVocabulary"]]),n+=xml.element("SubGenre",get(o.dom_element_prefix+e+"_content_subgenre"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-SubGenre.xml"],["Type","OpenVocabularyList"]]),n+=xml.element("Task",get(o.dom_element_prefix+e+"_content_task"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-Task.xml"],["Type","OpenVocabulary"]]),n+=xml.element("Modalities","",[["Link","http://www.mpi.nl/IMDI/Schema/Content-Modalities.xml"],["Type","OpenVocabulary"]]),n+=xml.element("Subject","",[["Link","http://www.mpi.nl/IMDI/Schema/Content-Subject.xml"],["Type","OpenVocabularyList"]]),n+=xml.tag("CommunicationContext",0),n+=xml.element("Interactivity",get(o.dom_element_prefix+e+"_content_communication_context_interactivity"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-Interactivity.xml"],["Type","ClosedVocabulary"]]),n+=xml.element("PlanningType",get(o.dom_element_prefix+e+"_content_communication_context_planningtype"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-PlanningType.xml"],["Type","ClosedVocabulary"]]),n+=xml.element("Involvement",get(o.dom_element_prefix+e+"_content_communication_context_involvement"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-Involvement.xml"],["Type","ClosedVocabulary"]]),n+=xml.element("SocialContext",get(o.dom_element_prefix+e+"_content_communication_context_socialcontext"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-SocialContext.xml"],["Type","ClosedVocabulary"]]),n+=xml.element("EventStructure",get(o.dom_element_prefix+e+"_content_communication_context_eventstructure"),[["Link","http://www.mpi.nl/IMDI/Schema/Content-EventStructure.xml"],["Type","ClosedVocabulary"]]),n+=xml.element("Channel","",[["Link","http://www.mpi.nl/IMDI/Schema/Content-Channel.xml"],["Type","ClosedVocabulary"]]),n+=xml.tag("CommunicationContext",1),n+=xml.tag("Languages",0),n+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),n+=_(o),n+=xml.tag("Languages",1),n+=xml.element("Keys",""),n+=xml.element("Description",get(o.dom_element_prefix+e+"_content_description"),[["LanguageId",l()],["Link",""]]),n+=xml.tag("Content",1)},_=function(){for(var n="",t=e.content_languages.content_languages,o=0;o<t.length;o++)n+=xml.tag("Language",0),n+=xml.element("Id",APP.CONF.LanguageCodePrefix+t[o][0]),n+=xml.element("Name",t[o][3],[["Link","http://www.mpi.nl/IMDI/Schema/MPI-Languages.xml"],["Type","OpenVocabulary"]]),n+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),n+=xml.tag("Language",1);return n},m=function(e,n,t,o){return xml.tag("METATRANSCRIPT",0,[["xmlns","http://www.mpi.nl/IMDI/Schema/IMDI"],["xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"],["Date",o],["FormatId",s],["Originator",n],["Type",e],["Version",t],["xsi:schemaLocation","http://www.mpi.nl/IMDI/Schema/IMDI ./IMDI_3.0.xsd"]])},f=function(e,t){var o="";return o+=xml.tag("WrittenResource",0),o+=xml.element("ResourceLink",e),o+=xml.element("MediaResourceLink",""),o+=xml.element("Date","Unspecified"),o+=xml.element("Type",n.getFileType(e).type,[["Link","http://www.mpi.nl/IMDI/Schema/WrittenResource-Type.xml"],["Type","OpenVocabulary"]]),o+=xml.element("SubType",n.getFileType(e).type,[["Link","http://www.mpi.nl/IMDI/Schema/WrittenResource-SubType.xml"],["Type","OpenVocabularyList"]]),o+=xml.element("Format",n.getFileType(e).mimetype,[["Link","http://www.mpi.nl/IMDI/Schema/WrittenResource-Format.xml"],["Type","OpenVocabulary"]]),o+=xml.element("Size",t),o+=xml.tag("Validation",0),o+=xml.element("Type","",[["Link","http://www.mpi.nl/IMDI/Schema/Validation-Type.xml"],["Type","ClosedVocabulary"]]),o+=xml.element("Methodology","",[["Link","http://www.mpi.nl/IMDI/Schema/Validation-Methodology.xml"],["Type","ClosedVocabulary"]]),o+=xml.element("Level","Unspecified"),o+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),o+=xml.tag("Validation",1),o+=xml.element("Derivation","",[["Link","http://www.mpi.nl/IMDI/Schema/WrittenResource-Derivation.xml"],["Type","ClosedVocabulary"]]),o+=xml.element("CharacterEncoding",""),o+=xml.element("ContentEncoding",""),o+=xml.element("LanguageId",""),o+=xml.element("Anonymized","Unspecified",[["Link","http://www.mpi.nl/IMDI/Schema/Boolean.xml"],["Type","ClosedVocabulary"]]),o+=xml.tag("Access",0),o+=xml.tag("Availability",2),o+=xml.tag("Date",2),o+=xml.tag("Owner",2),o+=xml.tag("Publisher",2),o+=xml.tag("Contact",0),o+=xml.tag("Name",2),o+=xml.tag("Address",2),o+=xml.tag("Email",2),o+=xml.tag("Organisation",2),o+=xml.tag("Contact",1),o+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),o+=xml.tag("Access",1),o+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),o+=xml.element("Keys",""),o+=xml.tag("WrittenResource",1)},p=function(e,t){var o="";return o+=xml.tag("MediaFile",0),o+=xml.element("ResourceLink",e),o+=xml.element("Type",n.getFileType(e).type,[["Link","http://www.mpi.nl/IMDI/Schema/MediaFile-Type.xml"],["Type","ClosedVocabulary"]]),o+=xml.element("Format",n.getFileType(e).mimetype,[["Link","http://www.mpi.nl/IMDI/Schema/MediaFile-Format.xml"],["Type","OpenVocabulary"]]),o+=xml.element("Size",t),o+=xml.element("Quality","Unspecified",[["Link","http://www.mpi.nl/IMDI/Schema/Quality.xml"],["Type","ClosedVocabulary"]]),o+=xml.tag("RecordingConditions",2),o+=xml.tag("TimePosition",0),o+=xml.element("Start","Unspecified"),o+=xml.element("End","Unspecified"),o+=xml.tag("TimePosition",1),o+=xml.tag("Access",0),o+=xml.tag("Availability",2),o+=xml.tag("Date",2),o+=xml.tag("Owner",2),o+=xml.tag("Publisher",2),o+=xml.tag("Contact",0),o+=xml.tag("Name",2),o+=xml.tag("Address",2),o+=xml.tag("Email",2),o+=xml.tag("Organisation",2),o+=xml.tag("Contact",1),o+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),o+=xml.tag("Access",1),o+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),o+=xml.element("Keys",""),o+=xml.tag("MediaFile",1)},h=function(e,n){var o=t.getIndexByID(n),i="";i+=xml.tag("Actor",0),i+=xml.element("Role",t.actors[o].role,[["Link","http://www.mpi.nl/IMDI/Schema/Actor-Role.xml"],["Type","OpenVocabularyList"]]),i+=xml.element("Name",t.actors[o].name),i+=xml.element("FullName",t.actors[o].full_name),i+=xml.element("Code",t.actors[o].code),i+=xml.element("FamilySocialRole",t.actors[o].family_social_role,[["Link","http://www.mpi.nl/IMDI/Schema/Actor-FamilySocialRole.xml"],["Type","OpenVocabularyList"]]),i+=xml.tag("Languages",0),i+=xml.element("Description","",[["LanguageId",l()],["Link",""]]);for(var s=0;s<t.actors[o].languages.length;s++)i+=xml.tag("Language",0),i+=xml.element("Id",APP.CONF.LanguageCodePrefix+t.actors[o].languages[s].LanguageObject[0]),i+=xml.element("Name",t.actors[o].languages[s].LanguageObject[3],[["Link","http://www.mpi.nl/IMDI/Schema/MPI-Languages.xml"],["Type","OpenVocabulary"]]),i+=xml.element("MotherTongue",t.actors[o].languages[s].MotherTongue?"true":"false",[["Link","http://www.mpi.nl/IMDI/Schema/Boolean.xml"],["Type","ClosedVocabulary"]]),i+=xml.element("PrimaryLanguage",t.actors[o].languages[s].PrimaryLanguage?"true":"false",[["Link","http://www.mpi.nl/IMDI/Schema/Boolean.xml"],["Type","ClosedVocabulary"]]),i+=xml.element("Description","",[["LanguageId",l()],["Link",""]]),i+=xml.tag("Language",1);return i+=xml.tag("Languages",1),i+=xml.element("EthnicGroup",t.actors[o].ethnic_group),i+=xml.tag("Age",0),i+=t.getAge(e,n),i+=xml.tag("Age",1),i+=xml.open("BirthDate"),i+=APP.forms.getDateStringByDateObject(t.actors[o].birth_date)||"Unspecified",i+=xml.close("BirthDate"),APP.forms.isUserDefinedDateInvalid(t.actors[o].birth_date)&&0==r&&(APP.alert(a.l("warning")+a.l("output","invalid_birth_date_entered")+"<br>"+a.l("output","correct_or_ignore_warning")),r=!0),i+=xml.element("Sex",t.actors[o].sex,[["Link","http://www.mpi.nl/IMDI/Schema/Actor-Sex.xml"],["Type","ClosedVocabulary"]]),i+=xml.element("Education",""!=t.actors[o].education?t.actors[o].education:"Unspecified"),i+=xml.element("Anonymized",t.actors[o].anonymized?"true":"false",[["Link","http://www.mpi.nl/IMDI/Schema/Boolean.xml"],["Type","ClosedVocabulary"]]),i+=xml.tag("Contact",0),i+=xml.element("Name",t.actors[o].contact.name),i+=xml.element("Address",t.actors[o].contact.address),i+=xml.element("Email",t.actors[o].contact.email),i+=xml.element("Organisation",t.actors[o].contact.organisation),i+=xml.tag("Contact",1),i+=xml.tag("Keys",2),i+=xml.element("Description",t.actors[o].description,[["LanguageId",l()],["Link",""]]),i+=xml.tag("Actor",1)},v={};return v.sessions=[],xml.reset(),v.corpus=c(),forEach(o.sessions,function(e){xml.reset(),v.sessions.push(d(e.id))}),v},imdi_environment.cmdi_generator=function(){"use strict";var e=imdi_environment.workflow[0],n=imdi_environment.workflow[1],t=imdi_environment.workflow[2],o=imdi_environment.workflow[3],a=imdi_environment,i=!1,r=!1,s="clarin.eu:cr1:p_1274880881885",l="clarin.eu:cr1:p_1271859438204",c=function(){var e=randomString(8,"0123456789abcdefghijklmnopqrstuvwxyz"),n=randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),t=randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),o=randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),a=randomString(12,"0123456789abcdefghijklmnopqrstuvwxyz");return"res_"+e+"_"+n+"_"+t+"_"+o+"_"+a},d=function(e){var n;if(0===e||"corpus"==e)n=s;else{if(1!=e&&"session"!=e)return APP.error("An error has occurred! Cannot insert CMDI header without knowing if session or corpus is wanted.");n=l}return xml.tag("CMD",0,[["xmlns","http://www.clarin.eu/cmd/"],["xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"],["CMDVersion","1.1"],["xsi:schemaLocation","http://www.clarin.eu/cmd/ http://catalog.clarin.eu/ds/ComponentRegistry/rest/registry/profiles/"+n+"/xsd "]])},u=function(e){var n="";return n+=xml.header,n+=d("session"),n+=_(get("metadata_creator"),today()+"+01:00",l),n+=xml.tag("Resources",0),n+=xml.tag("ResourceProxyList",2),n+=xml.tag("JournalFileProxyList",2),n+=xml.tag("ResourceRelationList",2),n+=xml.tag("Resources",1),n+=xml.tag("Components",0),n+=m(e),n+=xml.tag("Components",1),n+=xml.tag("CMD",1)},_=function(e,n,t){var o="";return o+=xml.tag("Header",0),o+=xml.element("MdCreator",e),o+=xml.element("MdCreationDate",n),o+=xml.element("MdProfile",t),o+=xml.tag("Header",1)},m=function(e){var n="";n+=xml.tag("Session",0),n+=xml.element("Name",get(o.dom_element_prefix+e+"_session_name")),n+=xml.element("Title",get(o.dom_element_prefix+e+"_session_title")),n+=xml.open("Date"),n+=APP.forms.getDateStringByDateInput(o.dom_element_prefix+e+"_session_date")||"Unspecified",n+=xml.close("Date"),APP.forms.isUserDefinedDateInvalid(o.dom_element_prefix+e+"_session_date")&&0==i&&(APP.alert(a.l("warning")+a.l("output","invalid_date_entered_in_session")+"<br>"+a.l("output","correct_or_ignore_warning")),i=!0),n+=xml.tag("MDGroup",0),n+=xml.tag("Location",0),n+=xml.element("Continent",get(o.dom_element_prefix+e+"_session_location_continent")),n+=xml.element("Country",get(o.dom_element_prefix+e+"_session_location_country")),n+=xml.element("Region",get(o.dom_element_prefix+e+"_session_location_region")),n+=xml.element("Address",get(o.dom_element_prefix+e+"_session_location_address")),n+=xml.tag("Location",1),n+=xml.tag("Project",0),n+=xml.element("Name",get(o.dom_element_prefix+e+"_project_name")),n+=xml.element("Title",get(o.dom_element_prefix+e+"_project_title")),n+=xml.element("Id",get(o.dom_element_prefix+e+"_project_id")),n+=xml.tag("Contact",0),n+=xml.element("Name",get(o.dom_element_prefix+e+"_project_contact_name")),n+=xml.element("Address",get(o.dom_element_prefix+e+"_project_contact_address")),n+=xml.element("Email",get(o.dom_element_prefix+e+"_project_contact_email")),n+=xml.element("Organisation",get(o.dom_element_prefix+e+"_project_contact_organisation")),n+=xml.tag("Contact",1),n+=xml.tag("Project",1),n+=xml.tag("Keys",2),n+=xml.tag("Content",0),n+=xml.element("Genre",get(o.dom_element_prefix+e+"_content_genre")),n+=xml.element("SubGenre",get(o.dom_element_prefix+e+"_content_subgenre")),n+=xml.element("Task",get(o.dom_element_prefix+e+"_content_task")),n+=xml.element("Modalities",""),n+=xml.element("Subject",""),n+=xml.tag("CommunicationContext",0),n+=xml.element("Interactivity",get(o.dom_element_prefix+e+"_content_communication_context_interactivity")),n+=xml.element("PlanningType",get(o.dom_element_prefix+e+"_content_communication_context_interactivity")),n+=xml.element("Involvement",get(o.dom_element_prefix+e+"_content_communication_context_involvement")),n+=xml.element("SocialContext",get(o.dom_element_prefix+e+"_content_communication_context_socialcontext")),n+=xml.element("EventStructure",get(o.dom_element_prefix+e+"_content_communication_context_eventstructure")),n+=xml.element("Channel","Unknown"),n+=xml.tag("CommunicationContext",1),n+=xml.tag("Content_Languages",0),n+=f(e),n+=xml.tag("Content_Languages",1),n+=xml.tag("Keys",2),n+=xml.tag("Content",1),n+=xml.tag("Actors",0),n+=xml.tag("descriptions",0),n+=xml.element("Description",get(o.dom_element_prefix+e+"_actors_description")),n+=xml.tag("descriptions",1);for(var t=0;t<o.sessions[o.getSessionIndexFromID(e)].actors.actors.length;t++)n+=h(e,o.sessions[o.getSessionIndexFromID(e)].actors.actors[t]);n+=xml.tag("Actors",1),n+=xml.tag("MDGroup",1),n+=xml.tag("Resources",0);for(var r,s=0;s<o.sessions[o.getSessionIndexFromID(e)].resources.resources.mediaFiles.length;s++)r=o.sessions[o.getSessionIndexFromID(e)].resources.resources.mediaFiles[s].id,n+=g(get(o.dom_element_prefix+e+"_mediafile_"+r+"_name"),get(o.dom_element_prefix+e+"_mediafile_"+r+"_size"));for(s=0;s<o.sessions[o.getSessionIndexFromID(e)].resources.resources.writtenResources.length;s++)r=o.sessions[o.getSessionIndexFromID(e)].resources.resources.writtenResources[s].id,n+=p(get(o.dom_element_prefix+e+"_mediafile_"+r+"_name"),get(o.dom_element_prefix+e+"_mediafile_"+r+"_size"));return n+=xml.tag("Resources",1),n+=xml.tag("Session",1)},f=function(){for(var n="",t=e.content_languages.content_languages,o=0;o<t.length;o++)n+=xml.tag("Content_Language",0),n+=xml.element("Id",APP.CONF.LanguageCodePrefix+t[o][0]),n+=xml.element("Name",t[o][3]),n+=xml.tag("Content_Language",1);return n},p=function(e,t){var o="";return o+=xml.tag("WrittenResource",0),o+=xml.element("ResourceLink",e),o+=xml.element("MediaResourceLink",""),o+=xml.element("Date","Unspecified"),o+=xml.element("Type",n.getFileType(e).type),o+=xml.element("SubType",n.getFileType(e).type),o+=xml.element("Format",n.getFileType(e).mimetype),o+=xml.element("Size",t),o+=xml.tag("Validation",0),o+=xml.element("Type",""),o+=xml.element("Methodology",""),o+=xml.element("Level","Unspecified"),o+=xml.element("Description",""),o+=xml.tag("Validation",1),o+=xml.element("Derivation",""),o+=xml.element("CharacterEncoding",""),o+=xml.element("ContentEncoding",""),o+=xml.element("LanguageId",""),o+=xml.element("Anonymized","Unspecified"),o+=xml.tag("Access",0),o+=xml.tag("Availability",2),o+=xml.tag("Date",2),o+=xml.tag("Owner",2),o+=xml.tag("Publisher",2),o+=xml.tag("Contact",0),o+=xml.tag("Name",2),o+=xml.tag("Address",2),o+=xml.tag("Email",2),o+=xml.tag("Organisation",2),o+=xml.tag("Contact",1),o+=xml.element("Description",""),o+=xml.tag("Access",1),o+=xml.element("Description",""),o+=xml.element("Keys",""),o+=xml.tag("WrittenResource",1)},g=function(e,t){var o="";return o+=xml.tag("MediaFile",0),o+=xml.element("ResourceLink",e),o+=xml.element("Type",n.getFileType(e).type),o+=xml.element("Format",n.getFileType(e).mimetype),o+=xml.element("Size",t),o+=xml.element("Quality","Unspecified"),o+=xml.tag("RecordingConditions",2),o+=xml.tag("TimePosition",0),o+=xml.element("Start","Unspecified"),o+=xml.element("End","Unspecified"),o+=xml.tag("TimePosition",1),o+=xml.tag("Access",0),o+=xml.tag("Availability",2),o+=xml.tag("Date",2),o+=xml.tag("Owner",2),o+=xml.tag("Publisher",2),o+=xml.tag("Contact",0),o+=xml.tag("Name",2),o+=xml.tag("Address",2),o+=xml.tag("Email",2),o+=xml.tag("Organisation",2),o+=xml.tag("Contact",1),o+=xml.tag("Access",1),o+=xml.element("Keys",""),o+=xml.tag("MediaFile",1)},h=function(e,n){var o=t.getIndexByID(n),i=t.actors[o],s="";s+=xml.tag("Actor",0),s+=xml.element("Role",i.role),s+=xml.element("Name",i.name),s+=xml.element("FullName",i.full_name),s+=xml.element("Code",i.code),s+=xml.element("FamilySocialRole",i.family_social_role),s+=xml.element("EthnicGroup",i.ethnic_group),s+=xml.tag("Age",0),s+=t.getAge(e,n),s+=xml.tag("Age",1),s+=xml.element("BirthDate",APP.forms.getDateStringByDateObject(i.birth_date)||"Unspecified"),APP.forms.isUserDefinedDateInvalid(i.birth_date)&&0==r&&(APP.alert(a.l("warning")+a.l("output","invalid_birth_date_entered")+"<br>"+a.l("output","correct_or_ignore_warning")),r=!0),s+=xml.element("Sex",i.sex),s+=xml.element("Education",""!==i.education?i.education:"Unspecified"),s+=xml.element("Anonymized",i.anonymized?"true":"false"),s+=xml.tag("Contact",0),s+=xml.element("Name",i.contact.name),s+=xml.element("Address",i.contact.address),s+=xml.element("Email",i.contact.email),s+=xml.element("Organisation",i.contact.organisation),s+=xml.tag("Contact",1),s+=xml.tag("Keys",2),s+=xml.tag("descriptions",0),s+=xml.element("Description",i.description),s+=xml.tag("descriptions",1),s+=xml.tag("Actor_Languages",0);for(var l=0;l<i.languages.length;l++)s+=xml.tag("Actor_Language",0),s+=xml.element("Id",APP.CONF.LanguageCodePrefix+i.languages[l].LanguageObject[0]),s+=xml.element("Name",i.languages[l].LanguageObject[3]),s+=xml.element("MotherTongue",i.languages[l].MotherTongue?"true":"false"),s+=xml.element("PrimaryLanguage",i.languages[l].PrimaryLanguage?"true":"false"),s+=xml.tag("Actor_Language",1);return s+=xml.tag("Actor_Languages",1),s+=xml.tag("Actor",1)},v=function(){var e=[],n="";if(n+=xml.header,n+=d("corpus"),n+=_(get("metadata_creator"),today()+"+01:00",s),n+=xml.tag("Resources",0),o.sessions.length>0){n+=xml.tag("ResourceProxyList",0);for(var t=1;t<=o.sessions.length;t++)e.push(c()),n+=xml.tag("ResourceProxy",0,[["id",e[t-1]]]),n+=xml.element("ResourceType","Metadata"),n+=xml.element("ResourceRef",get(o.dom_element_prefix+o.sessions[t-1].id+"_session_name")+".cmdi"),n+=xml.tag("ResourceProxy",1);n+=xml.tag("ResourceProxyList",1)}else n+=xml.element("ResourceProxyList",2);n+=xml.tag("JournalFileProxyList",2),n+=xml.tag("ResourceRelationList",2),n+=xml.tag("Resources",1),n+=xml.tag("Components",0);var a=e.join(" ");return n+=xml.tag("imdi-corpus",0,[["ref",a]]),n+=xml.tag("Corpus",0),n+=xml.element("Name",get("corpus_name")),n+=xml.element("Title",get("corpus_title")),n+=xml.tag("Corpus",1),n+=xml.tag("imdi-corpus",1),n+=xml.tag("Components",1),n+=xml.tag("CMD",1)},y={};y.sessions=[],xml.reset(),y.corpus=v();for(var b=0;b<o.sessions.length;b++)xml.reset(),y.sessions.push(u(o.sessions[b].id));return y},imdi_environment.session_form=function(){var e=imdi_environment.l;return{title:"imdi-form",type:"form",fields:[{title:"Session",name:"session",type:"column",fields:[{heading:"Name",name:"name",type:"text",comment:e("session_form_comments","name"),allowed_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_",replace_accent_bearing_letters_with_asci_substitute:!0},{heading:"Title",name:"title",type:"text",comment:e("session_form_comments","title")},{heading:"Date",name:"date",type:"date",comment:e("session_form_comments","date")},{heading:"Description",name:"description",type:"textarea",comment:e("session_form_comments","description")},{heading:"Location",name:"location",type:"subarea",fields:[{heading:"Continent",name:"continent",type:"select",size:1,vocabulary:["Unknown","Unspecified","Africa","Asia","Europe","Australia","Oceania","North-America","Middle-America","South-America"],default_value:"Unspecified",comment:e("session_form_comments","location","continent")},{heading:"Country",name:"country",type:"text",comment:""},{heading:"Region",name:"region",type:"text",comment:e("session_form_comments","location","region")},{heading:"Address",name:"address",type:"text",comment:e("session_form_comments","location","address")}]}]},{title:"Project",name:"project",type:"column",comment:e("session_form_comments","project","main"),fields:[{heading:"Name",name:"name",type:"text",comment:e("session_form_comments","project","name")},{heading:"Title",name:"title",type:"text",comment:e("session_form_comments","project","title")},{heading:"ID",name:"id",type:"text",comment:e("session_form_comments","project","id")},{heading:"Description",name:"description",type:"textarea",comment:e("session_form_comments","project","description")},{heading:"Contact",name:"contact",type:"subarea",comment:e("session_form_comments","project","contact"),fields:[{heading:"Name",name:"name",type:"text",comment:e("session_form_comments","project","contact")},{heading:"Address",name:"address",type:"text",comment:e("session_form_comments","project","contact")},{heading:"Email",name:"email",type:"text",comment:e("session_form_comments","project","contact")},{heading:"Organisation",name:"organisation",type:"text",comment:e("session_form_comments","project","contact")}]}]},{title:"Content",name:"content",type:"column",comment:e("session_form_comments","content","main"),fields:[{heading:"Genre",name:"genre",type:"open_vocabulary",size:1,vocabulary:["Unknown","Unspecified","Discourse","Ritual/religious texts","Fiction","Newspaper article","Radio/TV feature","Drama","Singing","Instrumental music","Poetry","Literature","Secondary document","Personal notes","Stimuli"],comment:e("session_form_comments","content","genre"),default_value:"Unspecified"},{heading:"Sub Genre",type:"text",name:"subgenre",comment:e("session_form_comments","content","sub_genre")},{heading:"Task",name:"task",type:"open_vocabulary",size:1,vocabulary:["Unknown","Unspecified","info-kiosk","travel-planning","room reservation","frog story","pear story"],comment:e("session_form_comments","content","task"),default_value:"Unspecified"},{heading:"Description",name:"description",type:"textarea",comment:e("session_form_comments","content","description")},{heading:"Communication Context",name:"communication_context",type:"subarea",comment:e("session_form_comments","content","communication_context","main"),fields:[{heading:"Event Structure",name:"eventstructure",type:"select",size:1,vocabulary:["Unknown","Unspecified","Monologue","Dialogue","Conversation","Not a natural format"],comment:e("session_form_comments","content","communication_context","event_structure"),default_value:"Unspecified"},{heading:"Planning Type",name:"planningtype",type:"select",size:1,vocabulary:["Unknown","Unspecified","spontaneous","semi-spontaneous","planned"],comment:e("session_form_comments","content","communication_context","planning_type"),default_value:"Unspecified"},{heading:"Interactivity",name:"interactivity",type:"select",size:1,vocabulary:["Unknown","Unspecified","interactive","non-interactive","semi-interactive"],comment:e("session_form_comments","content","communication_context","interactivity"),default_value:"Unspecified"},{heading:"Social Context",name:"socialcontext",type:"select",size:1,vocabulary:["Unknown","Unspecified","Family","Private","Public","Controlled environment"],comment:e("session_form_comments","content","communication_context","social_context"),default_value:"Unspecified"},{heading:"Involvement",name:"involvement",type:"select",size:1,vocabulary:["Unknown","Unspecified","elicited","non-elicited","no-observer"],comment:e("session_form_comments","content","communication_context","involvement"),default_value:"Unspecified"}]}]},{title:"Actors",type:"column",name:"actors",fields:[{heading:"Description of Actors",type:"textarea",comment:e("session_form_comments","actors","description"),name:"description"},{type:"special",name:"actors",object_structure:"array"}]},{title:"Resources",name:"resources",type:"column",fields:[{type:"special",name:"resources",object_structure:"object",object_arrays:["writtenResources","mediaFiles"]}]}],fields_to_copy:[{name:"date",label:"Date",fields:["session_date_year","session_date_month","session_date_day"]},{name:"location",label:"Location",fields:["session_location_continent","session_location_country","session_location_region","session_location_address"]},{name:"project",label:"Project",fields:["project_name","project_title","project_id","project_description","project_contact_name","project_contact_address","project_contact_email","project_contact_organisation"]},{name:"content",label:"Content",fields:["content_genre","content_subgenre","content_task","content_description","content_communication_context_eventstructure","content_communication_context_planningtype","content_communication_context_interactivity","content_communication_context_socialcontext","content_communication_context_involvement"]},{name:"actors",label:"Actors",fields:["actors_description"]}]}},imdi_environment.actor_form={title:"imdi-actors",type:"form",fields:[{type:"column",fields:[{heading:"Name",name:"name",type:"text",comment:"Name of the actor as used by others in the transcription"},{heading:"Full Name",name:"full_name",type:"text",comment:"Official name of the actor"},{heading:"Code",name:"code",type:"text",comment:"Short unique code to identify the actor as used in the transcription"},{heading:"Birth Date",name:"birth_date",type:"date"},{heading:"Age",name:"age",type:"text",allowed_chars:"0123456789"},{heading:"Sex",name:"sex",type:"select",vocabulary:["Unknown","Unspecified","NAP","Female","Male"],default_value:"Unspecified"},{heading:"Education",name:"education",type:"text"}]},{title:"",name:"",type:"column",fields:[{heading:"Role",name:"role",type:"open_vocabulary",vocabulary:["Unknown","Unspecified","Annotator","Author","Collector","Consultant","Computer","Depositor","Editor","Filmer","Illustrator","Interviewer","Musician","Photographer","Publisher","Recorder","Referent","Researcher","Singer","Speaker/Signer","Translator"],default_value:"Unspecified",comment:"Functional role of the actor e.g. consultant, contributor, interviewer, researcher, publisher, collector, translator"},{heading:"Ethnic Group",name:"ethnic_group",type:"text"},{heading:"Family Social Role",name:"family_social_role",type:"open_vocabulary",vocabulary:["Unknown","Unspecified","Father","Mother","Sibling","Boss","Partner","Student","Teacher","Shaman/Priest","Mayor","Doctor"],default_value:"Unspecified"},{heading:"Description of the actor",name:"description",type:"textarea"},{heading:"Anonymized",name:"anonymized",type:"check",comment:"Indicates if real names or anonymized codes are used to identify the actor"}]},{title:"Contact",name:"contact",type:"column",fields:[{heading:"Name",name:"name",type:"text"},{heading:"Address",name:"address",type:"text"},{heading:"Email",name:"email",type:"text"},{heading:"Organisation",name:"organisation",type:"text"}]},{title:"Languages",name:"languages",type:"column",fields:[{heading:"Actor Languages",name:"actor_languages",type:"special"}]}]},imdi_environment.corpus_form=function(){var e=imdi_environment.l;return{type:"form",fields:[{heading:"Name",name:"name",comment:e("corpus_form_comments","name"),type:"text",not_allowed_chars:" !\"§$%&/\\()=?^°`´'#*+~<>[]{}|²³,.;:"},{heading:"Title",name:"title",comment:e("corpus_form_comments","title"),type:"text"},{heading:"Description",name:"description",type:"textarea"}]}},imdi_environment.workflow[0]=function(){var e={};e.parent=imdi_environment;var n;return e.form_id_prefix="corpus_",e.reset=function(){APP.forms.fill(n,e.form_id_prefix),e.content_languages.removeAll()},e.identity={id:"corpus",title:"Corpus",icon:"box"},e.l=e.parent.l,e.init=function(t){n=e.parent.corpus_form();var o=dom.make("div","corpus_form","",t);dom.make("h1","","",o,"Corpus"),APP.forms.make(o,n,e.form_id_prefix,e.form_id_prefix),e.content_languages.init(t)},e.recall=function(t){APP.forms.fill(n,e.form_id_prefix,t),e.content_languages.recall(t.content_languages)},e.getSaveData=function(){var t=APP.forms.makeObjectWithFormData(n,e.form_id_prefix);return t.content_languages=e.content_languages.getSaveData(),t},e.functions=function(){return[{label:e.l("reset_form"),icon:"reset",id:"link_reset_form",onclick:function(){APP.confirm(e.l("really_reset_form"),function(n){n||(APP.environments.resetActive(),APP.log(e.l("form_reset")))},e.l("no"),e.l("yes_delete_form"))}}]},e.isCorpusProperlyNamed=function(){if(""==get(e.form_id_prefix+"name"))return!1;for(var n=0;n<e.parent.not_allowed_chars.length;n++)if(-1!=get(e.form_id_prefix+"name").indexOf(e.parent.not_allowed_chars[n]))return!1;return!0},e}(),imdi_environment.workflow[0].content_languages=function(){var e,n={};
return n.content_languages=[],n.id_counter=0,n.parent=imdi_environment,n.l=n.parent.l,n.init=function(t){e=imdi_environment.workflow[0];var o=dom.make("div","content_languages","",t),a=dom.div(o,"lang_search_div","");dom.h1(a,n.l("languages","set_global_languages_of_content")),APP.GUI.makeLanguageSearchForm(a,"content_language_",!0,!0,n.choose);var i=dom.div(o,"content_languages_display","");dom.h1(i,n.l("languages","current_content_languages"))},n.recall=function(e){forEach(e,n.set)},n.getSaveData=function(){return n.content_languages},n.choose=function(e){n.set(e)&&APP.log('"'+e[3]+'" '+n.l("languages","is_new_global"))},n.set=function(e){var t=e.slice(0);switch(t.length){case 4:t.push(n.id_counter);break;case 5:t[4]=n.id_counter;break;default:console.log("Error: LanguageObject.length = "+t.length)}return console.log("Chosen Content Language: "+t),n.content_languages.push(t),n.render(t,n.id_counter),n.id_counter+=1,!0},n.render=function(n,t){var o=dom.make("div","content_language_"+t+"_div","content_language_entry",g("content_languages_display"));dom.span(o,"","","ISO639-3 Code: "+n[0]);var a=APP.GUI.icon(o,"delete_lang_"+t+"_icon","delete_lang_icon","reset");a.addEventListener("click",function(n){return function(){e.content_languages.remove(n)}}(t)),dom.br(o),dom.spanBR(o,"","","Name: "+n[3]),dom.span(o,"","","Country ID: "+n[1])},n.removeAll=function(){for(;n.content_languages.length>0;)n.remove(n.content_languages[0][4]);n.id_counter=0},n.remove=function(e){var t=n.getLanguageObjectIndexByID(e);APP.log(n.l("languages","content_language_removed__before_lang")+n.content_languages[t][3]+n.l("languages","content_language_removed__after_lang")),n.content_languages.splice(t,1),dom.remove("content_language_"+e+"_div")},n.getLanguageObjectIndexByID=function(e){return getIndex(n.content_languages,4,e)},n}(),imdi_environment.workflow[1]=function(){"use strict";var e,n={};n.available_resources=[],n.identity={id:"resources",title:"Resources",icon:"blocks"},n.view_id="VIEW_resources",n.substitute_for_bad_chars="_",n.view=function(){APP.GUI.scrollTop()},n.parent=imdi_environment;var t=n.parent.l;return n.addCompatibilityWarning=function(e,n){var t=dom.div(e,"","warning_div"),o=dom.div(t,"","warning_img_div");APP.GUI.icon(o,"","warning_icon","warning"),dom.div(t,"","compatibility_warning",n)},n.getFileType=function(e){var o=n.file_types,i=e.lastIndexOf("."),r=e.slice(i+1),s={type:t("resources","unknown"),mimetype:t("resources","unknown")},l=a(o.valid_lamus_written_resource_file_types,0),c=l.indexOf(r);return-1!=l.indexOf(r)?(s.type=o.valid_lamus_written_resource_file_types[c][2],s.mimetype=o.valid_lamus_written_resource_file_types[c][1],s):(l=a(o.valid_lamus_media_file_types,0),c=l.indexOf(r),-1!=l.indexOf(r)?(s.type=o.valid_lamus_media_file_types[c][2],s.mimetype=o.valid_lamus_media_file_types[c][1],s):(l=a(o.invalid_lamus_media_file_types,0),c=l.indexOf(r),-1!=c?(s.type=o.invalid_lamus_media_file_types[c][2],s.mimetype=o.invalid_lamus_media_file_types[c][1],s):(l=a(o.invalid_lamus_written_resource_file_types,0),c=l.indexOf(r),-1!=c?(s.type=o.invalid_lamus_written_resource_file_types[c][2],s.mimetype=o.invalid_lamus_written_resource_file_types[c][1],s):s)))},n.file_types={valid_lamus_written_resource_file_types:[["eaf","text/x-eaf+xml","Annotation"],["mdf","Unknown","Unspecified"],["pdf","application/pdf","Primary Text"],["xml","text/xml","Annotation"],["txt","text/plain","Unspecified"],["htm","text/html","Unspecified"],["html","text/html","Unspecified"]],valid_lamus_media_file_types:[["wav","audio/x-wav","audio"],["wave","audio/x-wav","audio"],["mpg","video/mpeg","video"],["mpeg","video/mpeg","video"],["mp4","video/mp4","video"],["aif","audio/x-aiff","audio"],["aiff","audio/x-aiff","audio"],["jpg","image/jpeg","image"],["jpeg","image/jpeg","image"],["png","image/png","image"],["tif","image/tiff","image"],["tiff","image/tiff","image"],["smil","application/smil+xml","video"]],invalid_lamus_written_resource_file_types:[["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document","Unspecified"],["doc","application/msword","Unspecified"],["odf","application/vnd.oasis.opendocument.formula","Unspecified"],["odt","application/vnd.oasis.opendocument.text","Unspecified"],["xls","application/vnd.ms-excel","Unspecified"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Unspecified"],["ppt","application/vnd.ms-powerpoint","Unspecified"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation","Unspecified"]],invalid_lamus_media_file_types:[["mkv","Unknown","video"],["mov","video/quicktime","video"],["mp3","Unknown","audio"],["avi","video/x-msvideo","video"],["au","audio/basic","audio"]]},n.recall=function(e){n.available_resources=e,n.refreshFileListDisplay()},n.getSaveData=function(){return n.available_resources},n.functions=function(){return[{label:t("resources","create_one_session_per_file"),icon:"plus",id:"crps_icon",wrapper_id:"crps_div",type:"function_wrap",sub_div:"crps_filetype_select",onclick:function(){n.createSessionPerResource(),APP.view(e)},sub_div_innerHTML:'<h3 class="inner_function_h3">'+t("resources","files")+'</h3><input type="radio" name="radio_file_type" value="selected" checked> '+t("resources","selected_files")+'<br><input type="radio" name="radio_file_type" value="eaf"> EAF<br><input type="radio" name="radio_file_type" value="wav"> WAV<br><input type="radio" name="radio_file_type" value="mpg"> MPG<br><input type="radio" name="radio_file_type" value="mp4"> MP4<br>'},{id:"link_sort_alphabetically",icon:"az",label:t("resources","sort_alphabetically"),onclick:function(){n.sortAlphabetically()}},{id:"link_remove_files",icon:"reset",label:t("resources","remove"),onclick:function(){n.removeSelectedFiles()}},{id:"link_clear_file_list",icon:"reset",label:t("resources","clear_file_list"),onclick:function(){n.clearFileList()}}]},n.init=function(o){e=imdi_environment.workflow[3];{var a=dom.make("div","files","",o),i=(APP.GUI.FORMS.fileDropZone(a,"drop_zone",n.pushFileMetadata),dom.make("div","","workspace-usageTable",a,"<h3>"+t("resources","usage")+"</h3><h4>"+t("resources","click")+"</h4><p>"+t("resources","click_to_select")+"</p><h4>"+t("resources","shift")+"</h4><p>"+t("resources","shift_to_select_multiple")+"</p><h4>"+t("resources","escape")+"</h4><p>"+t("resources","escape_to_deselect")+"</p>"),dom.make("div","file_list_div","",o));dom.make("div","list","",i)}n.fileSelection=new APP.GUI.selectionMechanism("file_entry_","selected_file",function(e){n.available_resources[e.index].selected=e.selected}),n.refreshFileListDisplay(!0)},n.getValidityOfFile=function(e){var o,a=getFileTypeFromFilename(e);for(o=0;o<n.file_types.valid_lamus_media_file_types.length;o++)if(a==n.file_types.valid_lamus_media_file_types[o][0])return{type:"Media File",comptaibility_warning:void 0,file_entry_class:"media_file_entry"};for(o=0;o<n.file_types.valid_lamus_written_resource_file_types.length;o++)if(a==n.file_types.valid_lamus_written_resource_file_types[o][0])return{type:"Written Resource",comptaibility_warning:void 0,file_entry_class:"written_resource_file_entry"};for(o=0;o<n.file_types.invalid_lamus_media_file_types.length;o++)if(a==n.file_types.invalid_lamus_media_file_types[o][0])return{type:"Media File",compatibility_warning:t("resources","compatibility_warnings","invalid_media_file"),file_entry_class:"media_file_entry"};for(o=0;o<n.file_types.invalid_lamus_written_resource_file_types.length;o++)if(a==n.file_types.invalid_lamus_written_resource_file_types[o][0])return{type:"Written Resource",compatibility_warning:t("resources","compatibility_warnings","invalid_written_resource"),file_entry_class:"written_resource_file_entry"};return{type:"Unknown",compatibility_warning:t("resources","compatibility_warnings","general"),file_entry_class:"invalid_file_entry"}},n.refreshFileListDisplay=function(o){var a,i=g("list");i.innerHTML="";for(var r=0;r<n.available_resources.length;r++)a=n.getValidityOfFile(n.available_resources[r].name),n.renderResource(r,n.available_resources[r].name,n.available_resources[r].mime_type,n.available_resources[r].size,n.available_resources[r].last_change,"file_entry_"+r,"file_entry "+a.file_entry_class,i,a.compatibility_warning);0===n.available_resources.length&&dom.h2(i,t("resources","no_resource_files_imported")),e&&!o&&e.refreshResourcesOfAllSessions(),n.fileSelection.selected_files=[]},n.renderResource=function(e,o,a,i,r,s,l,c,d){{var u=dom.make("div",s,l,c),o=dom.make("h2","","file_entry_title",u,o);dom.make("p","","",u,a+'<br><span class="size_span">'+t("resources","size")+": "+i+'</span><br><span name="date_span" class="date_span">'+t("resources","last_modified")+": "+r+"</span>")}"undefined"!=typeof d&&n.addCompatibilityWarning(u,d),u.addEventListener("click",function(e){return function(){n.fileSelection.clickedOnFile(e)}}(e),!1)},n.pushFileMetadata=function(e){for(var t,o=0;t=e[o];o++)n.available_resources.push({name:t.name,mime_type:t.type||"n/a",size:bytesToSize(t.size,1),last_change:t.lastModifiedDate.toLocaleDateString()});n.refreshFileListDisplay()},n.sortAlphabetically=function(){n.available_resources=sortByKey(n.available_resources,"name"),n.refreshFileListDisplay()},n.createSessionPerResource=function(){var e,t,o=document.getElementsByName("radio_file_type");if(e=dom.getSelectedRadioValue(o),console.log("Searching for files of chosen file type "+e),"selected"==e)return void forEach(n.fileSelection.selected_files,n.createSessionForResource);for(t=0;t<n.available_resources.length;t++)getFileTypeFromFilename(n.available_resources[t].name)==e&&n.createSessionForResource(t)},n.removeSelectedFiles=function(){var e;for(e=0;e<n.fileSelection.selected_files.length;e++)n.available_resources[n.fileSelection.selected_files[e]]=null;for(e=0;e<n.available_resources.length;)null===n.available_resources[e]?n.available_resources.splice(e,1):e++;n.refreshFileListDisplay()},n.removeFile=function(e){n.available_resources.splice(e,1),n.refreshFileListDisplay()},n.createSessionForResource=function(t){var o=replaceAccentBearingLettersWithASCISubstitute(removeEndingFromFilename(n.available_resources[t].name));o=replaceCharactersInStringWithSubstitute(name,n.parent.not_allowed_chars,n.substitute_for_bad_chars);var a=!1,i=[];i.push(t);for(var r=0;r<n.available_resources.length;r++)t!=r&&isSubstringAStartOfAWordInString(removeEndingFromFilename(n.available_resources[r].name),removeEndingFromFilename(n.available_resources[t].name))&&i.push(r);e.createNewSessionWithResources(o,a,i)},n.clearFileList=function(){n.available_resources=[],n.refreshFileListDisplay()},n}(),imdi_environment.workflow[2]=function(){"use strict";var e,n=function(){forEach(c.actors[c.active_actor_index].languages,c.languages.set)},t=function(e){if("undefined"==typeof e)return void console.info("I shall highlight an actor with index = undefined!");for(var n=0;n<c.actors.length;n++)g(c.element_id_prefix+"list_entry_"+n).style.background=c.unhighlightColor;g(c.element_id_prefix+"list_entry_"+e).style.background=c.highlightColor},o=function(){var e=map(c.languages.languages_of_active_actor,function(e){var n={LanguageObject:e.LanguageObject,MotherTongue:g("mothertongue_"+e.id).checked,PrimaryLanguage:g("primarylanguage_"+e.id).checked};return n});return e},a=function(){var e=APP.forms.createEmptyObjectFromTemplate(d);return APP.forms.fillObjectWithFormData(e,c.element_id_prefix,d),e.languages=o(),e.id=c.actors[c.active_actor_index].id,console.log("Saving actor with id "+e.id),e},i=function(e){var n=e.getElementsByTagName("Actor"),t=map(n,function(e){console.log("Actor in IMDI found. Name: "+e.querySelector("Name").textContent.trim());var n={name:e.querySelector("Name").textContent.trim(),role:e.querySelector("Role").textContent.trim(),full_name:e.querySelector("FullName").textContent.trim(),code:e.querySelector("Code").textContent.trim(),age:e.querySelector("Age").textContent.trim(),sex:e.querySelector("Sex").textContent.trim(),education:e.querySelector("Education").textContent.trim(),birth_date:parse_birth_date(e.querySelector("BirthDate").textContent.trim()),ethnic_group:e.querySelector("EthnicGroup").textContent.trim(),family_social_role:e.querySelector("FamilySocialRole").textContent.trim(),description:e.querySelector("Description").textContent.trim(),contact:{name:e.querySelector("Contact").querySelector("Name").textContent.trim(),address:e.querySelector("Contact").querySelector("Address").textContent.trim(),email:e.querySelector("Contact").querySelector("Email").textContent.trim(),organisation:e.querySelector("Contact").querySelector("Organisation").textContent.trim()},anonymized:"true"==e.querySelector("Anonymized").textContent.trim()?!0:!1,languages:[]},t=e.querySelector("Languages");return forEach(t.children,function(e){if("Language"==e.nodeName){var t={LanguageObject:[e.querySelector("Id").textContent.trim().slice(9),"?","?",e.querySelector("Name").textContent.trim()],MotherTongue:"true"==e.querySelector("MotherTongue").textContent.trim()?!0:!1,PrimaryLanguage:"true"==e.querySelector("PrimaryLanguage").textContent.trim()?!0:!1};n.languages.push(t)}}),n});return console.log(n),t},r=function(e){c.saveActiveActor(),c.show(c.actors[e].id)},s=function(e,n){return c.parent.l("actors",e,n)},l=function(){for(var e=0;e<c.actors.length;e++)if(""==c.actors[e].name)return!1;return!0},c={};c.parent=imdi_environment;var d=c.parent.actor_form;c.actors=[],c.element_id_prefix="actor_",c.highlightColor="#FF8BC7",c.unhighlightColor="lightskyblue",c.identity={id:"actor",title:"Actors",icon:"user"},c.id_counter=0,c.active_actor_index,c.module_view,c.init=function(n){c.actors=[],c.id_counter=0,c.active_actor_index=void 0,c.module_view=n,e=c.parent.workflow[3],c.createListDIV(n);dom.make("div",c.element_id_prefix+"view","",n);c.languages.init(n),c.refreshListDisplay(!0)},c.createListDIV=function(e){dom.make("div",c.element_id_prefix+"list","",e)},c.getSaveData=function(){var e={};return c.saveActiveActor(),e.actors=c.actors,e.id_counter=c.id_counter,e.active_actor_index=c.active_actor_index,e},c.exists=function(){},c.showNoActorsMessage=function(){var e=c.module_view;e.innerHTML="";var n=dom.make("h2","no_actors_text","no_actors_text",e);n.innerHTML=s("there_are_no_actors_yet")+" "+s("why_not_create_one__before_link");var t=dom.make("a","new_actor_link","new_actor_link",n);t.innerHTML=s("why_not_create_one__link"),n.innerHTML+=s("why_not_create_one__after_link"),g("new_actor_link").addEventListener("click",function(){c.createNewActor()})},c.recall=function(e){e.actors&&(c.actors=e.actors),e.id_counter&&(c.id_counter=e.id_counter),e.active_actor_index?c.active_actor_index=e.active_actor_index:c.actors.length>0&&(c.active_actor_index=0),c.refreshListDisplay(),"undefined"!=typeof c.active_actor_index&&c.show(c.actors[c.active_actor_index].id)},c.functions=function(){return[{id:"link_new_actor",icon:"plus",label:s("new_actor"),onclick:function(){c.createNewActor()}},{id:"link_delete_active_actor",icon:"reset",label:s("delete_this_actor"),onclick:function(){c.handleClickOnDeleteActor()}},{id:"link_sort_actors_alphabetically",icon:"az",label:s("sort_actors_alphabetically"),onclick:function(){c.sortAlphabetically()}},{id:"link_duplicateActiveActor",icon:"duplicate_user",label:s("duplicate_this_actor"),onclick:function(){c.duplicateActiveActor()}},{id:"link_eraseAll",icon:"reset",label:s("delete_all_actors"),onclick:function(){c.eraseAll()}}]},c.eraseAll=function(){APP.confirm(s("confirm_erasing_actors_db"),function(e){e||(c.id_counter=0,c.actors=[],c.active_actor_index=void 0,APP.log(s("all_actors_deleted")),c.refreshListDisplay())},s("no"),s("yes_delete_all_actors"))},c.show=function(e){var o=c.getIndexByID(e);if("undefined"==typeof o&&(console.error("actor.show: Undefined actor_id!"),o=0),0==c.actors.length)return void console.info("actor.show: No actors to show!");console.log("Showing actor "+o),c.createFormIfNotExistent(),t(o),c.languages.clearActiveActorLanguages(),c.active_actor_index=o,c.refreshFormTitle();var a=c.actors[o];APP.forms.fill(d,c.element_id_prefix,a),n()},c.refreshFormTitle=function(){var e=g(c.element_id_prefix+"form_title"),n=c.actors[c.active_actor_index].name;e.innerHTML=""==n?s("unnamed_actor"):n},c.getIndexByID=function(e){var n=getIndex(c.actors,"id",e);return"undefined"==typeof n&&console.warn("ERROR: Could not find actors cache index from actor id!\n\nactor_id = "+e),n},c.export_actors=function(){if(0!==c.actors.length){var e=JSON.stringify(c.actors);APP.save_file(e,"actors.json",APP.CONF.file_download_header)}else APP.alert(s("there_are_no_actors"))},c.handleImportFileInputChange=function(e){var n=e.target.files;console.log(n);var t=n[0];console.log(t),readFileAsText(t,function(e){var n;try{n=JSON.parse(e)}catch(t){if(window.DOMParser){var o=new DOMParser,a=o.parseFromString(e,"text/xml");n=i(a)}}if(n){for(var r=0;r<n.length;r++)c.save(n[r],!0);c.refreshListDisplay(),APP.log(n.length+" "+s("actors_imported"))}})},c.createFormIfNotExistent=function(){var e=g("actor_view");if(!e){e=dom.make("div","actor_view","actor_view",c.module_view),e.innerHTML="";var n=dom.make("div",c.element_id_prefix+"title_div","",e);dom.make("h1",c.element_id_prefix+"form_title","",n,s("new_actor")),dom.make("div",c.element_id_prefix+"content_div","",e),APP.forms.make(g(c.element_id_prefix+"content_div"),d,c.element_id_prefix,c.element_id_prefix,void 0,c.languages.makeInputInForm),g(c.element_id_prefix+"name").addEventListener("blur",c.saveActiveActor),g(c.element_id_prefix+"role").addEventListener("blur",c.saveActiveActor)}},c.duplicateActiveActor=function(){var e=c.saveActiveActor();c.createNewActor(e),APP.log(s("actor_saved_and_duplicated"),"success")},c.saveActiveActor=function(){if("undefined"!=typeof c.active_actor_index){var e=a();return c.save(e),c.refreshListDisplay(),c.refreshFormTitle(),e}},c.save=function(n){getArrayWithIDs(c.actors);return c.actors.splice(c.getIndexByID(n.id),1,n),e.updateActorNameInAllSessions(n.id),n},c.createNewActor=function(e){return"undefined"!=typeof c.active_actor_index&&c.saveActiveActor(),l()?(e||(e=APP.forms.createEmptyObjectFromTemplate(d)),e.id=c.id_counter,console.log("Saving actor with id "+e.id),c.id_counter++,c.actors.push(e),console.log("Yeah, dude inserted! insertId is: "+e.id),c.refreshListDisplay(),void c.show(e.id)):void APP.alert(s("please_give_all_actors_a_name_before_creating_new_one"))},c.handleClickOnDeleteActor=function(){if("undefined"==typeof c.active_actor_index)return void console.warn("Active Actor is undefined. Don't know what to delete!");var e,n=c.actors[c.active_actor_index].name;e=""==n?s("really_erase_this_actor"):s("really_erase_before_name")+n+s("really_erase_after_name"),APP.confirm(e,function(e){e||(c.deleteActiveActor(),APP.log(s("actor_deleted_before_name")+n+s("actor_deleted_after_name")))},s("no"),s("yes_delete_actor"))},c.deleteActiveActor=function(){c.deleteActor(c.active_actor_index)},c.deleteActor=function(e){c.actors.splice(e,1),0==c.actors.length&&(c.active_actor_index=void 0),c.active_actor_index>0?c.show(c.actors[c.active_actor_index-1].id):c.actors.length>0&&c.show(c.actors[0].id),c.refreshListDisplay()},c.getAge=function(n,t){var o=c.getIndexByID(t);if(""===c.actors[o].age){if(g("radio_age_calc").on){var a=c.actors[o].birth_date.year+"-"+c.actors[o].birth_date.month+"-"+c.actors[o].birth_date.day,i=get(e.dom_element_prefix+n+"_session_date_year")+"-"+get(e.dom_element_prefix+n+"_session_date_month")+"-"+get(e.dom_element_prefix+n+"_session_date_day"),r=calcAgeAtDate(i,a);return 0!==r?(console.log("Actor's age successfully calculated"),r):"Unspecified"}return"Unspecified"}return c.actors[o].age},c.sortAlphabetically=function(){c.actors=sortByKey(c.actors,"name"),c.refreshListDisplay(),APP.log(s("actors_alphabetically_sorted"))},c.refreshListDisplay=function(n){g(c.element_id_prefix+"list")||(c.module_view.innerHTML="",c.createListDIV(c.module_view)),g(c.element_id_prefix+"list").innerHTML="",forEach(c.actors,u),0==c.actors.length?(c.showNoActorsMessage(),APP.environments.disableFunction("link_delete_active_actor"),APP.environments.disableFunction("link_sort_actors_alphabetically"),APP.environments.disableFunction("link_duplicateActiveActor")):(t(c.active_actor_index),APP.environments.enableFunction("link_delete_active_actor"),APP.environments.enableFunction("link_sort_actors_alphabetically"),APP.environments.enableFunction("link_duplicateActiveActor")),e&&!n&&e.refreshActorLists(c.actors)};var u=function(e,n){var t=dom.make("div",c.element_id_prefix+"list_entry_"+n,c.element_id_prefix+"list_entry",g(c.element_id_prefix+"list")),o=""!=e.name?e.name:s("unnamed_actor");dom.h2(t,o),dom.p(t,e.role),t.addEventListener("click",function(e){return function(){r(e)}}(n),!1)};return c}(),imdi_environment.workflow[2].languages=function(){"use strict";var e={},n=imdi_environment.workflow[2];e.languages_of_active_actor=void 0,e.parent=imdi_environment;var t=e.parent.l;return e.element_id_prefix=n.element_id_prefix+"languages_",e.id_counter=0,e.init=function(){e.languages_of_active_actor=[]},e.makeInputInForm=function(n,t,o){"actor_languages"==n.name&&APP.GUI.makeLanguageSearchForm(t,o,!1,!1,e.addFromForm)},e.remove=function(n){var t=e.getActorLanguageObjectIndexFromID(n);e.languages_of_active_actor.splice(t,1),dom.remove(e.element_id_prefix+n+"_div")},e.clearActiveActorLanguages=function(){for(;e.languages_of_active_actor.length>0;)console.log("removing "+e.languages_of_active_actor[0].id),e.remove(e.languages_of_active_actor[0].id);e.id_counter=0},e.getActorLanguageObjectIndexFromID=function(n){return getIndex(e.languages_of_active_actor,"id",n)},e.set=function(o){var a=o.LanguageObject.slice(0);o.id=e.id_counter,e.languages_of_active_actor.push(o);var i=dom.newElement("div",e.element_id_prefix+e.id_counter+"_div",e.element_id_prefix+"entry",g(e.element_id_prefix+"display"));APP.GUI.icon(i,"","delete_lang_icon","reset",function(e){return function(){n.languages.remove(e)}}(e.id_counter)),dom.spanBR(i,"","","ISO639-3 Code: "+a[0]),dom.spanBR(i,"","","Name: "+a[3]),dom.spanBR(i,"","","Country ID: "+a[1]);var r=dom.input(i,"mothertongue_"+e.id_counter,"","","checkbox");o.MotherTongue===!0&&(r.checked=!0),dom.span(i,"","",t("languages","mother_tongue")+"  "),r=dom.input(i,"primarylanguage_"+e.id_counter,"","","checkbox"),o.PrimaryLanguage===!0&&(r.checked=!0),dom.span(i,"","",t("languages","primary_language")),e.id_counter+=1},e.addFromForm=function(n){var t;t=0===e.languages_of_active_actor.length?!0:!1;var o={LanguageObject:n,MotherTongue:t,PrimaryLanguage:t};e.set(o)},e}(),imdi_environment.workflow[3]=function(e,n){"use strict";var t={};t.parent=imdi_environment;var o=t.parent.l,a=void 0;return t.identity={id:"session",title:"Sessions",icon:"edit"},t.sessions=[],t.id_counter=0,t.resource_id_counter=0,t.dom_element_prefix="session_",t.reset=function(){t.eraseAll()},t.init=function(){t.displayNoSessionText(),t.sessions=[],t.id_counter=0,t.resource_id_counter=0,a=t.parent.session_form(),t.createCopySessionOptions()},t.view=function(){APP.GUI.scrollTop()},t.recall=function(e){for(var n=0;n<e.length;n++)t.sessions.push(e[n]),t.sessions[n].id=t.getNewSessionID();t.refreshSessionsDisplay()},t.getSaveData=function(){return t.refreshSessionsArray(),t.sessions},t.refreshSessionsArray=function(){var e=[];forEach(t.sessions,function(n){var o=n;APP.forms.fillObjectWithFormData(o,t.dom_element_prefix+n.id+"_",a),e.push(o)}),t.sessions=e},t.createCopySessionOptions=function(){var e=a,n=g("copy_sessions_select");if(!e.fields_to_copy)return void dom.span(n,"","",o("function_currently_unavailable"));var t=e.fields_to_copy;forEach(t,function(e){var t=dom.input(n,APP.CONF.copy_checkbox_element_prefix+e.name,"","","checkbox");t.checked=!0,dom.spanBR(n,"",""," "+e.label)})},t.functions=function(){return[{label:o("session","new_session"),icon:"plus",id:"link_newSession",onclick:function(){t.newSession()}},{label:o("session","copy_session_1_metadata"),icon:"copy",id:"link_copy_sessions",wrapper_id:"copy_sessions_div",type:"function_wrap",sub_div:"copy_sessions_select",onclick:function(){APP.confirm(o("really_overwrite_data"),function(e){e||t.assignSession1Metadata()},o("no"),o("yes_overwrite_data"))}},{label:o("session","reset_form"),icon:"reset",id:"session_link_reset_form",onclick:function(){APP.confirm(o("really_reset_form"),function(e){e||(APP.environments.resetActive(),APP.log(o("form_reset")))},o("no"),o("yes_delete_form"))}},{label:o("session","sort_by_name"),icon:"az",id:"session_link_sort_by_name",onclick:function(){t.sortAlphabetically()}}]},t.refreshResources=function(n){var a=g(t.dom_element_prefix+t.sessions[n].id+"_resources_add_mf_div");a.innerHTML="";var i=document.createElement("select");if(dom.setSelectOptions(i,e.available_resources,"name","take_index"),e.available_resources.length>0&&(a.appendChild(i),dom.br(a),dom.button(a,o("session","add_to_session"),function(e){return function(){t.addResource(e,i.selectedIndex)}}(t.sessions[n].id))),0===e.available_resources.length){var r=dom.h5(a,o("session","no_files_have_been_added")+"<br>");dom.link(r,"","",o("session","add_some_files"),function(){APP.view(e)})}},t.newSession=function(){var e=APP.forms.createEmptyObjectFromTemplate(a);return e.id=t.getNewSessionID(),e.expanded=!0,t.sessions.push(e),t.drawNewSession(e),e.id},t.getNewSessionID=function(){var e=t.id_counter;return t.id_counter+=1,e},t.createNewSessionWithResources=function(e,n,i){var r=APP.forms.createEmptyObjectFromTemplate(a);return r.session.name=removeCharactersFromString(e,t.parent.not_allowed_chars),r.expanded=n,r.id=t.getNewSessionID(),t.sessions.push(r),t.drawNewSession(r),forEach(i,function(e){t.addResource(r.id,e)}),APP.log(o("session","new_session_has_been_created")+"<br>"+o("session","name")+": "+e),r.id},t.refreshSessionsDisplay=function(){var e=g(APP.CONF.view_id_prefix+t.identity.id);return e.innerHTML="",0===t.sessions.length?void t.displayNoSessionText():void forEach(t.sessions,t.drawNewSession)},t.drawNewSession=function(e){var o=e.id,i=e.expanded,r=g(APP.CONF.view_id_prefix+t.identity.id),s=t.dom_element_prefix+o;g("no_session_text")&&(r.innerHTML="");var l=dom.div(r,s,"session_div");t.drawSessionHeader(l,o,e);var c=dom.div(l,s+"_content","session_content");APP.forms.make(c,a,s+"_",t.dom_element_prefix,e,t.makeSpecialFormInput),g(s+"_session_name").addEventListener("blur",function(e){return function(){t.refreshSessionHeading(e)}}(o)),t.getActorsFromSessionObjectAndAddToSession(e,o),t.getResourcesFromSessionObjectAndAddToSession(e,o);var d=map(n.actors,function(e){return e.id});t.refreshActorListInSession(t.getSessionIndexFromID(o),d),i===!1&&t.display(o)},t.getActorsFromSessionObjectAndAddToSession=function(e,o){"undefined"!=typeof e.actors.actors&&forEach(e.actors.actors,function(e){void 0!=n.getIndexByID(e)&&t.renderActor(o,e)})},t.drawSessionHeader=function(e,n,a){var i=dom.make("div",t.dom_element_prefix+n+"_header","session_header",e);i.addEventListener("click",function(e){return function(){t.display(e)}}(n));var r=dom.make("h1",t.dom_element_prefix+n+"_label","session_heading",i);a.session&&a.session.name&&""!==a.session.name?(r.innerHTML=o("session","session")+": "+a.session.name,t.sessions[t.getSessionIndexFromID(n)].session.name=a.session.name):(r.innerHTML=o("session","unnamed_session"),t.sessions[t.getSessionIndexFromID(n)].session.name="");var s=APP.GUI.icon(i,t.dom_element_prefix+n+"_delete_img","delete_img","reset",function(e){return function(n){n.stopPropagation(),t.userErase(e)}}(n));s.alt=o("session","delete_session"),s.title=o("session","delete_session"),s=APP.GUI.icon(i,t.dom_element_prefix+n+"_expand_img","expand_img","down"),s.alt=o("session","expand_collapse_session"),s.title=o("session","expand_collapse_session")},t.getResourcesFromSessionObjectAndAddToSession=function(e,n){"undefined"!=typeof e.resources.resources.writtenResources&&forEach(e.resources.resources.writtenResources,function(e){e.id=t.resource_id_counter,t.renderResource(t.resource_id_counter,n,"wr",e.name,e.size),t.resource_id_counter+=1}),"undefined"!=typeof e.resources.resources.mediaFiles&&forEach(e.resources.resources.mediaFiles,function(e){e.id=t.resource_id_counter,t.renderResource(e.id,n,"mf",e.name,e.size),t.resource_id_counter+=1}),t.refreshResources(t.getSessionIndexFromID(n))},t.makeSpecialFormInput=function(e,n,t){"actors"==e.name&&(dom.br(n),dom.make("div",t+"actors","actors",n),dom.make("div",t+"addActors_div","actors",n)),"resources"==e.name&&(dom.make("div",t+"resources","mfs",n),dom.make("div",t+"add_mf_div","",n))},t.refreshActorName=function(e,a){var i=n.getIndexByID(a),r=""!=n.actors[i].name?n.actors[i].name:o("actors","unnamed_actor"),s=g(t.dom_element_prefix+e+"_actor_"+a+"_label");s.innerHTML="<h2 class='actor_name_disp'>"+r+"</h2>",s.innerHTML+="<p class='actor_role_disp'>"+n.actors[i].role+"</p>"},t.getName=function(e){return""===t.sessions[e].name?o("session","unnamed_session"):o("session","session")+": "+t.sessions[e].name},t.getSessionIndexFromID=function(e){var n=getIndex(t.sessions,"id",e);return"undefined"==typeof n&&(console.error("An error has occured.\nCould not find session index from session_id!\n\nsession_id = "+e),console.error(sessions)),n},t.refreshActorListInSession=function(e,a){var i=g(t.dom_element_prefix+t.sessions[e].id+"_actors_addActors_div");i.innerHTML="";var r=document.createElement("select");if(forEach(n.actors,function(e,n){var t=""!=e.name?e.name:o("actors","unnamed_actor"),a=t+" ("+e.role+")";dom.appendOption(r,a,n)}),n.actors.length>0&&(i.appendChild(r),r.selectedIndex=0,dom.br(i),dom.button(i,o("session","add_to_session"),function(e){return function(){t.addActor(e,n.actors[r.selectedIndex].id)}}(t.sessions[e].id))),0===n.actors.length){var s=dom.h5(i,o("session","no_actors_in_db_yet")+"<br>");dom.link(s,"","",o("session","create_some_actors"),function(){APP.view(n)})}console.log("Refreshing Actor List of Session "+e),forEach(t.sessions[e].actors.actors,function(n){console.log("Trying to find id "+n+" in actors of session "+e),-1==a.indexOf(n)&&(console.log("There is an actor in session "+e+" that does not exist anymore. Deleting!"),t.removeActor(t.sessions[e].id,n))})},t.refreshActorLists=function(e){for(var n=getArrayWithIDs(e),o=0;o<t.sessions.length;o++)t.refreshActorListInSession(o,n)},t.sortAlphabetically=function(){t.refreshSessionsArray(),t.sessions=sortBySubKey(t.sessions,["session","name"]),t.refreshSessionsDisplay(),console.log("Sessions sorted by name")},t.userErase=function(e){APP.confirm(o("session","really_erase_session"),function(n){n||(t.erase(e),APP.log(o("session","session_deleted")))},o("no"),o("session","yes_delete_session"))},t.erase=function(e){dom.remove(t.dom_element_prefix+e),t.sessions.splice(t.getSessionIndexFromID(e),1),0===t.sessions.length&&t.displayNoSessionText()},t.getIndexFromResourceID=function(e){for(var n,o=0;o<t.sessions.length;o++){for(n=0;n<t.sessions[o].resources.resources.writtenResources.length;n++)if(t.sessions[o].resources.resources.writtenResources[n].id==e)return n;for(n=0;n<t.sessions[o].resources.resources.mediaFiles.length;n++)if(t.sessions[o].resources.resources.mediaFiles[n].id==e)return n}},t.displayNoSessionText=function(){console.log("Showing no session text");var e=g(APP.CONF.view_id_prefix+t.identity.id);e.innerHTML="";var n=dom.make("h2","no_session_text","no_session_text",e);n.innerHTML=o("session","this_corpus_contains_no_sessions_yet")+" "+o("session","why_not_create_one__before_link");var a=dom.make("a","new_session_link","new_session_link",n);a.innerHTML=o("session","why_not_create_one__link"),n.innerHTML+=o("session","why_not_create_one__after_link"),g("new_session_link").addEventListener("click",function(){t.newSession()}),e.scrollTop=0},t.eraseAll=function(){for(;t.sessions.length>0;)t.eraseLast()},t.eraseLast=function(){t.sessions.length>0?t.erase(t.sessions[t.sessions.length-1].id):alert("There is no session to be erased!\nTo erase one, you have to create one first.")},t.addActor=function(e,a){if(-1==t.sessions[t.getSessionIndexFromID(e)].actors.actors.indexOf(a)){if(!n.actors[n.getIndexByID(a)])return void console.log("Tried to add actor to session although this actor is not in the actors database. This is odd.");
t.sessions[t.getSessionIndexFromID(e)].actors.actors.push(a),t.renderActor(e,a)}else APP.log(o("session","this_actor_is_already_in_the_session"),"error")},t.renderActor=function(e,n){dom.make("div",t.dom_element_prefix+e+"_actor_"+n,"actor_in_session_wrap",g(t.dom_element_prefix+e+"_actors_actors"));dom.make("div",t.dom_element_prefix+e+"_actor_"+n+"_label","actor_in_session",g(t.dom_element_prefix+e+"_actor_"+n));t.refreshActorName(e,n),APP.GUI.icon(g(t.dom_element_prefix+e+"_actor_"+n),"delete_actor_"+n+"_icon","delete_actor_icon","reset",function(e,n){return function(){t.removeActor(e,n)}}(e,n))},t.removeActor=function(e,n){var o=t.sessions[t.getSessionIndexFromID(e)].actors.actors.indexOf(n);console.log("Removing actor. Position in array: "+o),t.sessions[t.getSessionIndexFromID(e)].actors.actors.splice(o,1),dom.remove(t.dom_element_prefix+e+"_actor_"+n)},t.addResource=function(n,a,i){var r;if(!(a>=e.available_resources.length)){var s=t.resource_id_counter,l=e.getValidityOfFile(e.available_resources[a].name).type;"Media File"==l?(r="mf",t.sessions[t.getSessionIndexFromID(n)].resources.resources.mediaFiles.push({name:e.available_resources[a].name,size:e.available_resources[a].size,id:t.resource_id_counter,resource_file_index:a})):"Written Resource"==l?(r="wr",t.sessions[t.getSessionIndexFromID(n)].resources.resources.writtenResources.push({name:e.available_resources[a].name,size:e.available_resources[a].size,id:t.resource_id_counter,resource_file_index:a})):(i||APP.alert(o("session","unknown_file_problem__before_filename")+"<br>"+e.available_resources[a].name+"<br>"+o("session","unknown_file_problem__after_filename")),r="wr",t.sessions[t.getSessionIndexFromID(n)].resources.resources.writtenResources.push({name:e.available_resources[a].name,size:e.available_resources[a].size,id:t.resource_id_counter,resource_file_index:a}));var c,d;if(-1!=a?(c=e.available_resources[a].name,d=e.available_resources[a].size):(c="",d=""),"eaf"==getFileTypeFromFilename(c)&&""===get(t.dom_element_prefix+n+"_session_name")){var u=removeEndingFromFilename(e.available_resources[a].name);g(t.dom_element_prefix+n+"_session_name").value=u,t.refreshSessionHeading(n),APP.log(o("session","session_name_taken_from_eaf"))}if("eaf"==getFileTypeFromFilename(c)&&"YYYY"==get(t.dom_element_prefix+n+"_session_date_year")){var _=parseDate(e.available_resources[a].name);null!==_&&(g(t.dom_element_prefix+n+"_session_date_year").value=_.year,g(t.dom_element_prefix+n+"_session_date_month").value=_.month,g(t.dom_element_prefix+n+"_session_date_day").value=_.day,APP.log(o("session","session_date_extracted_from_eaf_file_name")+": "+_.year+"-"+_.month+"-"+_.day))}return t.renderResource(s,n,r,c,d),t.resource_id_counter+=1,t.resource_id_counter-1}},t.renderResource=function(e,n,o,a,i){var r=dom.make("div",t.dom_element_prefix+n+"_mediafile_"+e,o,g(t.dom_element_prefix+n+"_resources_resources")),s=dom.h3(r);if("wr"==o)s.innerHTML="Written Resource";else{if("mf"!=o)return void console.log("ERROR: Strange File type!");s.innerHTML="Media File"}APP.GUI.icon(r,"delete_resource_"+e+"_icon","delete_resource_icon","reset",function(e,n){return function(){t.removeResource(e,n)}}(n,e)),dom.span(r,"","resource_file_content_span",'File Name<br><input type="text" name="'+t.dom_element_prefix+n+"_mediafile_"+e+'_name" value=""><br>Size<br><input type="text" name="'+t.dom_element_prefix+n+"_mediafile_"+e+'_size" value="">'),r.getElementsByTagName("input")[0].value=a,r.getElementsByTagName("input")[1].value=i},t.refreshSessionHeading=function(e){g(t.dom_element_prefix+e+"_label").innerHTML=""===get(t.dom_element_prefix+e+"_session_name")?o("session","unnamed_session"):o("session","session")+": "+get(t.dom_element_prefix+e+"_session_name")},t.removeResource=function(e,n){var o=getArrayWithIDs(t.sessions[t.getSessionIndexFromID(e)].resources.resources.mediaFiles),a=getArrayWithIDs(t.sessions[t.getSessionIndexFromID(e)].resources.resources.writtenResources);-1!=a.indexOf(n)&&t.sessions[t.getSessionIndexFromID(e)].resources.resources.writtenResources.splice(t.getIndexFromResourceID(n),1),-1!=o.indexOf(n)&&t.sessions[t.getSessionIndexFromID(e)].resources.resources.mediaFiles.splice(t.getIndexFromResourceID(n),1),dom.remove(t.dom_element_prefix+e+"_mediafile_"+n)},t.assignSession1Metadata=function(){var e=a;if(t.sessions.length<2)return void APP.log(o("session","at_least_2_sessions_to_assign_metadata"),"error");for(var n=0;n<e.fields_to_copy.length;n++)if(g(APP.CONF.copy_checkbox_element_prefix+e.fields_to_copy[n].name).checked){if("actors"==e.fields_to_copy[n].name)for(var i=1;i<t.sessions.length;i++)t.removeAllActors(t.sessions[i].id),forEach(t.sessions[0].actors.actors,function(e){t.addActor(t.sessions[i].id,e)});t.copyFieldsToAllSessions(e.fields_to_copy[n].fields)}APP.log(o("session","session_1_metadata_assigned_to_all_sessions"))},t.copyFieldsToAllSessions=function(e){for(var n=1;n<t.sessions.length;n++)forEach(e,function(e){APP.GUI.copyField(t.dom_element_prefix+t.sessions[n].id+"_"+e,t.dom_element_prefix+t.sessions[0].id+"_"+e)})},t.removeAllActors=function(e){for(;t.sessions[t.getSessionIndexFromID(e)].actors.actors.length>0;)t.removeActor(e,t.sessions[t.getSessionIndexFromID(e)].actors.actors[0])},t.refreshResourcesOfAllSessions=function(){for(var e=0;e<t.sessions.length;e++)t.refreshResources(e)},t.areAllSessionsNamed=function(){for(var e=0;e<t.sessions.length;e++)if(""===get(t.dom_element_prefix+t.sessions[e].id+"_session_name"))return!1;return!0},t.areAllSessionsProperlyNamed=function(){for(var e=0;e<t.sessions.length;e++){if(""===get(t.dom_element_prefix+t.sessions[e].id+"_session_name"))return!1;for(var n=0;n<t.parent.not_allowed_chars.length;n++)if(-1!=get(t.dom_element_prefix+t.sessions[e].id+"_session_name").indexOf(t.parent.not_allowed_chars[n]))return!1}return!0},t.doesEverySessionHaveAProjectName=function(){for(var e=0;e<t.sessions.length;e++)if(""===get(t.dom_element_prefix+t.sessions[e].id+"_project_name"))return!1;return!0},t.display=function(e){var n=t.dom_element_prefix+e+"_",o=g(n+"content");"none"!=o.style.display?(dom.hideElement(o),APP.GUI.setIcon(g(n+"expand_img"),"up"),t.sessions[t.getSessionIndexFromID(e)].expanded=!1):(dom.unhideElement(o),APP.GUI.setIcon(g(n+"expand_img"),"down"),t.sessions[t.getSessionIndexFromID(e)].expanded=!0)},t.updateActorNameInAllSessions=function(e){forEach(t.sessions,function(n){-1!=n.actors.actors.indexOf(e)&&t.refreshActorName(n.id,e)})},t.checkAllSessionNamesForInvalidChars=function(){forEach(t.sessions,t.checkSessionNameForInvalidChar),t.refreshSessionsDisplay()},t.checkSessionNameForInvalidChar=function(e){var n=get("session_"+e.id+"_session_name");n=replaceAccentBearingLettersWithASCISubstitute(n),n=removeAllCharactersFromStringExcept(n,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"),e.session.name=n},t}(imdi_environment.workflow[1],imdi_environment.workflow[2]),imdi_environment.workflow[4]=function(){"use strict";var e,n,t={};t.parent=imdi_environment;var o=t.parent.l;return t.identity={id:"xml_output",title:"XML Output",icon:"data"},t.not_allowed_chars=" !\"§$%&/\\()=?^°`´'#*+~<>[]{}|²³,.;:",t.init=function(){e=imdi_environment.workflow[0],n=imdi_environment.workflow[3],t.createOutputFormatSelect(t.formats())},t.formats=function(){return[{title:o("output","imdi"),name:"imdi",file_ending:"imdi",output_name:"IMDI",generator_object:imdi_environment.imdi_generator},{title:o("output","cmdi_with_imdi_profile"),name:"cmdi-imdi",file_ending:"cmdi",output_name:"CMDI",generator_object:imdi_environment.cmdi_generator}]},t.createOutputFormatSelect=function(e){var n=g("output_format_select");dom.makeRadios(n,e,"output_format","output_format_radio_","title","name",0,void 0)},t.view=function(){return""===get("corpus_name")&&0===n.sessions.length?(APP.alert(o("output","you_must_create_some_sessions_first")),void APP.view(n)):""===get("corpus_name")||e.isCorpusProperlyNamed()?n.areAllSessionsNamed()?n.areAllSessionsProperlyNamed()?n.doesEverySessionHaveAProjectName()?void t.generate():(APP.alert(o("output","every_session_must_have_a_project_name")),void APP.view(n)):(APP.view(n),void APP.alert(o("output","sessions_must_have_proper_name")+"<br>"+o("output","not_allowed_chars_are")+t.not_allowed_chars+"<br>"+o("output","spaces_are_not_allowed_either"))):(APP.view(n),void APP.alert(o("output","sessions_must_have_name"))):(APP.view(e),void APP.alert(o("output","corpus_must_have_proper_name")+"<br>"+o("output","not_allowed_chars_are")+t.not_allowed_chars+"<br>"+o("output","spaces_are_not_allowed_either")))},t.functions=function(){return[{id:"link_export_corpus",icon:"download",label:o("output","download_corpus_including_all_sessions"),onclick:function(){APP.saveAllOutputFiles()}},{id:"link_export_corpus_as_zip",icon:"download",label:o("output","download_zip_archive"),onclick:function(){APP.zipAllOutputFiles()}}]},t.generate=function(){var e,o=g("VIEW_xml_output");o.innerHTML="";var a=dom.getSelectedRadioIndex(document.getElementsByName("output_format")),i=(new t.formats)[a].generator_object(),r=t.formats()[a].output_name,s=t.formats()[a].file_ending;""!==get("corpus_name")&&(e=get("corpus_name")+"."+s,APP.GUI.createXMLOutputDIV(o,r+" Corpus","textarea_corpus",i.corpus,e));for(var l=0;l<n.sessions.length;l++)e=get(n.dom_element_prefix+n.sessions[l].id+"_session_name")+"."+s,APP.GUI.createXMLOutputDIV(o,r+" Session "+(l+1),"textarea_session_"+l,i.sessions[l],e)},t}();var eldp_environment=function(){var e={};return e.name="eldp",e.id="eldp",e.title="ELDP (beta)",e.workflow=[],e.languages=[],e.not_allowed_chars=" !\"§$%&/\\()=?^°`´'#*+~<>[]{}|²³,.;:áÁäÄàÀéÉîöÖóÓòÒüÜúÚùÙ",e.l=function(n,t,o){return APP.getTermInActiveLanguage(e.languages,n,t,o)},e.metadataLanguageIDs=[["eng","English"],["ger","German"],["spa","Spanish"],["fra","French"],["rus","Russian"],["ind","Indonesian"],["por","Portuguese"],["arb","Standard Arabic"]],e.init=function(){e.displayMetadataLanguages()},e.displayMetadataLanguages=function(){var n=g("metadata_language_select");dom.setSelectOptions(n,e.metadataLanguageIDs,1,0,!1)},e.settings=function(){return[{title:e.l("settings","calculate_persons_age"),description:e.l("settings","calculate_persons_age_description"),type:"toggle",default_value:!0,name:"radio_age_calc",id:"radio_age_calc"},{title:e.l("settings","global_language_of_metadata"),type:"select",name:"metadata_language",id:"metadata_language_select"},{title:e.l("settings","cmdi_metadata_creator"),description:e.l("settings","cmdi_metadata_creator_description"),type:"text",name:"metadata_creator",id:"metadata_creator",value:"CMDI Maker User"}]},e.recall=function(){},e.getSaveData=function(){var e={};return e.calc_actors_age=document.getElementsByName("radio_age_calc")[0].checked?!0:!1,e},e.reset=function(){},APP.environments.add(e),e}();eldp_environment.languages[0]={id:"english",name:"English",workflow:{resources:"Resources",persons:"Persons",bundles:"Bundles",xml_output:"XML Output"},settings:{calculate_persons_age:"Calculate Person's Age",calculate_persons_age_description:"When this feature is activated, CMDI Maker checks if the age of an person (if it has not been specified already) can be calculated from the person's birth date and the bundle date.<br>When an age can be calculated, it will appear in the output file.<br>(Age = Bundle Date - person's Birth Date)",output_format:"Output Format",export_persons_as_json:"Export persons as JSON",import_persons_from_json_or_imdi:"Import persons from JSON or IMDI",import_persons_description:"Please import UTF-8 encoded files only!",delete_persons_database:"Delete persons Database",delete_persons_database_description:"CMDI Maker saves all your persons in a Web Storage browser database, so that they are kept, even if you close the browser window.",global_language_of_metadata:"Global Language of Metadata",cmdi_metadata_creator:"CMDI Metadata Creator",cmdi_metadata_creator_description:"The CMDI metadata format requires the name of a metadata creator. This is probably you. If so, please type in your name."},languages:{set_global_languages_of_content:"Set Global Languages of Content",or_type_in_iso_code:"or type in ISO code",language_search:"Language Search",result:"result",results:"results",language_name:"Language Name",is_new_global:"is a new Global Content Language",iso_code:"ISO code",not_found_in_db:"not found in database",specify_search_request_at_least_3_chars:"Please specify your search request.\nType in at least 3 characters.",primary_language:"Primary Language",mother_tongue:"Mother Tongue",current_content_languages:"Current Content Languages",content_language_removed__before_lang:'Content Language "',content_language_removed__after_lang:'" removed',additional_information:"Additional Information"},resources:{unknown:"Unknown",create_one_bundle_per_file:"Create one bundle per file",files:"Files",selected_files:"Selected Files",sort_alphabetically:"Sort Files alphabetically",remove:"Remove",clear_file_list:"Clear File List",usage:"Usage",click:"Click",click_to_select:"Select resource, click again to deselect a single resource",shift:"Shift",shift_to_select_multiple:"Hold shift to select multiple resources",escape:"Escape",escape_to_deselect:"Press escape to deselect all resources",size:"Size",path:"Path",last_modified:"Last modified",no_resource_files_imported:"No resource files imported.",fade:"Fade",fade_explanation:"Resources are faded down when they will be included in bundles.<br>This is to prevent selecting them mistakenly.",set_for_all:"Set for all"},persons:{new_person:"New Person",delete_this_person:"Delete this person",sort_persons_alphabetically:"Sort persons alphabetically",persons_alphabetically_sorted:"persons sorted",save_and_duplicate_this_person:"Save and duplicate this person",duplicate_this_person:"Duplicate this person",yes_delete_all_persons:"Yes, delete all persons",no:"No",ok:"OK",confirm_erasing_persons_db:"Really?<br>You want to erase the whole persons database?",all_persons_deleted:"All persons deleted",save_person:"Save person",save_changes_to_this_person:"Save changes to this person",there_are_no_persons:"There are no persons!",persons_imported:"persons imported",person_saved_and_duplicated:"Person saved and duplicated.",give_your_person_a_name_first:"Please give your person a name first.",yes_delete_person:"Yes, delete person",really_erase_before_name:"Really?<br>You want to erase ",really_erase_after_name:"?",person_deleted_before_name:"",person_deleted_after_name:" deleted",there_are_no_persons_yet:"There are no persons yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",please_give_all_persons_a_name_before_creating_new_one:"Please give all your persons a name first, before creating a new one!",really_erase_this_person:"Really?<br>You want to erase this person?",unnamed_person:"Unnamed person"},bundle:{new_bundle:"New Bundle",copy_bundle_1_metadata:"Copy Bundle 1 metadata to all bundles",reset_form:"Reset Form",sort_by_name:"Sort by name",add_to_bundle:"Add to bundle",no_files_have_been_added:"No files have been added.",add_some_files:"Add some files.",new_bundle_has_been_created:"A new bundle has been created.",name:"Name",unnamed_bundle:"Unnamed Bundle",bundle:"Bundle",delete_bundle:"Delete Bundle",expand_bundle:"Expand Bundle",collapse_bundle:"Collapse Bundle",expand_collapse_bundle:"Expand/collapse bundle",no_persons_created_yet:"No persons have been created yet.",create_some_persons:"Create some persons.",really_erase_bundle:"Really?<br>You want to erase a whole bundle? Are you sure about that?",yes_delete_bundle:"Yes, delete bundle",bundle_deleted:"Bundle deleted",no_bundles_have_been_created_yet:"No bundles have been created yet.",why_not_create_one__before_link:"Why not ",why_not_create_one__link:"create one",why_not_create_one__after_link:"?",this_person_is_already_in_the_bundle:"This person is already in the bundle.",unknown_file_problem__before_filename:"We have a problem.<br>I don't know if this file is a Media File or a Written Resource:",unknown_file_problem__after_filename:"As for now, I will handle it as a written resource. But you really shouldn't do that.",bundle_name_taken_from_eaf:"Bundle name has been taken from EAF file name, since bundle has not been manually named yet.",bundle_date_extracted_from_eaf_file_name:"Bundle date has been extracted from EAF file name",at_least_2_bundles_to_assign_metadata:"There have to be at least 2 bundles to assign metadata from one to another.",bundle_1_metadata_assigned_to_all_bundles:"Bundle 1 metadata assigned to all bundles.",this_function_is_currently_unavailable:"This function is currently unavailable!",no:"No",yes_delete_form:"Yes, delete form",really_reset_form:"Really?<br>You want to reset the form and delete all bundles?",form_reset:"Form reset",specify_local_used_language_name:"Specify local used language name",subject_language:"Subject Language",content_language:"Content Language",working_language:"Working Language",really_erase_bundle:"Really?<br>You want to erase a whole bundle? Are you sure about that?",object:"Object",file_name:"File Name",size:"Size",copy_metadata:"Copy Metadata",from_bundle_1_to_all_others:"From Bundle 1 to all others",from_2nd_last_to_last_bundle:"From second last to last bundle",elements_to_copy:"Elements to copy",from_where_to_where:"From where to where",metadata_copied:"Metadata copied",bundle_title_taken_from_eaf:"Bundle title has been taken from EAF file name, since bundle has not been manually named yet.",bundles_must_have_one_language:"Every bundle must have at least one language."},output:{bundles_must_have_proper_name:"All bundles must have proper names! Not allowed chars are: <br>",you_must_create_some_bundles_first:"You must create some bundles first!",every_bundle_must_have_a_project_name:"Every bundle must have a project name!",corpus_must_have_proper_name:"The corpus must have a proper name or no name at all.",bundles_must_have_proper_name:"Every bundle must have a proper name.<br>Unnamed bundles are not allowed.",download_corpus_including_all_bundles:"Download Corpus including all Bundles",download_zip_archive:"Download ZIP archive",not_allowed_chars_are:"Not allowed chars are: ",spaces_are_not_allowed_either:"Space characters are not allowed either.",persons_must_have_valid_birth_year:"Every person must have a valid birth year!"},really_overwrite_data:"Do you really want to overwrite data?",yes_overwrite_data:"Yes, overwrite data"},eldp_environment.languages[1]={id:"german",name:"Deutsch",workflow:{resources:"Resources",persons:"Persons",bundles:"Bundles",xml_output:"XML Output"},settings:{calculate_persons_age:"Automatische Altersberechnung von Personen",calculate_persons_age_description:"Wenn diese Funktion aktiviert ist, prüft CMDI Maker, ob das Alter einer Person (wenn es noch nicht angegeben worden ist) aus dem Geburtsdatum der Person und dem Datum des Bundles berechnet werden kann.<br>Wenn ein Alter berechnet werden kann, erscheint dieses in der generierten XML-Datei.<br>(Alter = Datum der Session - Geburtsdatum der Person)",output_format:"Ausgabeformat",export_persons_as_json:"Personen als JSON exportieren",import_persons_from_json:"Personen aus JSON importieren",import_persons_description:"Bitte importiere nur Dateien mit der Zeichenkodierung UTF-8!",delete_persons_database:"Alle Personen löschen",global_language_of_metadata:"Globale Metadaten-Sprache",cmdi_metadata_creator:"CMDI: Urheber der Metadaten",cmdi_metadata_creator_description:"Das CMDI-Metadatenformat setzt die Angabe eines Urhebers voraus. Das bist wahrscheinlich du! Gib in diesem Fall deinen Namen ein."},languages:{language_search:"Sprachsuche",language_name:"Language Name",iso_code:"ISO code",not_found_in_db:"wurde nicht gefunden",specify_search_request_at_least_3_chars:"Bitte sei etwas genauer.\nGib mindestens 3 Zeichen ins Suchfeld ein.",primary_language:"Primärsprache",mother_tongue:"Muttersprache",additional_information:"Additional Information"},resources:{unknown:"Unbekannt",create_one_bundle_per_file:"Ein Bundle pro Datei erstellen",files:"Dateien",selected_files:"Ausgewählte Dateien",sort_alphabetically:"Alphabetisch sortieren",remove:"Entfernen",clear_file_list:"Dateiliste löschen",usage:"Benutzung",click:"Klick",click_to_select:"Datei wird ausgewählt, noch ein Klick macht die Auswahl rückgängig",shift:"Shift",shift_to_select_multiple:"Halte Shift, um mehrere Dateien auf einmal auszuwählen",escape:"Escape",escape_to_deselect:"Alle Dateien werden deselektiert",size:"Größe",path:"Pfad",last_modified:"Letzte Änderung",no_resource_files_imported:"Keine Dateien importiert.",fade:"Ausgeblendete Dateien",fade_explanation:"Dateien werden ausgeblendet, wenn sie in einem Bundle enthalten sein werden.<br>Dies soll das versehentliche Auswählen dieser verhindern.",set_for_all:"Für alle festlegen"},persons:{new_person:"Neue Person",delete_this_person:"Diese Person löschen",sort_persons_alphabetically:"Alphabetisch sortieren",persons_alphabetically_sorted:"Personen sortiert",duplicate_this_person:"Diese Person duplizieren",yes_delete_all_persons:"Ja, alle Personen löschen",no:"Nein",ok:"OK",confirm_erasing_persons_db:"Willst du wirklich alle Personen löschen?",all_persons_deleted:"Alle Personen gelöscht",there_are_no_persons:"Es existieren keine Personen!",persons_imported:"Personen importiert",give_your_person_a_name_first:"Bitte gib der Person zuerst einen Namen.",yes_delete_person:"Ja, Person löschen",really_erase_before_name:"Willst du wirklich ",really_erase_after_name:" löschen?",person_deleted_before_name:"",person_deleted_after_name:" gelöscht",there_are_no_persons_yet:"Es existieren noch keine Personen.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eine?",please_give_all_persons_a_name_before_creating_new_one:"Bitte gib allen Personen einen Namen, bevor du eine neue erstellst!",really_erase_this_person:"Willst du diese Person wirklich löschen?",unnamed_person:"Unbenannte Person"},bundle:{new_bundle:"Neues Bundle",copy_bundle_1_metadata:"Dupliziere Bundle-1-Metadaten in allen Bundles",reset_form:"Formular zurücksetzen",sort_by_name:"Nach Namen sortieren",add_to_bundle:"Hinzufügen",no_files_have_been_added:"Es wurden noch keine Dateien importiert.",add_some_files:"Importiere welche.",new_bundle_has_been_created:"Ein neues Bundle wurde erstellt.",name:"Name",unnamed_bundle:"Unbenanntes Bundle",bundle:"Bundle",delete_bundle:"Bundle löschen",expand_bundle:"Bundle ausklappen",collapse_bundle:"Bundle minimieren",expand_collapse_bundle:"Bundle ausklappen/minimieren",no_persons_created_yet:"Es wurden noch keine Personen erstellt.",create_some_persons:"Erstelle welche.",really_erase_bundle:"Willst du wirklich ein komplettes Bundle löschen?",yes_delete_bundle:"Ja, Bundle löschen",bundle_deleted:"Bundle gelöscht",no_bundles_have_been_created_yet:"Es wurden noch keine Bundles erstellt.",why_not_create_one__before_link:"Warum ",why_not_create_one__link:"erstellst",why_not_create_one__after_link:" du nicht eins?",this_person_is_already_in_the_bundle:"Diese Person wurde bereits zum Bundle hinzugefügt.",bundle_name_taken_from_eaf:"Der Bundle-Name wurde vom Dateinamen der EAF-Datei übernommen, da die Session noch keinen Namen hatte.",bundle_date_extracted_from_eaf_file_name:"Das Datum des Bundles wurde aus dem Dateinamen der EAF-Datei extrahiert.",at_least_2_bundles_to_assign_metadata:"Es muss mindestens 2 Bundles geben, damit von einer Session in die andere kopiert werden können.",bundle_1_metadata_assigned_to_all_bundles:"Die Metadaten von Bundle 1 wurden in allen Sessions dupliziert.",this_function_is_currently_unavailable:"Diese Funktion ist zur Zeit nicht verfügbar!",no:"Nein",yes_delete_form:"Ja, Formular zurücksetzen",really_reset_form:"Willst du das Formular wirklich zurücksetzen und alle Bundles löschen?",form_reset:"Formular zurückgesetzt",specify_local_used_language_name:"Gib den lokal benutzten Sprachnamen ein",subject_language:"Subject Language",content_language:"Content Language",working_language:"Working Language",object:"Object",file_name:"Dateiname",copy_metadata:"Metadaten kopieren",from_bundle_1_to_all_others:"Von Bundle 1 in alle anderen Bundles",from_2nd_last_to_last_bundle:"Vom vorletzten Bundle ins letzte Bundle",elements_to_copy:"Zu kopierende Elemente",from_where_to_where:"Von wo nach wo",metadata_copied:"Metadaten kopiert"},output:{bundles_must_have_proper_name:"Jedes Bundle muss einen validen Namen haben!",you_must_create_some_bundles_first:"Du musst zuerst Bundles erstellen!",download_corpus_including_all_bundles:"Corpus mit allen Bundles herunterladen",download_zip_archive:"ZIP-Archiv herunterladen",not_allowed_chars_are:"Nicht erlaubte Zeichen sind: ",spaces_are_not_allowed_either:"Leerzeichen sind auch nicht erlaubt.",bundles_must_have_one_language:"Jedes Bundle muss mindestens eine Language haben.",persons_must_have_valid_birth_year:"Jede Person muss ein valides Birth Year haben!"},really_overwrite_data:"Möchtest Du wirklich Daten überschreiben?",yes_overwrite_data:"Ja, Daten überschreiben"},eldp_environment.bundle_form={title:"eldp-form",type:"form",fields:[{title:"Bundle",name:"bundle",type:"column",fields:[{heading:"Title",name:"title",type:"text",comment:"An informative title, without abbreviations, given to the Project, Bundle or resource."},{heading:"ID",name:"id_element",type:"text",comment:"A unique identifier."},{heading:"Date",name:"date",type:"date",comment:"In general the primary date of the bundle is audio or video date. If this bundle is about written resources only it indicates the creation date of the primary document."},{heading:"Description",name:"description",type:"textarea",comment:"Here a relevant description referring to the bundle as a whole can be given. Example: A conversation of mother, father and child at the breakfast table."},{heading:"Additional Information of Bundle",name:"additional_information",type:"textarea"},{heading:"Location",name:"location",type:"subarea",fields:[{heading:"Name",name:"name",type:"text",comment:""},{heading:"Continent",name:"continent",type:"select",size:1,vocabulary:["Unknown","Unspecified","Africa","Asia","Europe","Australia","Oceania","North-America","Middle-America","South-America"],default_value:"Unspecified",comment:'If the document is about "the languages of South-America", only Continent is supposed to be specified.'},{heading:"Country",name:"country",type:"text",comment:""},{heading:"Region",name:"region",type:"text",comment:"This element can also be used to describe sub-regions. Examples: europe, the netherlands, gelderland, achterhoek."}]}]},{title:"Content",name:"content",type:"column",comment:"The content group is used to describe the content of the bundle. This is done using four dimensions (communication context, genre, task and modalities).",fields:[{heading:"Genre",name:"genre",type:"open_vocabulary",size:1,vocabulary:["Unknown","Unspecified","Conversation","Description","Dictionary","Discourse","Elicitation","Explanation","Folktale","Historical narrative","Interview","Metadata","Narrative","Procedural narrative","Questionnaire","Ritual/religious","Song","Speech","Stimuli","Wordlist"],comment:"The conventionalized discourse types of the content of the bundle."},{heading:"Keywords",type:"textarea",name:"keywords"},{heading:"Recording Equipment",name:"recording_equipment",type:"textarea"},{heading:"Recording Conditions",name:"recording_conditions",type:"textarea"}]},{title:"Languages",name:"languages",type:"column",fields:[{name:"bundle_languages",type:"special",object_structure:"array"}]},{title:"Persons",type:"column",name:"persons",fields:[{heading:"Description of Persons",type:"textarea",comment:"Note that this description concerns all Persons and should be used to describe interactions and interrelations between Persons.",name:"description"},{type:"special",name:"persons",object_structure:"array"}]},{title:"Objects",name:"resources",type:"column",fields:[{type:"special",name:"resources",object_structure:"array"},{heading:"Restrictions of Access",type:"textarea",name:"access_restrictions"},{heading:"Conditions of Access",type:"textarea",name:"access_conditions"}]}],fields_to_copy:[{name:"date",label:"Date",fields:["bundle_date"]},{name:"location",label:"Location",fields:["bundle_location"]},{name:"content",label:"Content",fields:["content"]},{name:"persons",label:"Persons",fields:["persons_description"]},{name:"languages",label:"Languages",fields:[]},{name:"recording_equipment_conditions",label:"Recording Equipment/Conditions",fields:["resources_recording_equipment","resources_recording_conditions"]}]},eldp_environment.person_form={title:"eldp-actors",type:"form",fields:[{type:"column",fields:[{heading:"Title",name:"title",type:"text"},{heading:"Name (known as)",name:"nameKnownAs",type:"text"},{heading:"Name (Full Name)",name:"fullName",type:"text"},{heading:"Name (Sort By)",name:"nameSortBy",type:"text"},{heading:"Code",name:"code",type:"text",comment:"Short unique code to identify the actor as used in the transcription"},{heading:"Birth Year",name:"birth_year",type:"year"},{heading:"Death Year",name:"death_year",type:"year"},{heading:"Sex",name:"sex",type:"select",vocabulary:["Unknown","Unspecified","Female","Male"],default_value:"Unspecified"}]},{title:"",name:"",type:"column",fields:[{heading:"Ethnicities",name:"ethnicity",type:"textarea"},{heading:"Additional Information (Ethnicity)",name:"ethnicity_additional_info",type:"textarea"},{heading:"Nationalities",name:"nationality",type:"textarea"},{heading:"Additional Information (Nationality)",name:"nationality_additional_info",type:"textarea"}]},{type:"column",fields:[{heading:"Education",name:"education",type:"text"},{heading:"Additional Information (Person)",name:"person_additional_information",type:"textarea"},{heading:"Biographical Note",name:"biographical_note",type:"textarea"},{heading:"Anonymized",name:"anonymized",type:"check",comment:"Indicates if real names or anonymized codes are used to identify the actor"}]},{title:"Languages",name:"languages",type:"column",fields:[{heading:"Actor Languages",name:"actor_languages",type:"special",object_structure:"array"}]}]},eldp_environment.workflow[0]=function(){"use strict";var e,n={};return n.parent=eldp_environment,n.l=n.parent.l,n.fileSelection=void 0,n.resources=new ObjectList,n.identity={id:"resources",title:"Resources",icon:"blocks"},n.view_id="VIEW_resources",n.substitute_for_bad_chars="_",n.init=function(t){e=eldp_environment.workflow[2];var o=dom.make("div","files","",t);dom.h3(o,"Import Files");APP.GUI.FORMS.fileDropZone(o,"drop_zone",n.pushFileMetadata);dom.h3(o,"Import File List");var a=dom.input(o,"file_list_import_input","","","file");a.addEventListener("change",n.handleFileListInputChange,!1);{var i=(dom.make("div","","workspace-usageTable",o,"<h3>"+n.l("resources","usage")+"</h3><h4>"+n.l("resources","click")+"</h4><p>"+n.l("resources","click_to_select")+"</p><h4>"+n.l("resources","shift")+"</h4><p>"+n.l("resources","shift_to_select_multiple")+"</p><h4>"+n.l("resources","escape")+"</h4><p>"+n.l("resources","escape_to_deselect")+"</p><h4>"+n.l("resources","fade")+"</h4><p>"+n.l("resources","fade_explanation")+"</p>"),dom.make("div","file_list_div","",t));dom.make("div","list","",i)}n.fileSelection=new APP.GUI.selectionMechanism("file_entry_","selected_file",function(e){n.resources.get(e.index).selected=e.selected,n.fadeFilesThatStartWithSameNameAsSelectedOnes()}),n.refreshFileListDisplay(!0)},n.view=function(){APP.GUI.scrollTop()},n.getFileType=function(e){var t=n.file_types,o=e.lastIndexOf("."),i=e.slice(o+1),r={type:n.l("resources","unknown"),mimetype:n.l("resources","unknown")},s=a(t.valid_lamus_written_resource_file_types,0),l=s.indexOf(i);return-1!=s.indexOf(i)?(r.type=t.valid_lamus_written_resource_file_types[l][2],r.mimetype=t.valid_lamus_written_resource_file_types[l][1],r):(s=a(t.valid_lamus_media_file_types,0),l=s.indexOf(i),-1!=s.indexOf(i)?(r.type=t.valid_lamus_media_file_types[l][2],r.mimetype=t.valid_lamus_media_file_types[l][1],r):(s=a(t.invalid_lamus_media_file_types,0),l=s.indexOf(i),-1!=l?(r.type=t.invalid_lamus_media_file_types[l][2],r.mimetype=t.invalid_lamus_media_file_types[l][1],r):(s=a(t.invalid_lamus_written_resource_file_types,0),l=s.indexOf(i),-1!=l?(r.type=t.invalid_lamus_written_resource_file_types[l][2],r.mimetype=t.invalid_lamus_written_resource_file_types[l][1],r):r)))
},n.file_types={valid_lamus_written_resource_file_types:[["eaf","text/x-eaf+xml","Annotation"],["mdf","Unknown","Unspecified"],["pdf","application/pdf","Primary Text"],["xml","text/xml","Annotation"],["txt","text/plain","Unspecified"],["htm","text/html","Unspecified"],["html","text/html","Unspecified"]],valid_lamus_media_file_types:[["wav","audio/x-wav","audio"],["mpg","video/mpeg","video"],["mpeg","video/mpeg","video"],["mp4","video/mp4","video"],["aif","audio/x-aiff","audio"],["aiff","audio/x-aiff","audio"],["jpg","image/jpeg","image"],["jpeg","image/jpeg","image"],["png","image/png","image"],["tif","image/tiff","image"],["tiff","image/tiff","image"],["smil","application/smil+xml","video"]],invalid_lamus_written_resource_file_types:[["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document","Unspecified"],["doc","application/msword","Unspecified"],["odf","application/vnd.oasis.opendocument.formula","Unspecified"],["odt","application/vnd.oasis.opendocument.text","Unspecified"],["xls","application/vnd.ms-excel","Unspecified"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","Unspecified"],["ppt","application/vnd.ms-powerpoint","Unspecified"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation","Unspecified"]],invalid_lamus_media_file_types:[["mkv","Unknown","video"],["mov","video/quicktime","video"],["mp3","Unknown","audio"],["avi","video/x-msvideo","video"],["au","audio/basic","audio"]]},n.recall=function(e){n.resources.setState(e),n.refreshFileListDisplay()},n.getSaveData=function(){return n.resources.getState()},n.functions=function(){return[{label:n.l("resources","create_one_bundle_per_file"),icon:"plus",id:"crps_icon",wrapper_id:"crps_div",type:"function_wrap",sub_div:"crps_filetype_select",onclick:function(){n.createBundlePerResource(),APP.view(e)},sub_div_innerHTML:'<h3 class="inner_function_h3">'+n.l("resources","files")+'</h3><input type="radio" name="radio_file_type" value="selected" checked> '+n.l("resources","selected_files")+'<br><input type="radio" name="radio_file_type" value="eaf"> EAF<br><input type="radio" name="radio_file_type" value="wav"> WAV<br><input type="radio" name="radio_file_type" value="mpg"> MPG<br><input type="radio" name="radio_file_type" value="mp4"> MP4<br>'},{id:"link_sort_alphabetically",icon:"az",label:n.l("resources","sort_alphabetically"),onclick:function(){n.sortAlphabetically()}},{id:"link_remove_files",icon:"reset",label:n.l("resources","remove"),onclick:function(){n.removeSelectedFiles()}},{id:"link_clear_file_list",icon:"reset",label:n.l("resources","clear_file_list"),onclick:function(){n.reset()}},{id:"link_set_for_all",icon:"submit",label:n.l("resources","set_for_all"),wrapper_id:"sfa_div",type:"function_wrap",sub_div:"sfa_select",onclick:function(){n.setForAll()},sub_div_innerHTML:'<input type="radio" name="status_for_all" id="stable_for_all" value="stable" checked> Stable<br><input type="radio" name="status_for_all" id="inProgress_for_all" value="in-progress"> In Progress<br>'}]},n.setForAll=function(){console.log(dom.getSelectedRadioValue("status_for_all")),n.resources.setForAll("status",dom.getSelectedRadioValue("status_for_all")),n.refreshFileListDisplay()},n.getValidityOfFile=function(e){var t,o=getFileTypeFromFilename(e);for(t=0;t<n.file_types.valid_lamus_media_file_types.length;t++)if(o==n.file_types.valid_lamus_media_file_types[t][0])return 0;for(t=0;t<n.file_types.valid_lamus_written_resource_file_types.length;t++)if(o==n.file_types.valid_lamus_written_resource_file_types[t][0])return 1;for(t=0;t<n.file_types.invalid_lamus_media_file_types.length;t++)if(o==n.file_types.invalid_lamus_media_file_types[t][0])return 2;for(t=0;t<n.file_types.invalid_lamus_written_resource_file_types.length;t++)if(o==n.file_types.invalid_lamus_written_resource_file_types[t][0])return 3;return-1},n.refreshFileListDisplay=function(t){var o=g("list");o.innerHTML="",n.resources.forEach(function(e,t){n.renderResource({number:t,title:e.name,mime_type:e.mime_type,file_size:e.size,lastModified:e.lastModified,id:"file_entry_"+t,className:"file_entry media_file_entry",parent:o,status:e.status,path:e.path})}),0===n.resources.length&&(o.innerHTML="<h2>"+n.l("resources","no_resource_files_imported")+"</h2>"),e&&!t&&e.refreshResourcesOfAllBundles(n.resources.getAll()),n.fileSelection.selected_files=[]},n.refreshFileStateValues=function(e){n.resources.get(e).status=dom.getSelectedRadioValue("f_"+e+"_status")},n.renderResource=function(e){var t=dom.make("div",e.id,e.className,e.parent),o=(dom.make("h2","","file_entry_title",t,e.title),dom.make("p","","",t,e.mimeType+'<br><span class="size_span">'+n.l("resources","size")+": "+e.file_size+'</span><br><span name="date_span" class="date_span">'+n.l("resources","last_modified")+": "+e.lastModified+'</span><br><span name="path_span" class="date_span">'+n.l("resources","path")+": "+e.path+"</span>"),dom.make("input","f_stable_"+e.number,"",t));o.type="radio",o.value="stable",o.name="f_"+e.number+"_status",o.addEventListener("click",function(t){t.stopPropagation(),n.refreshFileStateValues(e.number)});dom.make("span","","",t," Stable");"stable"==e.status&&(o.checked=!0),dom.br(t);var a=dom.make("input","f_inProgress_"+e.number,"",t);a.type="radio",a.value="in-progress",a.name="f_"+e.number+"_status",a.addEventListener("click",function(t){t.stopPropagation(),n.refreshFileStateValues(e.number)});dom.make("span","","",t," In Progress");"in-progress"==e.status&&(a.checked=!0),t.addEventListener("click",function(e){return function(){n.fileSelection.clickedOnFile(e)}}(e.number),!1)},n.pushFileMetadata=function(e){for(var t,o=0;t=e[o];o++)n.resources.add({name:t.name,type:t.type||"n/a",size:bytesToSize(t.size,1),lastModified:t.lastModifiedDate.toLocaleDateString(),status:"stable"});n.refreshFileListDisplay()},n.sortAlphabetically=function(){n.resources.sortByKey("name"),n.refreshFileListDisplay()},n.createBundlePerResource=function(){var e,t=dom.getByName("radio_file_type"),o=dom.getSelectedRadioValue(t);if(console.log("Searching for files of chosen file type "+o),"selected"!=o)for(e=0;e<n.resources.length;e++){var a=getFileTypeFromFilename(n.resources.get(e).name);a==o&&(console.log("Found a file of file type "+o),n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd(n.resources.idOf(e)))}else for(console.log("Searching for selected files"),e=0;e<n.fileSelection.selected_files.length;e++){var i=n.resources.idOf(n.fileSelection.selected_files[e]);n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd(i)}},n.removeSelectedFiles=function(){var e=n.fileSelection.selected_files,t=n.resources.mapIndexesToIDs(e);n.resources.removeByID(t),n.refreshFileListDisplay()},n.createBundleWithResourceAndCheckForAdditionalResourcesToAdd=function(t){var o=replaceAccentBearingLettersWithASCISubstitute(removeEndingFromFilename(n.resources.getByID(t).name));o=replaceCharactersInStringWithSubstitute(o,n.parent.not_allowed_chars,n.substitute_for_bad_chars);var a=!1,i=[];i.push(t);var r=n.getIDsOfResourcesThatStartWithTheSameNameAsThis(t);i.push.apply(i,r),e.createNewBundleWithResources(o,a,i)},n.getIDsOfResourcesThatStartWithTheSameNameAsThis=function(e){var t=n.resources.getByID(e),o=n.resources.filter(function(n){return e==n.id?!1:isSubstringAStartOfAWordInString(removeEndingFromFilename(n.name),removeEndingFromFilename(t.name))?!0:!1}),a=getArrayWithIDs(o);return a},n.fadeFilesThatStartWithSameNameAsSelectedOnes=function(){for(var e,t="file_entry_",o=[],a=0;a<n.resources.length;a++)g(t+a.toString()).style.opacity="1";for(var i=0;i<n.fileSelection.selected_files.length;i++){var r=n.fileSelection.selected_files[i],s=n.resources.idOf(r);o.push(s);var l=n.resources.idOf(r);e=n.getIDsOfResourcesThatStartWithTheSameNameAsThis(l);for(var c=0;c<e.length;c++)o.push(e[c])}for(a=0;a<o.length;a++){var d=n.resources.indexOf(o[a]);g(t+d.toString()).style.opacity="0.5"}},n.handleFileListInputChange=function(e){var t,o=e.target.files[0];readFileAsText(o,function(e){try{t=linesToArray(e),forEach(t,function(e){e.length>0&&" "!=e&&n.resources.add({name:getFilenameFromFilePath(e),path:getDirectoryFromFilePath(e),status:"stable"})}),n.refreshFileListDisplay()}catch(o){return void console.info("No files found! Maybe this file list is not valid!")}})},n.reset=function(){n.resources.reset(),n.refreshFileListDisplay()},n}(),eldp_environment.workflow[1]=function(){"use strict";var e=function(){forEach(s.persons.getActive().languages.actor_languages,s.languages.set)},n=function(e){if("undefined"==typeof e)return void console.error("I shall highlight a person with index = undefined! Returning!");for(var n=0;n<s.persons.length;n++)g(s.element_id_prefix+"list_entry_"+n).style.background="lightskyblue";g(s.element_id_prefix+"list_entry_"+e).style.background="#FF8BC7"},t=function(){var e=s.languages.languages_of_active_person.map(function(e){return"LOCAL"==e.name_type&&(e.name=get("person_languages_"+e.id+"_name_input")),e.additional_information=get("person_languages_"+e.id+"addInfo"),e});return e},o=function(){var e=APP.forms.createEmptyObjectFromTemplate(d);return APP.forms.fillObjectWithFormData(e,s.element_id_prefix,d),e.languages.actor_languages=t(),e},a=function(e){s.saveActivePerson(),s.show(s.persons.idOf(e))},r=function(){return!s.persons.isThereAnyItemWhereKeyIsValue("name","")},s={};s.parent=eldp_environment;var l,c=function(e,n){return s.parent.l("persons",e,n)},d=s.parent.person_form;s.persons=new ObjectList,s.element_id_prefix="person_",s.identity={id:"persons",title:"Persons",icon:"user"},s.module_view,s.init=function(e){s.persons.reset(),s.module_view=e,l=s.parent.workflow[2],s.createListDIV(e);dom.make("div",s.element_id_prefix+"view","",e);s.languages.init(),s.refreshListDisplay(!0)},s.createListDIV=function(e){dom.make("div",s.element_id_prefix+"list","",e)},s.getSaveData=function(){var e={};return s.saveActivePerson(),e.persons=s.persons.getState(),e},s.showNoPersonsMessage=function(){var e=s.module_view;e.innerHTML="";var n=dom.make("h2","no_persons_text","no_persons_text",e);n.innerHTML=c("there_are_no_persons_yet")+" "+c("why_not_create_one__before_link");var t=dom.make("a","new_person_link","new_person_link",n);t.innerHTML=c("why_not_create_one__link"),n.innerHTML+=c("why_not_create_one__after_link"),g("new_person_link").addEventListener("click",function(){s.createNewPerson()})},s.recall=function(e){e.persons&&s.persons.setState(e.persons),s.refreshListDisplay(),s.show(s.persons.getPointer())},s.functions=function(){return[{id:"link_new_person",icon:"plus",label:c("new_person"),onclick:function(){s.createNewPerson()}},{id:"link_delete_active_person",icon:"reset",label:c("delete_this_person"),onclick:function(){s.handleClickOnDeletePerson()}},{id:"link_sort_persons_alphabetically",icon:"az",label:c("sort_persons_alphabetically"),type:"function_wrap",wrapper_id:"sa_div",sub_div:"sa_subdiv",sub_div_innerHTML:'<input type="radio" name="sa_by" value="nameKnownAs"> By Name (known as)<br><input type="radio" name="sa_by" value="fullName" checked> By Full Name<br><input type="radio" name="sa_by" value="nameSortBy"> By Name (Sort By)',onclick:function(){s.saveActivePerson();var e=dom.getSelectedRadioValue(dom.getByName("sa_by"));s.persons.sortByKey(e),s.refreshListDisplay(),APP.log(c("persons_alphabetically_sorted"))}},{id:"link_duplicateActivePerson",icon:"duplicate_user",label:c("duplicate_this_person"),onclick:function(){s.saveActivePerson(),s.persons.duplicateActive(),s.refreshListDisplay(),APP.log(c("person_saved_and_duplicated"),"success")}}]},s.erase_database=function(){APP.confirm(c("confirm_erasing_persons_db"),function(e){e||(s.persons.reset(),APP.log(c("all_persons_deleted")),s.refreshListDisplay())},c("no"),c("yes_delete_all_persons"))},s.show=function(t){if(0==s.persons.length)return void console.info("person.show: No persons to show!");var o=s.persons.getIndexByID(t);"undefined"==typeof o&&(console.error("person.show: Undefined person_id!"),o=0),console.log("Showing person "+o),s.createFormIfNotExistent(),n(o),s.languages.clearActivePersonLanguages(),s.persons.setPointer(t),s.refreshFormTitle();var a=s.persons.getActive();APP.forms.fill(d,s.element_id_prefix,a),e()},s.refreshFormTitle=function(){var e=g(s.element_id_prefix+"form_title"),n=s.getDisplayName(s.persons.getPointer());e.innerHTML=""==n?c("unnamed_person"):n},s.export_persons=function(){if(0!==s.persons.length){var e=JSON.stringify(s.persons.getState());APP.save_file(e,"persons.json",APP.CONF.file_download_header)}else APP.alert(c("there_are_no_persons"))},s.createFormIfNotExistent=function(){var e=g("person_view");if(!e){e=dom.make("div","person_view","person_view",s.module_view),e.innerHTML="";var n=dom.make("div",s.element_id_prefix+"title_div","",e);dom.make("h1",s.element_id_prefix+"form_title","",n,c("new_person")),dom.make("div",s.element_id_prefix+"content_div","",e),APP.forms.make(g(s.element_id_prefix+"content_div"),d,s.element_id_prefix,s.element_id_prefix,void 0,s.languages.makeInputInForm),g(s.element_id_prefix+"nameKnownAs").addEventListener("blur",s.saveActivePerson),g(s.element_id_prefix+"fullName").addEventListener("blur",s.saveActivePerson),g(s.element_id_prefix+"nameSortBy").addEventListener("blur",s.saveActivePerson)}},s.saveActivePerson=function(){if(-1!=s.persons.getPointer()){var e=o();return e.display_name=s.getDisplayName(e),s.save(e),s.refreshListDisplay(),s.refreshFormTitle(),e}},s.save=function(e){return s.persons.replaceActive(e),l.updatePersonNameInAllBundles(e.id),e},s.createNewPerson=function(e){if("undefined"!=typeof s.active_person_index&&s.saveActivePerson(),!r())return void APP.alert(c("please_give_all_persons_a_name_before_creating_new_one"));e||(e=APP.forms.createEmptyObjectFromTemplate(d));var n=s.persons.add(e);s.createFormIfNotExistent(),s.refreshListDisplay(),s.show(n)},s.handleClickOnDeletePerson=function(){if(-1==typeof s.persons.pointer)return void console.warn("Active Person is undefined. Don't know what to delete!");var e,n=s.persons.getActive().name;e=""==n?c("really_erase_this_person"):c("really_erase_before_name")+n+c("really_erase_after_name"),APP.confirm(e,function(e){e||(s.deleteActivePerson(),APP.log(c("person_deleted_before_name")+n+c("person_deleted_after_name")))},c("no"),c("yes_delete_person"))},s.deleteActivePerson=function(){s.persons.removeActive(),s.refreshListDisplay()},s.getAge=function(e,n){var t=s.persons.getByID(n);if(""===t.age){if(g("radio_age_calc").on){var o=t.birth_date.year+"-"+t.birth_date.month+"-"+s.persons[i].birth_date.day,a=get(l.dom_element_prefix+e+"_bundle_date_year")+"-"+get(l.dom_element_prefix+e+"_bundle_date_month")+"-"+get(l.dom_element_prefix+e+"_bundle_date_day"),r=calcAgeAtDate(a,o);return 0!==r?(console.info("person's age successfully calculated"),r):"Unspecified"}return"Unspecified"}return t.age},s.refreshListDisplay=function(e){g(s.element_id_prefix+"list")||(s.module_view.innerHTML="",s.createListDIV(s.module_view)),g(s.element_id_prefix+"list").innerHTML="",s.persons.forEach(u),0==s.persons.length?(s.showNoPersonsMessage(),APP.environments.disableFunction("link_delete_active_person"),APP.environments.disableFunction("sa_div"),APP.environments.disableFunction("link_duplicateActivePerson")):(n(s.persons.getActiveIndex()),APP.environments.enableFunction("link_delete_active_person"),APP.environments.enableFunction("sa_div"),APP.environments.enableFunction("link_duplicateActivePerson")),l&&!e&&l.refreshPersonLists(s.persons.getAll())},s.getDisplayName=function(e){var n;return n="object"==typeof e?e:s.persons.getByID(e),n?n.fullName&&""!=n.fullName?n.fullName:n.nameSortBy&&""!=n.nameSortBy?n.nameSortBy:n.nameKnownAs&&""!=n.nameKnownAs?n.nameKnownAs:c("unnamed_person"):console.error("Person undefined! Person_id = "+person_id)};var u=function(e,n){var t=dom.make("div",s.element_id_prefix+"list_entry_"+n,s.element_id_prefix+"list_entry",g(s.element_id_prefix+"list")),o=s.getDisplayName(e.id);dom.h2(t,o),dom.p(t,e.role),t.addEventListener("click",function(e){return function(){a(e)}}(n),!1)};return s.doesEveryPersonHaveValidBirthYear=function(){for(var e=0;e<s.persons.length;e++){var n=s.persons.get(e).birth_year;if(n.length>4||"YYYY"==n||""==n)return!1}return!0},s.doesEveryPersonHaveALanguage=function(){for(var e=0;e<s.persons.length;e++)if(0==s.persons.get(e).languages.actor_languages.length)return!1;return!0},s}(),eldp_environment.workflow[1].languages=function(){"use strict";var e={};e.parent=eldp_environment;var n=e.parent.workflow[1];return e.languages_of_active_person=new ObjectList,e.element_id_prefix=n.element_id_prefix+"languages_",e.l=e.parent.l,e.init=function(){},e.makeInputInForm=function(n,t,o){"actor_languages"==n.name&&APP.GUI.makeLanguageSearchForm(t,o,!1,!1,e.addFromForm)},e.remove=function(n){e.languages_of_active_person.remove(n),dom.remove(e.element_id_prefix+n+"_div")},e.clearActivePersonLanguages=function(){e.languages_of_active_person.reset(),g(e.element_id_prefix+"display").innerHTML=""},e.set=function(n){e.languages_of_active_person.add(n),e.renderActorLanguage(g(e.element_id_prefix+"display"),n)},e.renderActorLanguage=function(t,o){var a=dom.make("div",e.element_id_prefix+o.id+"_div",e.element_id_prefix+"entry",t);if(APP.GUI.icon(a,"delete_lang_"+o.id+"_icon","delete_lang_icon","reset",function(e){return function(){n.languages.remove(e)}}(o.id)),dom.spanBR(a,"","","ISO639-3 Code: "+o.iso_code),dom.span(a,"","","Name: "),"LOCAL"==o.name_type){var i=""!==o.name?o.name:e.l("bundle","specify_local_used_language_name");dom.textInput(a,e.element_id_prefix+o.id+"_name_input","eldp_person_lang_name_input","",i)}else dom.span(a,"","",o.name);dom.br(a),dom.spanBR(a,"","","Country ID: "+o.country_code),dom.br(a),APP.GUI.makeTextarea(18,4,a,e.l("languages","additional_information"),e.element_id_prefix+o.id+"addInfo",e.element_id_prefix+o.id+"addInfo","className",o.additional_information,"")},e.addFromForm=function(n){console.log(n);var t;t=0===e.languages_of_active_person.length?!0:!1;var o={iso_code:n[0],name:n[3],country_code:n[1],name_type:n[2],additional_information:""};e.set(o)},e}(),eldp_environment.workflow[2]=function(){"use strict";var e={};e.parent=eldp_environment;var n=e.parent.bundle_form,t=function(){e.render.refresh(e.bundles.getAll())};e.identity={id:"bundle",title:"Bundles",icon:"edit"},e.bundles=new ObjectList,e.lang_id_counter=0,e.resource_id_counter=0,e.person_id_counter=0,e.dom_element_prefix="bundle_",e.reset=function(){e.bundles.eraseAll(),t()};var o,a,i=e.parent.l;return e.init=function(n){o=eldp_environment.workflow[0],a=eldp_environment.workflow[1],e.bundles.reset(),e.resource_id_counter=0,e.person_id_counter=0;var t={newBundle:e.newBundle,deleteBundle:e.userErase,setLanguage:e.set,addPerson:e.addPerson,removePerson:e.removePerson,addResource:e.addResource,removeResource:e.removeResource,removeLanguage:e.removeLanguage};e.render.init(n,t)},e.view=function(){e.render.view()},e.recall=function(n){n.bundles&&(e.bundles.setState(n.bundles),n.person_id_counter&&(e.person_id_counter=n.person_id_counter),t())},e.getSaveData=function(){e.refreshVisibleBundlesInArray();var n={bundles:e.bundles.getState(),lang_id_counter:e.lang_id_counter,person_id_counter:e.person_id_counter};return n},e.refreshVisibleBundlesInArray=function(){forEach(e.render.pager.visible_items,e.refreshBundleInArray)},e.refreshBundlesArray=function(){forEach(e.bundles.getAll(),e.refreshBundleInArray)},e.refreshBundleInArray=function(t){var o=t;APP.forms.fillObjectWithFormData(o,e.dom_element_prefix+t.id+"_",n),forEach(o.persons.persons,function(e){e.role=get("person_in_bundle_"+e.id+"_role_input")}),forEach(o.resources.resources,function(n){n.urcs.u=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_u").checked,n.urcs.r=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_r").checked,n.urcs.c=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_c").checked,n.urcs.s=g(e.dom_element_prefix+t.id+"_resource_"+n.id+"_s").checked}),forEach(o.languages.bundle_languages,function(n){n.content_language=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_content_language").checked,n.working_language=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_working_language").checked,"LOCAL"==n.name_type&&(n.name=g(e.dom_element_prefix+t.id+"_languages_"+n.id+"_name_input").value)})},e.functions=function(){return[{label:i("bundle","new_bundle"),icon:"plus",id:"link_newBundle",onclick:function(){e.newBundle()}},{label:i("bundle","copy_metadata"),icon:"copy",id:"link_copy_bundles",wrapper_id:"copy_bundles_div",type:"function_wrap",sub_div:"copy_bundles_select",onclick:function(){e.handleClickOnCopyMetadata()},after_that:e.render.createCopyBundleOptions},{label:i("bundle","reset_form"),icon:"reset",id:"bundle_link_reset_form",onclick:function(){APP.confirm(i("bundle","really_reset_form"),function(e){e||(APP.environments.resetActive(),APP.log(i("bundle","form_reset")))},i("bundle","no"),i("bundle","yes_delete_form"))}},{label:i("bundle","sort_by_name"),icon:"az",id:"bundle_link_sort_by_name",onclick:function(){e.refreshBundlesArray(),e.bundles.sortBySubKey("bundle","name"),t()}}]},e.newBundle=function(){var n=APP.forms.createEmptyObjectFromTemplate(e.parent.bundle_form);return n.expanded=!0,e.bundles.add(n),t(),n.id},e.createNewBundleWithResources=function(n,t,o){var a=APP.forms.createEmptyObjectFromTemplate(e.parent.bundle_form);a.bundle.name=n,a.expanded=t,e.bundles.add(a),e.render.renderBundle(a);for(var r=0;r<o.length;r++)e.addResource(a.id,o[r]);return APP.log(i("bundle","new_bundle_has_been_created")+"<br>"+i("bundle","name")+": "+n),a.id},e.set=function(n,t,o){var a={code:n[0],name:n[3],name_type:n[2],country_code:n[1],id:e.lang_id_counter,working_language:!1,content_language:!1};e.bundles.getByID(t).languages.bundle_languages.push(a),e.render.renderLanguage(a,t,o),e.lang_id_counter+=1},e.removeLanguage=function(n,t,o){var a=e.bundles.getIndexByID(n),i=e.getLanguageObjectIndexByID(a,t);e.bundles.get(a).languages.bundle_languages.splice(i,1),dom.remove(o)},e.getLanguageObjectIndexByID=function(n,t){return getIndex(e.bundles.get(n).languages.bundle_languages,4,t)},e.getName=function(n){return""===e.bundles.get(n).name?i("bundle","unnamed_bundle"):i("bundle","bundle")+": "+e.bundles.get(n).name},e.userErase=function(n){APP.confirm(i("bundle","really_erase_bundle"),function(o){o||(e.bundles.eraseByID(n),APP.log(i("bundle","bundle_deleted")),t())},i("bundle","no"),i("bundle","yes_delete_bundle"))},e.getIndexFromResourceID=function(n){for(var t,o=0;o<e.bundles.length;o++){var a=e.bundles.get(o);for(t=0;t<a.resources.resources.length;t++)if(a.resources.resources[t].id==n)return t}},e.addPerson=function(n,o,i){if(!a.persons.getByID(o))return void console.log("Tried to add person to bundle although this person is not in the persons database. This is odd.");e.refreshBundlesArray(),console.log("adding person in bundle with id "+n),"string"!=typeof i&&(i="");var r={id:e.person_id_counter,person_id:o,role:i};e.bundles.getByID(n).persons.persons.push(r),t(),e.person_id_counter++},e.removePerson=function(n,t){var o=e.bundles.getByID(n),a=o.persons.persons,i=getIndexByID(a,t);a.splice(i,1),dom.remove(e.dom_element_prefix+n+"_person_"+t)},e.addResource=function(n,a){if(!(a>=o.resources.length)){var r=o.resources.get(a),s=e.resource_id_counter,l={u:!1,r:!1,c:!1,s:!1},c={id:s,resource_id:r.id,urcs:l};if(e.bundles.getByID(n).resources.resources.push(c),"eaf"==getFileTypeFromFilename(r.name)&&""===get(e.dom_element_prefix+n+"_bundle_title")){var d=removeEndingFromFilename(r.name);e.bundles.getByID(n).bundle.title=d,APP.log(i("bundle","bundle_title_taken_from_eaf"))}return t(),e.resource_id_counter+=1,s}},e.removeResource=function(n,t){var o=getArrayWithIDs(e.bundles.getByID(n).resources.resources);if(-1!=o.indexOf(t)){var a=e.getIndexFromResourceID(t);e.bundles.getByID(n).resources.resources.splice(a,1)}dom.remove(e.dom_element_prefix+n+"_resource_"+t)},e.handleClickOnCopyMetadata=function(){e.refreshVisibleBundlesInArray(),"1_to_others"==get("copy_bundle_options")?e.assignBundle1Metadata():e.copyMetadataFrom2ndLastToLast(),t()},e.copyMetadataFrom2ndLastToLast=function(){if(e.bundles.length<2)return void APP.log(i("bundle","at_least_2_bundles_to_assign_metadata"),"error");for(var t=0;t<n.fields_to_copy.length;t++)if(g(APP.CONF.copy_checkbox_element_prefix+n.fields_to_copy[t].name).checked){var o=e.bundles.getLast(),a=e.bundles.getFromEnd(1);"persons"==n.fields_to_copy[t].name&&(e.removeAllPersons(o.id),forEach(a.persons.persons,function(n){e.addPerson(o.id,n.person_id,n.role)})),"languages"==n.fields_to_copy[t].name&&(o.languages.bundle_languages=[],forEach(a.languages.bundle_languages,function(n){var t=cloneObject(n);t.id=e.lang_id_counter,e.lang_id_counter+=1,o.languages.bundle_languages.push(t)})),e.copyFieldsFrom2ndLastToLastBundle(n.fields_to_copy[t].fields)}APP.log(i("bundle","metadata_copied"))},e.assignBundle1Metadata=function(){if(e.bundles.length<2)return void APP.log(i("bundle","at_least_2_bundles_to_assign_metadata"),"error");for(var t=0;t<n.fields_to_copy.length;t++)if(g(APP.CONF.copy_checkbox_element_prefix+n.fields_to_copy[t].name).checked){if("persons"==n.fields_to_copy[t].name)for(var o=1;o<e.bundles.length;o++)e.removeAllPersons(e.bundles.idOf(o)),forEach(e.bundles.get(0).persons.persons,function(n){e.addPerson(e.bundles.idOf(o),n.person_id,n.role)});if("languages"==n.fields_to_copy[t].name)for(o=1;o<e.bundles.length;o++)e.bundles.get(o).languages.bundle_languages=[],forEach(e.bundles.get(0).languages.bundle_languages,function(n){var t=cloneObject(n);t.id=e.lang_id_counter,e.lang_id_counter+=1,e.bundles.get(o).languages.bundle_languages.push(t)});e.copyFieldsToAllBundles(n.fields_to_copy[t].fields)}APP.log(i("bundle","bundle_1_metadata_assigned_to_all_bundles"))},e.copyFieldsToAllBundles=function(n){for(var t=1;t<e.bundles.length;t++)for(var o=0;o<n.length;o++)"bundle_date"==n[o]&&(e.bundles.get(t).bundle.date=cloneObject(e.bundles.getFirst().bundle.date)),"bundle_location"==n[o]&&(e.bundles.get(t).bundle.location=cloneObject(e.bundles.getFirst().bundle.location)),"content"==n[o]&&(e.bundles.get(t).content=cloneObject(e.bundles.getFirst().content)),"persons_description"==n[o]&&(e.bundles.get(t).persons.description=e.bundles.getFirst().persons.description),"resources_recording_equipment"==n[o]&&(e.bundles.get(t).resources.recording_equipment=e.bundles.getFirst().resources.recording_equipment),"resources_recording_conditions"==n[o]&&(e.bundles.get(t).resources.recording_conditions=e.bundles.getFirst().resources.recording_conditions)},e.refreshPersonLists=function(n){e.render.refreshPersonLists(e.bundles.getAll(),n)},e.copyFieldsFrom2ndLastToLastBundle=function(n){for(var t=e.bundles.getLast(),o=e.bundles.getFromEnd(1),a=0;a<n.length;a++)"bundle_date"==n[a]&&(t.bundle.date=cloneObject(o.bundle.date)),"bundle_location"==n[a]&&(t.bundle.location=cloneObject(o.bundle.location)),"content"==n[a]&&(t.content=cloneObject(o.content)),"persons_description"==n[a]&&(t.persons.description=o.persons.description),"resources_recording_equipment"==n[a]&&(t.resources.recording_equipment=o.resources.recording_equipment),"resources_recording_conditions"==n[a]&&(t.resources.recording_conditions=o.resources.recording_conditions)},e.removeAllPersons=function(n){e.bundles.getByID(n).persons.persons=[],t()},e.refreshResourcesOfAllBundles=function(n){var t=getArrayWithIDs(n);e.bundles.forEach(function(n){n.resources.resources.forEach(function(o){-1==t.indexOf(o.resource_id)&&(console.log("There is a resource in bundle with id"+o.resource_id+" that does not exist anymore. Deleting!"),e.removeResource(n.id,o.id))})});for(var o=e.render.pager.visible_items,a=0;a<o.length;a++)e.render.refreshResources(o[a].id)},e.areAllBundlesProperlyNamed=function(){for(var n=0;n<e.bundles.length;n++)if(""===e.bundles.get(n).bundle.title)return!1;return!0},e.doAllBundlesHaveALanguage=function(){for(var n=0;n<e.bundles.length;n++)if(0==e.bundles.get(n).languages.bundle_languages.length)return!1;return!0},e.updatePersonNameInAllBundles=function(n){return e.render.updatePersonNameInAllBundles(n,e.bundles.getAll())},e}(),eldp_environment.workflow[2].render=function(){"use strict";var e={};e.parent=eldp_environment;var n,t,o,a,i=e.parent.l,r=e.parent.bundle_form;return e.dom_element_prefix="bundle_",e.init=function(i,r){e.view_element=i,o=r,n=eldp_environment.workflow[0],t=eldp_environment.workflow[1],a=eldp_environment.workflow[2],e.displayNoBundleText(o.newBundle);var s={render:e.renderBundle,on_page_change:e.refresh,items_list:a.bundles.getAll(),view:i,items_per_page:10,before_page_change:a.refreshVisibleBundlesInArray};e.pager=new APP.GUI.pager(s)},e.view=function(){APP.GUI.scrollTop(),e.pager.refresh(a.bundles.getAll())},e.createCopyBundleOptions=function(){var e=g("copy_bundles_select");dom.h3(e,i("bundle","from_where_to_where"));var n=[{title:i("bundle","from_bundle_1_to_all_others"),id:"1_to_others"},{title:i("bundle","from_2nd_last_to_last_bundle"),id:"second_last_to_last"}];if(dom.makeRadios(e,n,"copy_bundle_options","","title","id",0,void 0),dom.br(e),dom.h3(e,i("bundle","elements_to_copy")),!r.fields_to_copy)return void dom.make("span","","",e,i("bundle","this_function_is_currently_unavailable"));for(var t=r.fields_to_copy,o=0;o<t.length;o++){var a=dom.input(e,APP.CONF.copy_checkbox_element_prefix+t[o].name,"","","checkbox");a.checked=!0,dom.span(e,"",""," "+t[o].label),dom.br(e)}},e.refreshResources=function(t){var a=g(e.dom_element_prefix+t+"_resources_add_mf_div");a.innerHTML="";var r=document.createElement("select");if(dom.setSelectOptions(r,n.resources.getAll(),"name","take_index",!1),n.resources.length>0&&(a.appendChild(r),dom.br(a),dom.button(a,i("bundle","add_to_bundle"),function(e){return function(){o.addResource(e,r.selectedIndex,!1)}}(t))),0===n.resources.length){var s=document.createElement("h5");a.appendChild(s),s.innerHTML=i("bundle","no_files_have_been_added")+"<br>",dom.link(s,"","",i("bundle","add_some_files"),function(){APP.view(n)})}},e.refresh=function(n){var t=e.view_element;t.innerHTML="",e.pager.refresh(n),forEach(e.pager.visible_items,e.renderBundle),0===n.length&&e.displayNoBundleText(o.newBundle)},e.renderBundle=function(n){var i=n.id,s=n.expanded,l=e.view_element;g("no_bundle_text")&&(l.innerHTML="");var c=APP.GUI.FORMS.expandableForm(l,e.dom_element_prefix+i,s,function(e){n.expanded=e.expanded},o.deleteBundle,i);APP.forms.make(c.content,r,e.dom_element_prefix+i+"_",e.dom_element_prefix,n,e.makeSpecialFormInput),g(e.dom_element_prefix+i+"_bundle_title").addEventListener("blur",function(n){return function(){e.refreshBundleHeading(n)}}(i));var d=e.dom_element_prefix+i+"_languages_";forEach(n.languages.bundle_languages,function(n){e.renderLanguage(n,i,d)}),"undefined"!=typeof n.persons&&"undefined"!=typeof n.persons.persons&&forEach(n.persons.persons,function(t){e.renderPerson(n,t)}),"undefined"!=typeof n.resources.resources&&forEach(n.resources.resources,function(n){e.renderResource(n,i),n.id>=a.resource_id_counter&&(a.resource_id_counter=n.id+1)}),e.refreshResources(i);var u=t.persons.getArrayWithIDs();e.refreshPersonListInBundle(n,u),e.refreshBundleHeading(i)},e.makeSpecialFormInput=function(n,t,a){if("bundle_languages"==n.name){var i=a.slice(e.dom_element_prefix.length,a.indexOf("_",e.dom_element_prefix.length));APP.GUI.makeLanguageSearchForm(t,a,!1,!1,function(e){o.setLanguage(e,i,a)})}"persons"==n.name&&(dom.br(t),dom.make("div",a+"persons","persons",t),dom.make("div",a+"addPersons_div","persons",t)),"resources"==n.name&&(dom.make("div",a+"resources","mfs",t),dom.make("div",a+"add_mf_div","",t),dom.p(t,""))},e.renderLanguage=function(n,t,a){var r=n.id;r>=e.lang_id_counter&&(e.lang_id_counter=r+1),console.log("Rendering lang with id "+r);var s=a+r+"_div",l=[];l.push("ISO639-3 Code: "+n.code);var c=[];if(c.push(i("bundle","name")+": "),"LOCAL"==n.name_type){var d=""!==n.name?n.name:i("bundle","specify_local_used_language_name");c.push(dom.textInput(void 0,a+r+"_name_input","eldp_bundle_lang_name_input","",d))
}else c.push(n.name);var u=[];u.push(dom.checkbox(void 0,a+r+"_content_language","","",n.content_language)),u.push(i("bundle","content_language")+"  "),u.push(dom.checkbox(void 0,a+r+"_working_language","","",n.working_language)),u.push(i("bundle","working_language")),console.log(u),l.push(c,u),APP.GUI.FORMS.redBox(g(a+"display"),s,"bundle_language_entry",l,function(e,n,t){return function(){o.removeLanguage(e,n,t)}}(t,r,s))},e.refreshPersonName=function(n,o){var a=n.id,i=e.dom_element_prefix+a+"_person_"+o+"_name_disp",r=g(i);console.log(r);var s=getObjectByID(n.persons.persons,o),l=s.person_id;console.log(l);var c=t.getDisplayName(l);console.log(c),r.innerHTML=c},e.updatePersonNameInAllBundles=function(n,t){forEach(t,function(t){var o=map(t.persons.persons,function(e){return e.person_id});-1!=o.indexOf(n)&&e.refreshPersonName(t,n)})},e.refreshPersonListInBundle=function(n,a){var r=n.id,s=g(e.dom_element_prefix+r+"_persons_addPersons_div");s.innerHTML="";var l=document.createElement("select");if(dom.setSelectOptions(l,t.persons.getAll(),"display_name","take_index"),t.persons.length>0&&(s.appendChild(l),dom.br(s),dom.button(s,"Add to bundle",function(e){return function(){o.addPerson(e,t.persons.idOf(l.selectedIndex))}}(r))),0===t.persons.length){var c=dom.h5(s,i("bundle","no_persons_created_yet")+"<br>");dom.link(c,"","",i("bundle","create_some_persons"),function(){APP.view("VIEW_persons")})}n.persons.persons.forEach(function(e){-1==a.indexOf(e.person_id)&&(console.log("There is an person in bundle with id"+r+" that does not exist anymore. Deleting!"),o.removePerson(r,e.id))})},e.refreshPersonLists=function(n,t){for(var o=getArrayWithIDs(t),a=0;a<e.pager.visible_items.length;a++)e.refreshPersonListInBundle(e.pager.visible_items[a],o)},e.displayNoBundleText=function(n){console.log("Showing no bundle text");var t=e.view_element;t.innerHTML="";var o=dom.make("h2","no_bundle_text","no_bundle_text",t);o.innerHTML=i("bundle","no_bundles_have_been_created_yet")+" "+i("bundle","why_not_create_one__before_link");var a=dom.make("a","new_bundle_link","new_bundle_link",o);a.innerHTML=i("bundle","why_not_create_one__link"),o.innerHTML+=i("bundle","why_not_create_one__after_link"),g("new_bundle_link").addEventListener("click",n),t.scrollTop=0},e.renderPerson=function(n,t){var a=n.id,i=t.id,r=""!==t.role?t.role:"Role";dom.make("div",e.dom_element_prefix+a+"_person_"+i,"person_in_bundle_wrap",g(e.dom_element_prefix+a+"_persons_persons"));var s=dom.make("div",e.dom_element_prefix+a+"_person_"+i+"_label","person_in_bundle",g(e.dom_element_prefix+a+"_person_"+i)),l=dom.h2(s);l.className="person_name_disp",l.id=e.dom_element_prefix+a+"_person_"+i+"_name_disp";var c=APP.GUI.makeSelect(s,void 0,"person_in_bundle_"+i+"_role_input","person_in_bundle_"+i+"_role_input",1,["Annotator","Author","Compiler","Consultant","Data_inputter","Depositor","Developer","Editor","Illustrator","Interpreter","Interviewee","Interviewer","Participant","Performer","Photographer","Recorder","Researcher","Research_participant","Responder","Signer","Singer","Speaker","Sponsor","Transcriber","Translator"],r,void 0);c.className="person_role_input",e.refreshPersonName(n,i),APP.GUI.icon(g(e.dom_element_prefix+a+"_person_"+i),"delete_person_"+i+"_icon","delete_person_icon","reset",function(e,n){return function(){o.removePerson(e,n)}}(a,i))},e.renderResource=function(t,a){var r=t.id,s=t.urcs,l=n.resources.getByID(t.resource_id).name,c=dom.make("div",e.dom_element_prefix+a+"_resource_"+r,"mf",g(e.dom_element_prefix+a+"_resources_resources")),d=dom.h3(c);d.innerHTML=i("bundle","object");var u=APP.GUI.icon(c,"delete_resource_"+r+"_icon","delete_resource_icon","reset");u.addEventListener("click",function(e,n){return function(){o.removeResource(e,n)}}(a,r)),dom.span(c,"","resource_file_content_span",i("bundle","file_name")+"<br><input type='text' value='"+l+"'><br>"),e.renderUCRS(c,e.dom_element_prefix+a+"_resource_"+r+"_",s)},e.renderUCRS=function(e,n,t){var o=dom.input(e,n+"u","","","checkbox","u");dom.span(e,"","","U"),t.u===!0&&(o.checked=!0);var a=dom.input(e,n+"r","","","checkbox","r");dom.span(e,"","","R"),t.r===!0&&(a.checked=!0);var i=dom.input(e,n+"c","","","checkbox","c");dom.span(e,"","","C"),t.c===!0&&(i.checked=!0);var r=dom.input(e,n+"s","","","checkbox","s");dom.span(e,"","","S"),t.s===!0&&(r.checked=!0)},e.refreshBundleHeading=function(n){g(e.dom_element_prefix+n+"_label").innerHTML=""===a.bundles.getByID(n).bundle.title?i("bundle","unnamed_bundle"):i("bundle","bundle")+": "+get(e.dom_element_prefix+n+"_bundle_title")},e}(),eldp_environment.workflow[3]=function(){"use strict";var e,n,t,o={};o.parent=eldp_environment;var a=o.parent.l;return o.view_element,o.identity={id:"xml_output",title:"CMDI Output",icon:"data"},o.init=function(a){e=eldp_environment.workflow[2],n=eldp_environment.workflow[1],t=eldp_environment.workflow[0],o.view_element=a;var i=dom.h2(o.view_element,"","","");dom.link(i,"","","Download JSON of this project",APP.save_and_recall.saveActiveEnvironmentStateToFile)},o.view=function(){return APP.save(),0===e.bundles.length?(APP.alert(a("output","you_must_create_some_bundles_first")),void APP.view(e)):e.areAllBundlesProperlyNamed()?e.doAllBundlesHaveALanguage()?void o.generate():(APP.view(e),void APP.alert(a("output","bundles_must_have_one_language"))):(APP.view(e),void APP.alert(a("output","bundles_must_have_proper_name")+o.parent.not_allowed_chars))},o.functions=function(){return[{id:"link_export_corpus",icon:"download",label:"Download All Bundles",onclick:function(){APP.saveAllOutputFiles()}}]},o.generate=function(){var o,a=g("VIEW_xml_output");a.innerHTML="",APP.save();for(var i={bundles:e.bundles.getAll(),persons:n.persons,resources:t.resources},r=eldp_environment.eldp_generator(i),s=0;s<e.bundles.length;s++)o=e.bundles.get(s).bundle.title+".cmdi",APP.GUI.createXMLOutputDIV(a,"CMDI Bundle "+(s+1),"textarea_bundle_"+s,r.bundles[s],o,!1)},o}(),eldp_environment.eldp_generator=function(e){"use strict";var n,t="clarin.eu:cr1:p_1407745711992",o="ISO639-3:",a=[],i=function(){var e=randomString(8,"0123456789abcdefghijklmnopqrstuvwxyz"),n=randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),t=randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),o=randomString(4,"0123456789abcdefghijklmnopqrstuvwxyz"),a=randomString(12,"0123456789abcdefghijklmnopqrstuvwxyz");return"res_"+e+"_"+n+"_"+t+"_"+o+"_"+a},r=function(e,n,t){var o="";return o+=xml.tag("Header",0),o+=xml.element("MdCreator",e),o+=xml.element("MdCreationDate",n),o+=xml.element("MdProfile",t),o+=xml.tag("Header",1)},s=function(){return["xml:lang",get("metadata_language_select")]},l=function(e){var n="";return n+=xml.open("ContentLanguages"),forEach(e,function(e){n+=xml.open("ContentLanguage"),n+=xml.element("Name",e.name),n+=xml.element("Code",o+e.code),n+=e.content_language===!0?xml.element("Use","Content"):xml.element("Use","Working"),n+=xml.close("ContentLanguage")}),n+=xml.close("ContentLanguages")},c=function(e,n,o){xml.reset();var c="";if(c+=xml.header,c+=xml.open("CMD",[["xmlns","http://www.clarin.eu/cmd/"],["xmlns:cmd","http://www.clarin.eu/cmd/"],["xmlns:dcr","http://www.isocat.org/ns/dcr"],["xmlns:ann","http://www.clarin.eu"],["xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance"],["xsi:schemaLocation","http://www.clarin.eu/cmd/ http://catalog.clarin.eu/ds/ComponentRegistry/rest/registry/profiles/"+t+"/xsd"],["CMDVersion","1.1"]]),c+=r(get("metadata_creator"),today()+"+01:00",t),c+=xml.open("Resources"),e.resources.resources.length>0){c+=xml.open("ResourceProxyList");for(var _=0;_<e.resources.resources.length;_++)a.push(i()),c+=xml.open("ResourceProxy",[["id",a[_]]]),c+=xml.element("ResourceType","Resource"),console.log(o),c+=xml.element("ResourceRef",o.getByID(e.resources.resources[_].resource_id).name),c+=xml.close("ResourceProxy");c+=xml.close("ResourceProxyList")}else c+=xml.element("ResourceProxyList",2);return c+=xml.tag("JournalFileProxyList",2),c+=xml.tag("ResourceRelationList",2),c+=xml.close("Resources"),c+=xml.open("Components"),c+=xml.open("ELDP_Bundle"),c+=xml.element("Title",e.bundle.title),c+=xml.element("ID",e.bundle.id_element),c+=xml.element("Description",e.bundle.description,[s()]),c+=xml.open("StatusInfo"),c+=xml.element("Status","in-progress"),c+=xml.element("ChangeDate",today()),c+=xml.close("StatusInfo"),c+=u(),c+=l(e.languages.bundle_languages),c+=d(e.content.genre),c+=g(e.content.keywords),c+=m(e.persons.persons,n,e),c+=xml.open("ProjectLocations"),c+=xml.open("ProjectLocation"),c+=xml.element("Name",e.bundle.location.name),c+=xml.open("ProjectGeographic"),c+=xml.element("Country",e.bundle.location.country),c+=xml.close("ProjectGeographic"),c+=xml.close("ProjectLocation"),c+=xml.close("ProjectLocations"),c+=h(e.resources.resources,o,e.languages.bundle_languages,e.persons.persons,n,e),c+=xml.close("ELDP_Bundle"),c+=xml.close("Components"),c+=xml.close("CMD")},d=function(e){var n="";return""==e?"":(n+=xml.open("Genres"),n+=xml.element("Genre",e),n+=xml.close("Genres"))},u=function(){var e="";return e+=xml.open("Depositors"),e+=xml.open("Depositor"),e+=xml.element("Role","Depositor"),e+=xml.element("AdditionalInformation",""),e+=xml.open("PersonalData"),e+=xml.open("Name"),e+=xml.element("Name",""),e+=xml.close("Name"),e+=xml.open("BiographicalData"),e+=xml.close("BiographicalData"),e+=xml.close("PersonalData"),e+=xml.element("Gender",""),e+=xml.open("Languages"),e+=xml.open("Language"),e+=xml.element("Name",""),e+=xml.element("Autoglottonym",""),e+=xml.close("Language"),e+=xml.close("Languages"),e+=xml.close("Depositor"),e+=xml.close("Depositors")},_=function(e){var n="";return 0==e.length?"":(n+=xml.open("Languages"),forEach(e,function(e){n+=xml.open("Language"),n+=xml.element("Name",e.name),n+=xml.element("Code",o+e.iso_code),n+=xml.element("Additional_Information",e.additional_information),n+=xml.close("Language")}),n+=xml.close("Languages"))},m=function(e,n,t){if(0===e.length)return"";var o="";return o+=xml.open("Persons"),forEach(e,function(e){var a=n.getByID(e.person_id);o+=xml.open("Person"),o+=xml.element("PersonID",""),""!==t.bundle.date.year&&"YYYY"!==t.bundle.date.year&&(o+=xml.element("Age_at_Time_of_Recording",t.bundle.date.year-a.birth_year)),o+=xml.element("Role",e.role),o+=xml.element("AdditionalInformation",a.person_additional_information),o+=xml.element("BiographicalNote",a.biographical_note);var i=linesToArray(a.ethnicity),r=linesToArray(a.ethnicity_additional_info);if(i.length==r.length&&0!=i.length)for(var s=0;s<i.length;s++)o+=xml.open("Ethnicity"),o+=xml.element("EthnicAffiliation",i[s]),o+=xml.element("AdditionalInformation",r[s]),o+=xml.close("Ethnicity");o+=xml.open("PersonalData"),o+=xml.open("Name"),o+=xml.element("Title",a.title),""!==a.nameKnownAs&&(o+=xml.element("Name",a.nameKnownAs,[["kind","KnownAs"]])),""!==a.fullName&&(o+=xml.element("Name",a.fullName,[["kind","FullName"]])),""!==a.nameSortBy&&(o+=xml.element("Name",a.nameSortBy,[["kind","asSortBy"]])),o+=xml.close("Name"),o+=xml.open("BiographicalData"),o+=xml.element("BirthYear","YYYY"!=a.birth_year?a.birth_year:""),"YYYY"!=a.death_year&&""!=a.death_year&&(o+=xml.element("DeathYear",a.death_year)),o+=xml.close("BiographicalData"),o+=xml.close("PersonalData"),o+=xml.open("Gender"),o+=xml.element("GenderIdentification",a.sex),o+=xml.element("AdditionalInformation",""),o+=xml.close("Gender"),o+=xml.open("Education"),o+=xml.element("Level",a.education),o+=xml.element("AdditionalInformation",""),o+=xml.close("Education"),o+=_(a.languages.actor_languages);var l=linesToArray(a.nationality),c=linesToArray(a.nationality_additional_info);if(l.length==c.length&&0!=l.length)for(var s=0;s<l.length;s++)o+=xml.open("Nationality"),o+=xml.element("Name",l[s]),o+=xml.element("AdditionalInformation",c[s]),o+=xml.close("Nationality");o+=xml.close("Person")}),o+=xml.close("Persons")},f=function(e,n,t,o,a,i,r){var s="";console.log(e),s+=xml.open("Resource",[["ref",r]]),s+=xml.element("Title",n.name),s+=xml.element("ID",""),s+=xml.element("Host",""),s+=xml.open("StatusInfo"),s+=xml.element("Status",n.status),s+=xml.element("ChangeDate",today()),s+=xml.close("StatusInfo"),s+=u(),s+=l(t),s+=d(i.content.genre),s+=g(i.content.keywords),s+=m(o,a,i),s+=xml.open("AccessInformation"),s+=xml.element("Restrictions",i.resources.access_restrictions),s+=xml.element("ConditionsofAccess",i.resources.access_conditions);var c="Open Access";return 1==e.urcs.u&&(c="User"),1==e.urcs.r&&(c="Researcher"),1==e.urcs.c&&(c="Community member"),1==e.urcs.s&&(c="Subscriber"),s+=xml.element("oURCS",c),s+=xml.close("AccessInformation"),s+=p(n),s+=xml.close("Resource")},p=function(e){var n={eaf:"TextFile",txt:"TextFile",jpg:"ImageFile",png:"ImageFile",tif:"ImageFile",bmp:"ImageFile",wav:"AudioFile",mp4:"VideoFile",avi:"VideoFile"},t=getFileTypeFromFilename(e.name);if(n[t])var o=n[t];else o="TextFile";var a="";a+=xml.open("File"),a+=xml.open(o),a+=xml.open("General"),a+=xml.element("Name",e.name);var i=parseDate(e.lastModified);if(null!=i)var r=dateAsString(i);else r="1977-01-01";return a+=xml.element("Date",r),a+=xml.close("General"),a+=xml.element("Checksum",""),a+=xml.close(o),a+=xml.close("File")},g=function(e){if(e=linesToArray(e),0==e.length||1==e.length&&""==e[0])return"";var n="";n+=xml.open("Keywords");for(var t=0;t<e.length;t++)n+=xml.element("Keyword",e[t]);return n+=xml.close("Keywords")},h=function(e,t,o,i,r,s){var l="";return 0===e.length?l:(l+=xml.open("Resources"),forEach(e,function(e){var c=t.getByID(e.resource_id);l+=f(e,c,o,i,r,s,a[n]),n+=1}),l+=xml.close("Resources"))},v={};return v.bundles=map(e.bundles,function(t){return xml.reset(),n=0,c(t,e.persons,e.resources)}),v};